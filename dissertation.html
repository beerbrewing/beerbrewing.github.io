<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <link rel="shortcut icon" href="/build/favicon.ico"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=yes"/>
  <meta name="theme-color" content="#000000"/>
  <link rel="manifest" href="/build/manifest.json"/>
  <meta name="google-site-verification" content="c6e4BGC8UIsMyBVlGlaWPooxidtPc8OvlTr41gHUV7k"/>
  <title>Pyrmont Brewery - Internet Primer (1997)</title>
</head>
<body>

<div id="ctl00_DescriptionSpot" class="summary">A general overview of Internet technologies including what the Internet actually is, what HTML and XML are, using Web forms, CGI/MIME, IIS ISAPI, ASP and creating HTML based front ends to databases via ODBC32, OLE DB, ADO and ASP.NET</div><span id="ctl00_ThumbnailUrl" class="date" content="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png"></span>

</div>




















<div id="contentdiv" class="text">




  <h2>Introduction</h2>
  <p>This document is intended to be read as a general overview of Internet/enterprise technology to get newbies to this domain up to speed. The contents of this document is arranged to provide:</p>
  <ul>
    <li><a href="#Overview">Quick overview of what the Internet actually is</a>
    </li><li><a href="#HTML">Description of what HTML and XML is</a>
  </li><li><a href="#FORMS">Web forms</a>
  </li><li><a href="#CGI">Basic understanding of CGI/HTTP/MIME</a>
  </li><li><a href="#ISAPI">ISAPI</a>
  </li><li><a href="#ODBC">ODBC</a>
  </li><li><a href="#ActiveX">ActiveX</a>
  </li><li><a href="#ASP">ASP (Active Server Pages)</a>
  </li><li><a href="#ADO">OLE DB/ADO</a>
  </li><li><a href="#.NET">ASP.NET</a>
  </li><li><a href="#Appendix">Some examples</a> </li></ul>
  <p>The document was originally researched and written by myself in 1997. However, it is still very relevant today (c. 2005). I am publishing it here freely for you so that beginner ASP.NET developers today can appreciate and understand how ASP.NET and database connection technology came about and how it has evolved over the years.</p>
  <p>I hope you find this enough information for you to get you started developing enterprise applications for the Internet...</p>
  <p>Comments, suggestions welcome to: <a>kevleyski@hotmail.com</a>.</p>
  <p>Kevin Staunton-Lambert BSCS</p><a name="Overview"></a>
  <h2>Quick overview of the Internet and TCP/IP</h2>
  <p><a id="ARPA" name="ARPA"></a>The ‘Internet’ was the name given to the project and prototype system which was originally developed by the <a href="http://www.arpa.mil/" target="_blank">Advanced Research Projects Agency (ARPA)</a> to investigate ways to solve the problem of getting incompatible computer networks to communicate with one another.</p>
  <p>Through this project, two fundamental software standards were developed:</p>
  <ul>
    <li>Transmission Control Protocol (TCP) which makes sure that all data passed through the network arrives as it was intended.
    </li><li>Internet Protocol (IP) which specifies the ‘language’ which must be spoken and understood by any computer system to communicate with another over the Internet. </li></ul>
  <p><a id="UDP" name="UDP"></a>These software standards are generally referred to as ‘TCP/IP’ (Tea Sea Pea Eye Pea). However, a more precise title for it is ‘TCP/IP protocol suite’ because this software also includes other protocols such as the User Datagram Protocol (UDP) which is used for short packets of data such as live video and audio which do not require error checking.</p>
  <p>Any machine connected to the Internet has a unique Internet (IP) address. The IP address is a four byte code (32-bit code which has the potential to support over 4 billion machines) which is assigned so that all machines belonging to a similar network have the same prefix. (This is similar to telephone numbers being grouped into locations, however location is irrelevant when assigning IP addresses).</p>
  <p>There is currently an improved IP addressing system being developed known as IPng (IP Next Generation) which will use eight bytes (128-bit) to support 3x1038 machines, sufficient enough to potentially make it possible to control any light-switch in any house on the planet without any worries of running out of addresses. (I expect that we will see some interesting computer viruses should this ever be implemented!)</p>
  <p><a id="DNS" name="DNS"></a>Humans are generally not very good at remembering IP addresses, so they are often assigned a name commonly known as Host Name, Universal Resource Locator (URL), or Universal Resource Identifier (URI). An example of such a name is <a href="http://www.codeproject.com" target="_blank">http://www.codeproject.com</a>. URLs along with the IP address are held as an entry on a Domain Name System (DNS) which is essentially a series of computers known as 'domain servers' on the Internet supporting this ever increasing database.</p>
  <h3><a id="
WWW" name="WWW"></a>The World Wide Web (WWW)</h3>
  <p>The World Wide Web (WWW) was originally developed by Tim Berners-Lee and other scientists at CERN laboratories (in Geneva just on the French border) to allow particle physicists to share information around the world.</p>
  <p>Today ‘The Web’ as it is generally called, is used by millions of people around the world to pass and organize hypermedia (text/graphics/sound etc.) over the Internet. Estimating the size of the web is a near impossible task. On 25<sup>th</sup> May 1996, it was estimated by 'Internet Solutions' that there were 59,628,024 people accessing 304,177 sites; today in 1998, these figures may have near doubled.</p>
  <p>The Web’s success has been achieved by creating hypermedia document standards:</p>
  <ul>
    <li>The <a href="http://www.ietf.org/rfc/rfc2068.txt" target="_blank">HyperText Transport Protocol (HTTP)</a> which is used by all web ‘Browsers’ to communicate with web ‘Servers’ (sometimes this is also referred as the HyperText Transmission Protocol).
      <p></p>
    </li><li>HyperText Mark-up Language (HTML) which is the ‘language’ which must be used by web page authors to format the hypermedia documents. (It is often the specification of this language that has sparked major controversy between some software producers.) </li></ul><a name="HTML"></a>
  <h2>Mark-up Languages</h2>
  <h3>HTML (Hyper Text Markup Language)</h3>
  <p>HTML is the default scripting language supported by the HyperText Transfer Protocol (HTTP) for formatting web documents (formatting tags) and hyper-linking (anchor tags) to other web documents and scripts held on a web server.</p>
  <p>The syntax for HTML, which was adapted from SGML (Simple Generic Mark-up Language or Standard Generalized Markup Language ISO 8878:1986), is very easy to learn and is ideal for use on the web because of its low size. (Compare the size of a formatted HTML document with a similarly formatted document written using a Word processor). HTML documents are generally held in ASCII (American Standard Code for Information Interchange) format which is a standard between most software/hardware platforms. International coding characters (Unicode) can also be added to documents by using their HTML abbreviation after an ampersand (&amp;) character, and then followed by a semi-colon (;). (For example, the symbol for the ampersand character is marked up as &amp;amp;.)</p>
  <p>Although there is plenty of material covering HTML, we need to look at some basic HTML structures because we will keep coming across them in the following sections.</p>
  <h3><a id="Formatting" name="Formatting"></a>HTML document structure and Tags</h3>
  <p>HTML documents always have a basic structure made up of a header (containing the document title, and other meta-data such as the author's name and date) and a body. Documents are essentially plain text with formatting tags which are very similar to the principles used by early word processors, such as Word Perfect for DOS. HTML Tags are defined between less than (&lt;) and greater than (&gt;) symbols and always come in pairs *, i.e., a section start tag (e.g., &lt;large&gt; to make text large) and a section closing tag (e.g., &lt;/large&gt; to make it normal again).</p>
  <p>* Some browsers, such as Microsoft Internet Explorer allow lazy HTML as well as strict HTML. This allows you to miss out some tags which may seem obvious (such as the tag used to end a row in a table (&lt;/tr&gt;)). However, it is very important to keep to the official strict syntax defined by the <a href="http://www.w3.org/" target="_blank">WWW Consortium (W3C)</a> so that we can maintain software independence throughout the web.</p>
  <p>The following HTML script demonstrates some of the formatting tags.</p>
  <p>Notice the use of indentation to identify the affected section between a start and closing tag; this is valid HTML because tabs, and spaces larger than one character in length, are ignored. (To force double spaces, you need to use the HTML abbreviation <code> </code>).</p><a id="Comments" name="Comments"></a><a id="
Versioning" name="Versioning"></a><a id="Headers" name="Headers"></a><a id="Metadata" name="
Metadata"></a><a id="Body" name="Body"></a><a id="Tables" name="Tables"></a><a id="Breaks" name="Breaks"></a><a id="Lists" name="Lists"></a><a id="Fonts" name="Fonts"></a><a id="Hyperlinks" name="Hyperlinks"></a><a id="
Applets" name="Applets"></a><a id="Objects" name="Objects"></a><a id="CSS" name="CSS"></a>

































































  <table id="Table1" cellspacing="0" cellpadding="7" width="600" border="1"><tbody><tr><th valign="top" align="left" width="100" height="19">Section</th><th valign="top" align="left" width="400" height="19">HTML Script</th><th valign="top" align="left" width="100" height="19">Details</th></tr><tr><td valign="top" width="100" height="1">Comments</td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain1213'><div>HTML</div><div class='pre-action-link'><span id='copycode1213' class='copy-code' data-index='1213' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre1213' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;!--</span><span class="code-keyword"><span class="code-comment">&lt;span class="code-comment"&gt;
Comments
</span><span class="code-comment">--&gt;</span></span><span class="code-keyword">&lt;</span><span class="code-leadattribute">/span</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1">
    <p>Any text within the tags <code>&lt;!--</code> and <code>--&gt;</code> is specified as not being part of the HTML content.</p>
    <p>Do not use hyphens (-) or the 'greater than' symbol (&gt;) in a comments section because the HTML browser may confuse this as the end of the comment.</p></td></tr><tr><td valign="top" width="100" height="87">Document Versioning Information</td><td valign="top" width="400" height="87"><div class='pre-lang' id='premain66758'><div>HTML</div><div class='pre-action-link'><span id='copycode66758' class='copy-code' data-index='66758' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre66758' style='margin-top:0;' class='lang-html' data-language='HTML' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">!doctype</span><span class="code-attribute"> </span><span class="code-attribute">HTML</span><span class="code-attribute"> </span><span class="code-attribute">PUBLIC</span><span class="code-attribute">
       </span><span class="code-attribute">"</span><span class="code-attribute">-//W3C//DTD</span><span class="code-attribute"> </span><span class="code-attribute">HTML</span><span class="code-attribute"> </span><span class="code-attribute">3.2//EN</span><span class="code-attribute">"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="87">
    <p><code>&lt;!doctype&gt;</code> specifies which version of HTML should be used to interpret this document. Here, we have specified version 3.2 as defined by the <a href="http://www.w3.org/" target="_blank">WWW Consortium (W3C)</a>.</p>
    <p><code>&lt;html&gt;</code> Specifies that the start of the HTML document.</p></td></tr><tr><td valign="top" width="100" height="1">
    <p><b>Header</b></p>
    <p>Document Header</p></td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain726875'><div>HTML</div><div class='pre-action-link'><span id='copycode726875' class='copy-code' data-index='726875' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre726875' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">head</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">title</span><span class="code-keyword">&gt;</span>
   Document Title
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">/title</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1">
    <p><code>&lt;head&gt;</code> Denotes the start of the document header section.</p>
    <p><code>&lt;title&gt;</code> specifies the documents reference name (use for indexing search engines, and bookmarks/ favorites).</p></td></tr><tr><td valign="top" width="100" height="1">
    <p><b>Header</b></p>
    <p>Header Meta-data</p></td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain492744'><div>HTML</div><div class='pre-action-link'><span id='copycode492744' class='copy-code' data-index='492744' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre492744' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">meta</span><span class="code-attribute"> </span><span class="code-attribute">HTTP-EQUIV</span><span class="code-keyword">="</span><span class="code-keyword">Content-Type"</span><span class="code-attribute">
  </span><span class="code-attribute">CONTENT</span><span class="code-keyword">="</span><span class="code-keyword">text/html;
  charset=Windows-1251"</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">meta</span><span class="code-attribute"> </span><span class="code-attribute">HTTP-EQUIV</span><span class="code-keyword">="</span><span class="code-keyword">Keywords"</span><span class="code-attribute">
  </span><span class="code-attribute">CONTENT</span><span class="code-keyword">="</span><span class="code-keyword">HTML,Tables,Forms"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/head</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1">
    <p><code>&lt;meta&gt;</code> Meta Data (hidden data) describes additional information such as the character set to use to display this document.</p>
    <p>Other metadata includes document description, author, keywords, automatic document refresh/referral, published/expiry dates, etc …</p>
    <p><code>&lt;/head&gt;</code> marks the end of document header section.</p></td></tr><tr><td valign="top" width="100" height="1"><b>Body</b></td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain124948'><div>HTML</div><div class='pre-action-link'><span id='copycode124948' class='copy-code' data-index='124948' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre124948' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">body</span><span class="code-attribute"> </span><span class="code-attribute">bgcolor</span><span class="code-keyword">=</span><span class="code-keyword">#ffffff
</span><span class="code-attribute"> </span><span class="code-attribute">text</span><span class="code-keyword">=</span><span class="code-keyword">#000000
</span><span class="code-attribute"> </span><span class="code-attribute">link</span><span class="code-keyword">=</span><span class="code-keyword">#0000ff</span><span class="code-attribute"> </span><span class="code-attribute">vlink</span><span class="code-keyword">=</span><span class="code-keyword">#909090</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1"><code>&lt;body&gt;</code> Start of document body section. The background/ text/ hyperlinks and visited hyperlink colors are defined here by using hexadecimal RGB (#rrggbb) notation (#ffffff specifies a white background).</td></tr><tr><td valign="top" width="100" height="230"><b>Tables</b>
    <p>Table Header</p>





    <table id="Table2" cellspacing="0" border="1"><tbody><tr><th>x</th><th>y</th><th>z</th></tr></tbody></table></td><td valign="top" width="400" height="230"><div class='pre-lang' id='premain230666'><div>HTML</div><div class='pre-action-link'><span id='copycode230666' class='copy-code' data-index='230666' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre230666' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">table</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span>
    Tag
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">/th</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">th</span><span class="code-attribute"> </span><span class="code-attribute">align</span><span class="code-keyword">=</span><span class="code-keyword">left</span><span class="code-keyword">&gt;</span>
    Example
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">/th</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/tr</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="230">
    <p><code>&lt;table&gt;</code> Specifies that the following lines are to be place in a table.</p>
    <p><code>&lt;tr&gt;</code> Add a row to the table</p>
    <p><code>&lt;th&gt;</code> Add a column called 'Tag' (table header)</p>
    <p>Add another column called 'Example' which is to be <code>align</code>ed to the <code>left</code> of the column rather than the default middle alignment.</p>
    <p><code>&lt;/tr&gt;</code> Specify the end of a row. * As mentioned above some browsers that support tables do not require this tag, however I have included it for completeness.</p></td></tr><tr><td valign="top" width="100" height="604">
    <p><b>Tables</b></p>
    <p>Table Rows</p>













    <table id="Table3" cellspacing="0" border="1"><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>4</td><td>5</td><td>6</td></tr><tr><td>7</td><td>8</td><td>9</td></tr></tbody></table></td><td valign="top" width="400" height="604"><div class='pre-lang' id='premain808040'><div>HTML</div><div class='pre-action-link'><span id='copycode808040' class='copy-code' data-index='808040' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre808040' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">TABLE</span><span class="code-attribute"> </span><span class="code-attribute">cellSpacing</span><span class="code-keyword">=</span><span class="code-keyword">0</span><span class="code-attribute"> </span><span class="code-attribute">border</span><span class="code-keyword">=</span><span class="code-keyword">1</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">TBODY</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">TR</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>1<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>2<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>3<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">/TR</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">TR</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>4<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>5<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>6<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">/TR</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">TR</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>7<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>8<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
   <span class="code-keyword">&lt;</span><span class="code-leadattribute">TD</span><span class="code-keyword">&gt;</span>9<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TD</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">/TR</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">/TBODY</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/TABLE</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="604">
    <p>Add another row</p>
    <p><code>&lt;td&gt;</code> Create a cell in the table (In the first column 'Tag'), right align the following text in this cell.</p>
    <p>The <code>&lt;h1&gt;</code> tag specifies that the following code should be formatted as defined by the HTML browser as pre-set header 1.</p>
    <p><code>&lt;/h1&gt;</code> Marks the end of the header line</p>
    <p><code>&lt;/table&gt;</code> Denotes the end of the table</p></td></tr><tr><td valign="top" width="100" height="1"><b>Breaks</b></td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain737990'><div>HTML</div><div class='pre-action-link'><span id='copycode737990' class='copy-code' data-index='737990' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre737990' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">hr</span><span class="code-attribute"> </span><span class="code-attribute">size</span><span class="code-keyword">=</span><span class="code-keyword">3</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">br</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1"><code>&lt;hr&gt;</code> places a horizontal rule (line break)
    <p><code>&lt;br&gt;</code> denotes a standard carriage return line break</p></td></tr><tr><td valign="top" width="100" height="19"><b>Lists</b>
    <ul>
      <li>Bulleted
      </li><li>un-ordered
    </li><li>list </li></ul>
    <ol>
      <li>Numbered
      </li><li>ordered
    </li><li>list </li></ol></td><td valign="top" width="400" height="19"><div class='pre-lang' id='premain910210'><div>HTML</div><div class='pre-action-link'><span id='copycode910210' class='copy-code' data-index='910210' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre910210' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">ul</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">li</span><span class="code-keyword">&gt;</span>Bulleted<span class="code-keyword">&lt;</span><span class="code-leadattribute">/li</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">li</span><span class="code-keyword">&gt;</span>un-ordered<span class="code-keyword">&lt;</span><span class="code-leadattribute">/li</span><span class="code-keyword">&gt;</span>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">li</span><span class="code-keyword">&gt;</span>list<span class="code-keyword">&lt;</span><span class="code-leadattribute">/li</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/ul</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="19">These lines demonstrate an HTML un-ordered bulleted list. <code>&lt;ul&gt;</code>
    <p>There is no limit to the number of list items (<code>&lt;li&gt;</code> item <code>&lt;/li&gt;</code>)</p>
    <p>An automatically numbered list (ordered list) is obtained by using the list tags <code>&lt;ol&gt;</code> and <code>&lt;/ol&gt;</code> rather than <code>&lt;ul&gt;</code> and <code>&lt;/ul&gt;</code>.</p>
    <p>(<code>valign=top</code> prevents the text 'Lists: ' from appearing halfway down the cell.)</p></td></tr><tr><td valign="top" width="100" height="56">
    <p><b>Typefaces</b></p>
    <p><font face="Arial" size="2">Arial</font></p><font face="Arial" size="2">
    <p><font face="Roman" size="2">Roman</font></p><font face="Roman" size="2">
    <p><font face="Courier" size="2">Courier</font></p></font></font></td><td valign="top" width="400" height="56"><div class='pre-lang' id='premain426720'><div>HTML</div><div class='pre-action-link'><span id='copycode426720' class='copy-code' data-index='426720' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre426720' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">font</span><span class="code-attribute"> </span><span class="code-attribute">color</span><span class="code-keyword">=</span><span class="code-keyword">green</span><span class="code-attribute">
     </span><span class="code-attribute">face</span><span class="code-keyword">=&#39;</span><span class="code-keyword">courier&#39;</span><span class="code-attribute"> </span><span class="code-attribute">size</span><span class="code-keyword">=</span><span class="code-keyword">6</span><span class="code-keyword">&gt;</span>
Green
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/font</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="56">These lines demonstrate user-defined typefaces using the <code>&lt;font&gt;</code> tag. (N.B. Use American spellings.)
    <p>The example at the base of this page also demonstrates the use of RGB hexadecimal colour coding (#RRGGBB) for specifying non-standard colours.</p></td></tr><tr><td valign="top" width="100" height="241">
    <p><b>Hyperlinks</b></p>
    <p><a id="BookmarkName" name="BookmarkName"></a><a href="/KB/aspnet/Internet_Programming/asp#BookmarkName">bookmark</a></p>
    <p><a href="http://www.codeproject.com/useritems/Internet_Programming.asp" target="_blank">document</a></p>
    <p><a>e-mail</a></p></td><td valign="top" width="400" height="241"><div class='pre-lang' id='premain617290'><div>HTML</div><div class='pre-action-link'><span id='copycode617290' class='copy-code' data-index='617290' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre617290' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">a</span><span class="code-attribute"> </span><span class="code-attribute">href</span><span class="code-keyword">=&#39;</span><span class="code-keyword">http://...#ODBC&#39;</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;</span><span class="code-leadattribute">/a</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">a</span><span class="code-attribute">
  </span><span class="code-attribute">href</span><span class="code-keyword">=&#39;</span><span class="code-keyword">mailto:
  kevleyski@hotmail.com&#39;</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/a</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="241"><code>&lt;a&gt;</code> The first hyperlink (anchor) moves the current document to the specified URL (Uniform Resource Locator), the second generates a new e-mail addressed to myself.
    <p>The <code>href</code> section of both these anchors can be split into several parts for understanding.</p>
    <ol>
      <li><small>Protocol, e.g. <b>http:</b> (HyperText Transfer), <b>mailto:</b> (e-mail), <b>ftp:</b> (File Transfer), <b>telnet:</b> (Remote Login), <b>file:</b> (Local file)</small>
      </li><li><small>Domain Name (for mailto: <a>name@domain</a>)</small>
    </li><li><small>(First example) The anchor name in document (Bookmark) to jump to specified after the hash (<font color="#000080">#) symbol.</font></small><font color="#000080"> </font></li></ol></td></tr><tr><td valign="top" width="100" height="54">
    <p><b>Java Applets</b></p>
    <p><small>&lt;applet id=Object1 codeBase= /examples/&nbsp; JavaExample/ height=110 width=110 align=baseline code= JavaText.class name=" Object1"&gt; &lt;PARAM VALUE="2910" NAME="_cx"&gt; &lt;PARAM VALUE="2910" NAME="_cy"&gt; Example of a simple Java applet that animates text&lt;/applet&gt;</small></p></td><td valign="top" width="400" height="54"><div class='pre-lang' id='premain10854'><div>HTML</div><div class='pre-action-link'><span id='copycode10854' class='copy-code' data-index='10854' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre10854' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">applet</span><span class="code-attribute"> </span><span class="code-attribute">code</span><span class="code-keyword">="</span><span class="code-keyword">JavaText.class"</span><span class="code-attribute">
    </span><span class="code-attribute">codebase</span><span class="code-keyword">="</span><span class="code-keyword">/examples/JavaText"</span><span class="code-attribute">
    </span><span class="code-attribute">width</span><span class="code-keyword">="</span><span class="code-keyword">110"</span><span class="code-attribute"> </span><span class="code-attribute">height</span><span class="code-keyword">="</span><span class="code-keyword">110"</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">param</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">text"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Java"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/applet</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="54"><code>&lt;applet&gt;</code> Include Java applet (.class file) in a web page.
    <p><code>&lt;param&gt;</code> Set a parameter to send to the Java applet.</p></td></tr><tr><td valign="top" width="100" height="37">
    <p><b>ActiveX Controls</b></p>
    <p><small>&lt;object id=Birthday height=110 width=110 align=baseline border=0 classid=" clsid:8E27C92B-1264-101C-8A2F-040224009C02"&gt; &lt;PARAM VALUE="28" NAME="Day"&gt; &lt;PARAM VALUE="05" NAME="Month"&gt; &lt;/object&gt;</small></p></td><td valign="top" width="400" height="37"><div class='pre-lang' id='premain752042'><div>HTML</div><div class='pre-action-link'><span id='copycode752042' class='copy-code' data-index='752042' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre752042' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">object</span><span class="code-attribute"> </span><span class="code-attribute">id</span><span class="code-keyword">="</span><span class="code-keyword">Birthday"</span><span class="code-attribute">
</span><span class="code-attribute">classid</span><span class="code-keyword">="</span><span class="code-keyword">clsid:8E27C92B-
1264-101C-8A2F-040224009C02"</span><span class="code-attribute">
</span><span class="code-attribute">width</span><span class="code-keyword">="</span><span class="code-keyword">110"</span><span class="code-attribute"> </span><span class="code-attribute">height</span><span class="code-keyword">="</span><span class="code-keyword">110"</span><span class="code-attribute">)</span><span class="code-attribute">
  </span><span class="code-attribute">&lt;param</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">Day"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">28"</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">param</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">Month"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">5"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/object</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="37"><code>&lt;object&gt;</code> Include ActiveX control.
    <p>(This example uses the Microsoft Calendar ActiveX Control which has the international <code>class id</code>entification 8E27C92B-1264-101C- 8A2F-040224009C02)</p>
    <p>Similar to Java Applets the parameters are specific to the control, here we define the date 28th May.</p></td></tr><tr><td valign="top" width="100" height="49">
    <p><b>Cascading Style Sheets (CSS)</b></p>
    <p>Style 1</p>
    <p>Style 2</p>
    <p>Re-styled header (h1)</p></td><td width="400" height="49"><div class='pre-lang' id='premain80326'><div>HTML</div><div class='pre-action-link'><span id='copycode80326' class='copy-code' data-index='80326' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre80326' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">style</span><span class="code-keyword">&gt;</span>
  <span class="code-leadattribute">.</span><span class="code-leadattribute">style1</span>
   {<span class="code-attribute">font</span><span class="code-keyword">:</span><span class="code-keyword"> bold 28pt Times,serif</span>;}
  <span class="code-leadattribute">.</span><span class="code-leadattribute">style2</span>
   {<span class="code-attribute">font</span><span class="code-keyword">:</span><span class="code-keyword"> italic 14pt Times,serif</span>;}
  <span class="code-leadattribute">h1</span>
   {<span class="code-attribute">font</span><span class="code-keyword">:</span><span class="code-keyword"> 8pt Arial</span>; <span class="code-attribute">color</span><span class="code-keyword">:</span><span class="code-keyword"> blue</span>}
<span class="code-keyword">&lt;/</span><span class="code-leadattribute">style</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">p</span><span class="code-attribute"> </span><span class="code-attribute">class</span><span class="code-keyword">=&#39;</span><span class="code-keyword">style1&#39;</span><span class="code-keyword">&gt;</span>Style 1<span class="code-keyword">&lt;</span><span class="code-leadattribute">/p</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">p</span><span class="code-attribute"> </span><span class="code-attribute">class</span><span class="code-keyword">=&#39;</span><span class="code-keyword">style2&#39;</span><span class="code-keyword">&gt;</span>Style 2<span class="code-keyword">&lt;</span><span class="code-leadattribute">/p</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">h1</span><span class="code-keyword">&gt;</span>Re-styled header (h1)<span class="code-keyword">&lt;</span><span class="code-leadattribute">/h1</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="49"><code>&lt;style&gt;</code> Styles are used in the same way as we might use styles with a word-processor to set the attributes of various types of text, such as a title.
    <p>User defined styles are set by choosing a name and preceding it with a full stop (.), pre-set styles, (such as <code>&lt;h1&gt;</code> / <code>&lt;p&gt;</code> / <code>&lt;cite&gt;</code> / <code>&lt;strong&gt;</code> / <code>&lt;small&gt;</code>) can be re-defined by using the given name of the style.</p></td></tr><tr><td valign="top" width="100" height="1"><b>Document footer</b></td><td valign="top" width="400" height="1"><div class='pre-lang' id='premain191849'><div>HTML</div><div class='pre-action-link'><span id='copycode191849' class='copy-code' data-index='191849' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre191849' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
 <span class="code-keyword">&lt;</span><span class="code-leadattribute">/body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/html</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1">Specify the end of the body section and the HTML document</td></tr></tbody></table>
  <h3>XML (eXtensible Mark-up Language)</h3>
  <p>So far we have looked at the syntax (grammar) of HTML. However, like all languages, we should also consider the semantics (meaning) of the information we are portraying.</p>
  <p>For example, if text has been marked up in <b>bold</b>, it could be because it has more importance, or it might be because the author wants it to look like that. Similarly, we might use a colored typeface to denote a title, or again it might be personal preference to make the page appear more attractive.</p>
  <p>Essentially, the point of this argument is that if text is desired to be displayed as bold because it is of more importance, then it should be marked up with the logical tag <code>&lt;strong&gt;</code> rather than the physical <code>&lt;b&gt;</code>. Likewise, if a sentence is a title header, then we should consider using a logical tag such as <code>&lt;h1&gt;</code> rather than forcing a style using physical tags such as <code>&lt;font size=6&gt;</code>.</p>
  <p>As mentioned above, we can override existing, and define our own logical tags using cascading style sheets. However, it can look clumsy, e.g., having to repeat tags such as <code>&lt;p class='Style1'&gt;</code>, and for this reason, is often harder for the reader to gain meaning from than not use it at all.</p>
  <p>To tackle this problem, XML, unlike HTML, does not use preset tags so it is entirely up to the author how a page is formatted. The use of nested metadata tags, i.e. information about information, is also introduced. For example, say that we have a piece of information related to this paragraph.</p>
  <p>We might physically mark it up using HTML as follows:</p><div class='pre-lang' id='premain400952'><div> </div><div class='pre-action-link'><span id='copycode400952' class='copy-code' data-index='400952' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre400952' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
&lt;b&gt;Classification number&lt;/b&gt; 1:02:01:13:00                 &lt;br&gt;
&lt;b&gt;Thesaurus entry&lt;/b&gt;       XML                           &lt;br&gt;
&lt;b&gt;Article&lt;/b&gt;               Extensible Markup Language    &lt;br&gt;
&lt;b&gt;URL&lt;/b&gt;                   /dissertation/week2/HTML.html &lt;br&gt;
&lt;b&gt;Bookmark&lt;/b&gt;              XML</pre>
  <p>In XML, we would instead consider the semantics of the information, such as:</p><div class='pre-lang' id='premain835672'><div> </div><div class='pre-action-link'><span id='copycode835672' class='copy-code' data-index='835672' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre835672' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
&lt;Article&gt;
         &lt;Classification&gt;
                         &lt;Level1&gt;                      1             &lt;/Level1&gt;
                         &lt;Level2&gt;                      02            &lt;/Level2&gt;
                         &lt;Level3&gt;                      01            &lt;/Level3&gt;
                         &lt;Level4&gt;                      13            &lt;/Level4&gt;
                         &lt;Level5&gt;                      00            &lt;/Level5&gt;
        &lt;/Classification&gt;
        &lt;Thesaurus&gt;      XML                           &lt;/Thesaurus&gt;
        &lt;Article&gt;        Extensible Markup Language    &lt;/Article&gt;
        &lt;URL&gt;            /dissertation/week2/HTML.html &lt;/URL&gt;
        &lt;Bookmark&gt;       XML                           &lt;/Bookmark&gt;
&lt;/Article&gt;</pre>
  <p>The author is then left to their own devises in writing an XSL (Extended Style Language) style sheet (see <a href="http://www.w3.org/Style/" target="_blank">www.w3.org/Style/</a>) which will correctly format any section marked up as <i>'Article</i>' on a web page back to the original desired HTML format.</p><a name="FORMS"></a>
  <h2>Web Forms</h2>
  <p>Forms are used to pass user input to a web server from an HTML document. You should already be quite familiar with the behavior of the Form controls as they are used extensively in Graphical User Interfaces (GUIs) such as MS Windows, MacOS and X-Windows. (Microsoft ActiveX Controls can also be incorporated into a form to provide additional input types (e.g., Date format) and user input styles.)</p>
  <p>To better understand how forms are actually processed by the web server, set the form action to call the ISAPI example described later. (Try <code>method= "POST"</code> as well as the default "<code>GET</code>" to see the difference in use of the CGI querystring.)</p>

















































  <table id="Table4" cellspacing="0" cellpadding="7" width="600" border="1"><tbody><tr><td valign="top" width="100" height="19"><b>Section</b></td><td valign="top" width="376" height="19"><b>HTML Script</b></td><td valign="top" width="100" height="19"><b>Details</b></td></tr><tr><td valign="top" width="100" height="1"><b>Form handler specification</b></td><td valign="top" width="376" height="1"><div class='pre-lang' id='premain617301'><div>HTML</div><div class='pre-action-link'><span id='copycode617301' class='copy-code' data-index='617301' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre617301' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">form</span><span class="code-attribute">
  </span><span class="code-attribute">action</span><span class="code-keyword">="</span><span class="code-keyword">/examples/ CGIExample/CGIExample.exe"</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1"><code>&lt;form&gt;</code>. This tag specifies that the parameters from the following input controls (up to <code>&lt;/form&gt;</code>) should be passed as parameters (<code>action</code>ed) to the program <i>ISAPIExample.dll</i>. (Covered later.)</td></tr><tr><td valign="top" width="100" height="1"><b>Text Input Box</b>
    <p><code>&lt;input id=" Text1" value= "Text Box" name= textbox&gt;</code></p></td><td valign="top" width="376" height="1"><div class='pre-lang' id='premain10279'><div>HTML</div><div class='pre-action-link'><span id='copycode10279' class='copy-code' data-index='10279' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre10279' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">text"</span><span class="code-attribute"> </span><span class="code-attribute">size</span><span class="code-keyword">="</span><span class="code-keyword">20"</span><span class="code-attribute">
       </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">textbox"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Text Box"</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1"><code>text</code>. This text input box is used to generate the parameter <code>name</code>d <code>textbox</code>. The initial <code>value</code> of the parameter is set to <code>Text Box</code> and the <code>size</code> of the input box is 20 characters wide.</td></tr><tr><td valign="top" width="100" height="18"><b>Password Input Box</b>
    <p><code>&lt;input id=Password1 type= password value= Password name= password&gt;</code></p></td><td valign="top" width="376" height="18"><div class='pre-lang' id='premain20581'><div>HTML</div><div class='pre-action-link'><span id='copycode20581' class='copy-code' data-index='20581' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre20581' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">password"</span><span class="code-attribute">
  </span><span class="code-attribute">size</span><span class="code-keyword">="</span><span class="code-keyword">20"</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">password"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Password"</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="18"><code>password</code>. The password box is implemented in the same way as the text box. Essentially the difference is that any characters entered into the text box are displayed as asterisks (*).</td></tr><tr><td valign="top" width="100" height="33"><b>Multi-line (scrolling) Input Box </b>
    <p><code>&lt;textarea id=Textarea1 name=areabox rows=3&gt; Example of a multiple line input box (Text Area) &lt;/textarea&gt;</code></p></td><td valign="top" width="376" height="33"><div class='pre-lang' id='premain645641'><div>HTML</div><div class='pre-action-link'><span id='copycode645641' class='copy-code' data-index='645641' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre645641' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">textarea</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">areabox"</span><span class="code-attribute"> </span><span class="code-attribute">rows</span><span class="code-keyword">="</span><span class="code-keyword">3"</span><span class="code-attribute"> </span><span class="code-attribute">cols</span><span class="code-keyword">="</span><span class="code-keyword">20"</span><span class="code-keyword">&gt;</span>
 Example of a multiple line input box (Text Area)
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/textarea</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="33"><code>&lt;textarea&gt;</code>. This multiple line input box (or Text Area), generates the parameter named areabox.
    <p>The initial value is set by the text between the start tag and end tag, the size is represented in <code>row</code>s (3) and <code>col</code>umns (20).</p></td></tr><tr><td valign="top" width="100" height="146"><b>Check boxes</b>
    <p><code>&lt;input id=" Checkbox1" type= checkbox value=chosen name=check1&gt; 1 &lt;input id=Checkbox2 type= checkbox value= chosen name=check2&gt; 2 &lt;input id= Checkbox3 type= checkbox CHECKED value= chosen name=check3&gt; 3</code></p></td><td valign="top" width="376" height="146"><div class='pre-lang' id='premain442688'><div>HTML</div><div class='pre-action-link'><span id='copycode442688' class='copy-code' data-index='442688' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre442688' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">checkbox"</span><span class="code-attribute">
  </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">check1"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">chosen"</span><span class="code-keyword">&gt;</span>1
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">checkbox"</span><span class="code-attribute">
  </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">check2"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">chosen"</span><span class="code-keyword">&gt;</span>2
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">checkbox"</span><span class="code-attribute">
  </span><span class="code-attribute">checked</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">check3"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">chosen"</span><span class="code-keyword">&gt;</span>3</pre></td><td valign="top" width="100" height="146"><code>checkbox</code>. These three checkboxes define 3 separate parameters <code>name</code>d <code>check1</code>, <code>check2</code> and <code>check3</code>.
    <p>The <code>value</code> <code>chosen</code> is the value of the parameter if it is checked; if the checkbox is <b>not</b> checked, then the entire parameter is simply <b>not</b> passed to the web server.</p>
    <p>Notice that the third checkbox is specified to be initially <code>checked</code>.</p></td></tr><tr><td valign="top" width="100" height="111"><b>Options (Radio) </b>
    <p><code>&lt;input id=" Radio1" type=radio CHECKED value=1 name= optiongroup&gt; 1 &lt;input id=" Radio2" type=radio value=2 name= optiongroup&gt; 2 &lt;input id="Radio3" type=radio value=3 name= optiongroup&gt; 3</code></p></td><td valign="top" width="376" height="111"><div class='pre-lang' id='premain187476'><div>HTML</div><div class='pre-action-link'><span id='copycode187476' class='copy-code' data-index='187476' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre187476' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">radio"</span><span class="code-attribute">
 </span><span class="code-attribute">checked</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">optiongroup"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">1"</span><span class="code-keyword">&gt;</span>1
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">radio"</span><span class="code-attribute">
 </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">optiongroup"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">2"</span><span class="code-keyword">&gt;</span>2
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">radio"</span><span class="code-attribute">
 </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">optiongroup"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">3"</span><span class="code-keyword">&gt;</span>3</pre></td><td valign="top" width="100" height="111"><code>radio</code>. Unlike checkboxes this radio control defines only 1 parameters <code>name</code>d <code>optiongroup</code>. The <code>value</code> of this parameter depends on the option selected, i.e. 1, 2 or 3.
    <p>Notice that option 1 is the option that is initially chosen (<code>checked</code>).</p></td></tr><tr><td valign="top" width="100" height="127"><b>Options (List)</b>
    <p><code>&lt;select id=Select1 size=1 name =combobox&gt; &lt;option value=1&gt; Option 1&lt;/option&gt; &lt;option value=2&gt; Option 2&lt;/option&gt; &lt;option value=3 selected&gt; Option 3&lt;/option&gt; &lt;option value=4&gt; Option 4&lt;/option&gt; &lt;/select&gt;</code></p></td><td valign="top" width="376" height="127"><div class='pre-lang' id='premain732960'><div>HTML</div><div class='pre-action-link'><span id='copycode732960' class='copy-code' data-index='732960' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre732960' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">select</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">combobox"</span><span class="code-attribute"> </span><span class="code-attribute">size</span><span class="code-keyword">="</span><span class="code-keyword">1"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">1"</span><span class="code-keyword">&gt;</span>Option 1<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">2"</span><span class="code-keyword">&gt;</span>Option 2<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">selected</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">3"</span><span class="code-keyword">&gt;</span>
       Option 3<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">4"</span><span class="code-keyword">&gt;</span>Option 4<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/select</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="127"><code>&lt;select&gt;</code> This control defines a single parameter <code>name</code>d <code>combobox</code>. The <code>value</code> depends on the pre-set option selected from the drop down list. In this example if the user selects 'Option 2' from the list the parameters <code>value</code> is 2.
    <p>(N.B. If we did not specify a <code>value</code> within the <code>&lt;option&gt;</code> tag, the value would have been the string 'Option 2')</p>
    <p>The <code>size</code> parameter of the <code>&lt;select&gt;</code> tag determines whether or not the options are presented as a combo box or a list box, i.e. 1 = Combo Box and &gt;1 = List box of that size.</p>
    <p>The initial option <code>selected</code> here has been set to 'Option 3'</p></td></tr><tr><td valign="top" width="100" height="236"><b>Multiple Options (List)</b>
    <p><code>&lt;select id=Select2 multiple size=4 name= listbox&gt; &lt;option value=1 selected&gt; Option 1&lt;/option&gt; &lt;option value=2&gt; Option 2&lt;/option&gt; &lt;option value=3&gt; Option 3&lt;/option&gt; &lt;option value=4 selected&gt; Option 4&lt;/option&gt; &lt;/select&gt;</code></p></td><td valign="top" width="376" height="236"><div class='pre-lang' id='premain568219'><div>HTML</div><div class='pre-action-link'><span id='copycode568219' class='copy-code' data-index='568219' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre568219' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">select</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">listbox"</span><span class="code-attribute"> </span><span class="code-attribute">multiple</span><span class="code-attribute"> </span><span class="code-attribute">size</span><span class="code-keyword">="</span><span class="code-keyword">4"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">selected</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">1"</span><span class="code-keyword">&gt;</span>Option 1<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">2"</span><span class="code-keyword">&gt;</span>Option 2<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">3"</span><span class="code-keyword">&gt;</span>Option 3<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">selected</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">4"</span><span class="code-keyword">&gt;</span>Option 4<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/select</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="236"><code>multiple</code> When a <code>&lt;select&gt;</code> control is specified as multiple, several parameters all <code>name</code>d <code>listbox</code> are generated depending on the options selected.
    <p>(N.B. A drop down combo box (i.e. size=1) which is set as a multiple selection automatically becomes a list box)</p>
    <p>To make multiple selections click the mouse while holding the ctrl key. (Or hold the shift key to select a group from the previous selected option.)</p></td></tr><tr><td valign="top" width="100" height="88"><b>Buttons</b>
    <p><code>&lt;input id=" Submit1" type=submit value="Submit 1" name=pressed&gt;</code></p>
    <p><code>&lt;input id=" Submit2" type=submit value="Submit 2" name=pressed&gt;</code></p>
    <p><code>&lt;input id=" Image1" type=image height=40 width=125 src= "button.gif" align=" bottom" value="Submit 3" border=0 name= pressed&gt;</code></p>
    <p><code>&lt;input id=Reset1 type=reset value=Reset name=Reset1&gt;</code></p></td><td valign="top" width="376" height="88"><div class='pre-lang' id='premain550972'><div>HTML</div><div class='pre-action-link'><span id='copycode550972' class='copy-code' data-index='550972' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre550972' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">submit"</span><span class="code-attribute">
  </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">pressed"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Submit 1"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">submit"</span><span class="code-attribute">
  </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">pressed"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Submit 2"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">reset"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">image"</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">pressed"</span><span class="code-attribute">
    </span><span class="code-attribute">src</span><span class="code-keyword">="</span><span class="code-keyword">/dissertation/week3/button.gif"</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="88"><code>submit</code> This button type actions the form, i.e. it passes the parameters to the program defined in the <code>&lt;form&gt;</code> tag.
    <p>This example demonstrates how to generate an additional parameter (<code>name</code>d <code>pressed</code>) to distinguish between which button was used to submit the form. However, if we only require one submit button, we can use the condensed form of this statement, <a id="
image" name="image"></a><code>&lt;input type= "submit"&gt;;</code> this also gives the added benefit of enabling the form to be submitted when the user presses the return key.</p>
    <p><code>image</code> The image input type submits a form (as above) however the button face contains an image source rather than a value. When the user clicks on the image two parameters are passed, <code>pressed.x</code> and <code>pressed.y</code> and their respective 'click position' values rather than pre-sets <code>value</code>s as used with the submit buttons above.</p>
    <p><code>reset</code> This button type simply un-does any changes the user may have made to the form by resetting the form controls to their respective initial states.</p></td></tr><tr><td valign="top" width="100" height="88"><b>Hidden</b></td><td valign="top" width="376" height="88"><div class='pre-lang' id='premain933775'><div>HTML</div><div class='pre-action-link'><span id='copycode933775' class='copy-code' data-index='933775' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre933775' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">hidden"</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">somedata"</span><span class="code-attribute">
          </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">UsefulDataYourAppProcesses"</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="88"><code>hidden</code>. Use this to send hidden data, that is, data that is not visible as part of the the form itself but is instead used in the processing of the form, such as identifying the referrer of the form. See <a href="/KB/aspnet/Internet_Programming/asp#.NETBindingExample">ASP.NET</a> databinding section of this document for example of how this is commonly used.</td></tr><tr><td valign="top" width="100" height="1"><b>Close Form Block</b></td><td valign="top" width="376" height="1"><div class='pre-lang' id='premain666156'><div>HTML</div><div class='pre-action-link'><span id='copycode666156' class='copy-code' data-index='666156' style='visibility:hidden'>Copy Code</span></div></div>
    <pre id='pre666156' style='margin-top:0;' class='lang-html' data-language='html' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/form</span><span class="code-keyword">&gt;</span></pre></td><td valign="top" width="100" height="1"><code>&lt;/form&gt;</code>. Denotes end of form.</td></tr></tbody></table><a name="CGI"></a>
  <h2>CGI: The Common Gateway Interface</h2>
  <p>Common Gateway Interface is a specification for creating executable programs (CGI scripts) that can be run by a web server to carry out dynamic tasks such as:</p>
  <ul>
    <li>Security (e.g. User authorization / IP identification / Software identification)
    </li><li>Producing dynamic HTML (e.g. Web site visit counters, Advertising (using the metadata refresh tag), reporting the date/time, etc.)
  </li><li>Querying and updating a database (e.g. Internet Search Engines, Reports). </li></ul>
  <p>CGI scripts are very easy to create using languages that can support standard output to a console, such as C/C++, PASCAL, Visual Basic and <a href="#PERL">Perl (Practical Extraction and Report Language)</a>. The web server handles the programs by passing output from the programs directly to the calling web browser rather than updating the users console (screen / client window).</p>
  <p><a id="Methods" name="Methods"></a><a id="
EnvVars" name="EnvVars"></a>The web server generally passes data to the CGI program (script) via environment variables. The CGI program can then look at environment variables using the same method that is used to get the value of an operating system environment variable, (e.g. MS-DOS %PATH%).</p>
  <p>When environment variables are passed to CGI scripts they are usually sent using one of two methods, GET and POST. The difference between them is essentially that data passed using the GET method, (the default method) is read by the script as command variables (e.g. read via <code>argc</code> and <code>argv[]</code>), and POST data is processed by reading from the standard input. (e.g. read via <code>stdin &gt;&gt;</code>).</p>
  <p>Before we plung into <a href="/KB/aspnet/Internet_Programming/asp#Scripting">CGI Scripting</a> we need to know a little about the most useful of environment variables, the <a href="/KB/aspnet/Internet_Programming/asp#Query">Query String</a> and also the use of <a href="/KB/aspnet/Internet_Programming/asp#MIME">MIME (Multi-purpose Internet Main Extensions)</a>...</p>
  <h3><a id="Query" name="Query"></a>CGI: Query Strings</h3>
  <p>The query string is information that can be passed to a CGI script by a web browser via the <a href="/KB/aspnet/Internet_Programming/asp#DNS">URL</a>. If you have used an Internet search engine, such as Yahoo, you may have noticed odd characters popping up (such as, ?, &amp;, %, +) appearing in site address line of the browser, for example:</p>
  <p>If you start Yahoo (<a href="http://www.yahoo.co.uk/" target="_blank">http://www.yahoo.co.uk/</a>) and search for '<i>Writing CGI Scripts using C++</i> ', the following URL is passed by the browser:</p>
  <p><a href="http://search.yahoo.co.uk/search/ukie?p=Writing+CGI+Scripts+using+C%2B%2B&amp;y=y" target="_blank">http://search.yahoo.co.uk/search/ukie?p=Writing+CGI+Scripts+using+C%2B%2B&amp;y=y</a>.</p>
  <p>What this URL does is action (call/execute) the program <a href="http://search.yahoo.co.uk/search/ukie" target="_blank">ukie</a> located at <a href="http://search.yahoo.co.uk/search" target="_blank">http://search.yahoo.co.uk/search</a> and passed the data <i>p=Writing+CGI+Scripts+using+C%2B%2B&amp;y=y</i> as a query string to the program. (N.B. The first question mark (?) is not included as part of the query string.)</p>
  <p><a id="Parameters" name="Parameters"></a>This extra piece of data can be broken down into two parameters where they are split by the <i>ampersand</i> symbol '&amp;', these are:</p><div class='pre-lang' id='premain395332'><div> </div><div class='pre-action-link'><span id='copycode395332' class='copy-code' data-index='395332' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre395332' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
p=Writing+CGI+Scripts+using+C%2B%2B</pre>
  <p>This first parameter '<i>p</i>' is <i>equal to</i> the original search specification entered 'Writing CGI Scripts using C++'. However, because white space characters are not supported as part of a URL, the HTML form converts the spaces to + symbols; and because + symbols mean spaces, the two + symbols (in C++) are converted to HTML format %2B (the hexadecimal ASCII equivalent for the + symbol). (N.B. The data passed to a CGI script from a URL rather than an HTML form is passed as %20 (the ASCII space character) rather than the + symbol, why?)</p><div class='pre-lang' id='premain2902'><div> </div><div class='pre-action-link'><span id='copycode2902' class='copy-code' data-index='2902' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre2902' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
y=y</pre>
  <p>This second parameter '<i>y</i>' is <i>equal to</i> the search space option flag set by the use radio button control to select 'All Sites' (y=y) or 'UK and Ireland Sites Only' (y=u)</p><a name="MIME"></a>
  <h3>CGI: HTTP MIME Headers (Multi-purpose Internet Mail Extensions)</h3>
  <p>For software, such as a web browsers and e-mail, which are capable of handling several types of information such as plain-text, HTML formatted text and graphic images, we are required to include some additional information which indicates how we desire the content to be processed. Up till this point we have not been required to include this information because it is assumed that information which is passed to a web browser with a file extension of <i>'.HTM</i>' or <i>'.HTML</i>' should be naturally be processed as an HTML document, however CGI programs are passed as raw data by the server rather than documents, so for the web browser to know how to porcess the data from the CGI script we are required to pass an additional piece of information known as a MIME header.</p>
  <p>In the our examples we will be passing HTML formatted text between our web server and browser (client). This requires the following plain-text MIME header:</p><div class='pre-lang' id='premain193537'><div> </div><div class='pre-action-link'><span id='copycode193537' class='copy-code' data-index='193537' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre193537' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
Content-Type: text/html &lt;carriage return&gt;
&lt;carriage return&gt;</pre>
  <p>Without this information a web browser will interpret any output from our CGI script to be plain-text and will either ignore the data or proceed to treat formatting tags as regular text. MIME headers <i>must</i> be the first line in any information being passed to a browser and they <i>must</i> be on their own line and followed by a blank line. (hence the two carriage returns). For more information regarding MIME headers you should refer to the <a href="http://www.ietf.org/rfc/rfc2068.txt" target="_blank">HTTP/1.1 specification</a>.</p>
  <h3><a id="Scripting" name="Scripting"></a>CGI Example</h3>
  <p>CGI 'scripts' can be written using various programming languages (see <a href="/KB/aspnet/Internet_Programming/asp#PERL">PERL</a> example later), however for the sake of compatibility with the code in this document, we will be using C++ for our scripting.</p>
  <p>CGI C++ programs are very simple to create, technicalities such as multiple user file sharing and communications are handled entirely by the web server, so they are similar to conventional C++ console programs (i.e. simple DOS or UNIX programs).</p>
  <p>The following snippet of C++ code simply passes the environment variable QUERY_STRING passed by the web server back to the web browser (client) that called it...</p><div class='pre-lang' id='premain658353'><div></div><div class='pre-action-link'><span id='copycode658353' class='copy-code' data-index='658353' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre658353' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Include the standard C++ classes and Input/Output Stream classes</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;stdlib.h&gt; <span class="code-keyword">&lt;/</span><span class="code-leadattribute">span</span><span class="code-keyword">&gt;</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;iostream.h&gt;<span class="code-keyword">&lt;/</span><span class="code-leadattribute">span</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">void</span> main()
{
    <span class="code-keyword">char</span> *EnvVar = getenv(<span class="code-string">"</span><span class="code-string">QUERY_STRING"</span>);
    <span class="code-comment">//</span><span class="code-comment"> Standard DOS/UNIX environment variable command</span>
    <span class="code-keyword">if</span> (EnvVar == NULL)
        EnvVar = <span class="code-string">"</span><span class="code-string">No+Parameters+Passed"</span>;
        <span class="code-comment">//</span><span class="code-comment"> If there is no query string</span>
        <span class="code-comment">//</span><span class="code-comment"> set the parameter to No Parameter Passed</span>

    cout &lt;&lt; <span class="code-string">"</span><span class="code-string">Content-Type: text/html\n\n"</span>;
    <span class="code-comment">//</span><span class="code-comment"> Write HTTP MIME Header</span>
    cout &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;html&gt;"</span>;
    <span class="code-comment">//</span><span class="code-comment"> Write HTML start tag</span>
    cout &lt;&lt; <span class="code-string">"</span><span class="code-string">Query String: "</span> &lt;&lt; EnvVar;
    <span class="code-comment">//</span><span class="code-comment"> Place the query_string parameter</span>
    <span class="code-comment">//</span><span class="code-comment"> to the console output stream (cout)</span>
    cout &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;/html&gt;"</span>;
    <span class="code-comment">//</span><span class="code-comment"> Write HTML end tag</span>
}</pre>
  <p>When we run this program directly from DOS (or UNIX) the program outputs the expected plain text document back to the console, however when the same program is run through a web server the plain text code is treated as HTML code and the environment string QUERY_STRING is passed back to the web browser as an HTML document.</p><a name="ISAPI"></a>
  <h2>IIS/ISAPI</h2>
  <p>The Internet Server Application Programming Interface can be likened to an advanced form of CGI. CGI works on the principle of executing programs on the server when a client (web browser) requests it.</p>
  <p>There is a major flaw in this principle because each call to the CGI program requires its own <i>individual</i> instance of the program and thus its own memory space on the server. Therefore if 50 clients are all accessing (hitting) the server then 50 separate instances of the CGI program are required and each CGI environment variable needs to be passed to each of the memory spaces allocated. This is a heavy burden and inefficient use of server resources.</p>
  <p>ISAPI programs however work on the principle of Dynamic Link Libraries (DLL's ) which are <i>shared</i> between instances. The draw back to this however is that the programming becomes more complicated because we a required to implement multi-threading in out application. However for our examples we will be using the Microsoft Foundation Classes which hides the multi-threaded work in two classes; <code>CHttpServer</code> and <code>CHttpServerContext</code>.</p>
  <p>For our purposes we will be writing CGI type applications officially known as ISAPI Extensions, however there is another side of this technology known as ISAPI Filters which are are used to intercept information as it is being passed through the web server. This allows us to carry out tasks such as usage logging, user identification and security, etc.</p>
  <p><a id="NSAPI" name="NSAPI"></a>NSAPI (Netscape Server Application Programming Interface) is as the name suggests, the programming interface for Netscape web servers. However Netscape is intending to change its server architecture to use ISAPI. (Microsoft's ActiveX technology.)</p>
  <p>(ISAPI extension DLL's are executed from web pages exactly in the same way that that we execute CGI scripts, i.e. as a hyperlink or actioned from a form.)</p>
  <h3><a id="CHttp" name="CHttp"></a>ISAPI Extensions</h3>
  <p>Among the seven MFC classes related to ISAPI we will be using two specific MFC (Microsoft Foundation) classes which are required to create an ISAPI extension DLL. These are:</p>
  <ul>
    <li><code>CHttpServer</code> - The base class for all ISAPI extensions. This class essentially handles connection between our DLL and the web server.
    </li><li><code>CHttpServerContext</code> - The class object that we pass data to which is used to create our virtual dynamic web page. (Similar to the principle used to pass data from CGI using <code>cout &lt;&lt;</code>.) </li></ul>
  <p>With CGI C++ scripting we were required to manually process the <a href="/KB/aspnet/Internet_Programming/asp#Query">QUERY_STRING</a> environment string to establish which parameters have been passed to the script; with ISAPI C++ programming we can use the far simpler method to do this for us known as parse mapping...</p>
  <h3><a name="ParseMap"></a>ISAPI Parse Mapping (with MFC)</h3>
  <p>A Parse Map is an MFC (Microsoft Foundation Class) macro used to bind (map) a function to a parameter specified in the <a href="/KB/aspnet/Internet_Programming/asp#Query">Query String</a> passed to our DLL. The easiest way to describe parse mapping is by demonstration.</p>
  <p>A parse map is declared in the class <code>CISAPIExampleExtension</code> which is derived from <code>CHttpServer</code>. For example...</p><div class='pre-lang' id='premain727308'><div></div><div class='pre-action-link'><span id='copycode727308' class='copy-code' data-index='727308' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre727308' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> ISAPIExample.h</span>
<span class="code-comment">//</span><span class="code-comment"> Define the class (which inherits CHttpServer),</span>
<span class="code-comment">//</span><span class="code-comment"> declaring the PARSE_MAP and our functions</span>
<span class="code-keyword">class</span> CISAPIExampleExtension : <span class="code-keyword">public</span> CHttpServer
{
<span class="code-keyword">public</span>:
        <span class="code-comment">//</span><span class="code-comment"> Declare PARSE_MAP</span>
        DECLARE_PARSE_MAP()

        <span class="code-comment">//</span><span class="code-comment"> Prototypes for our functions</span>
        <span class="code-keyword">void</span> Example1(CHttpServerContext* pCtxt);
        <span class="code-keyword">void</span> Example2(CHttpServerContext* pCtxt, LPCTSTR Param1,
             LPCTSTR Param2, LPCTSTR Param3, LPCTSTR Param4,
             LPCTSTR Param5, LPCTSTR Param6, LPCTSTR Param7,
             LPCTSTR Param8, LPCTSTR Param9, LPCTSTR Param10);
};

<span class="code-comment">//</span><span class="code-comment"> Parse Map Definition, Used to process</span>
<span class="code-comment">//</span><span class="code-comment"> parameters specified by in the Query String</span>
BEGIN_PARSE_MAP(CISAPIExampleExtension, CHttpServer)

<span class="code-comment">//</span><span class="code-comment"> Handle Example1 that takes no parameters</span>
ON_PARSE_COMMAND(Example1, CISAPIExampleExtension, ITS_EMPTY)

<span class="code-comment">//</span><span class="code-comment"> Handle Example2 that takes upto 10 parameters</span>
<span class="code-comment">//</span><span class="code-comment"> (all parameters are defaulted to have no value</span>
<span class="code-comment">//</span><span class="code-comment"> if they are not submitted)</span>
ON_PARSE_COMMAND(Example2, CISAPIExampleExtension,
         ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR
         ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR)
ON_PARSE_COMMAND_PARAMS(<span class="code-string">"</span><span class="code-string">line1= line2= line3= line4=
         line5= line6= line7= line8= line9= line10="</span>)

<span class="code-comment">//</span><span class="code-comment"> Set the default to Example1 (i.e. execute Example1</span>
<span class="code-comment">//</span><span class="code-comment"> when the query string is empty)</span>
DEFAULT_PARSE_COMMAND(Example1, CISAPIExampleExtension)

END_PARSE_MAP(CISAPIExampleExtension)</pre>
  <p>Essentially this parse map will carry out the following operations depending on the Query String passed to the DLL.</p>
  <p><i>ISAPIExample.dll</i> - No query string specified, so the default function Example1 which takes no parameters is executed (defined by <code>DEFAULT_PARSE_COMMAND</code>).</p>
  <ul>
    <li>ISAPIExample.dll?Example1 - The function Example1 is executed.
    </li><li>ISAPIExample.dll?Example2 - No action (fail), the function Example2 requires parameters.
  </li><li>ISAPIExample.dll?Example2?line1=Hello&amp;line2=World - Parameters line1 and line 2 are passed to the function Example2. The function actually takes 10 text parameters <i>line1..line10</i>, however these have been defined as optional by placing the equals (=) sign after each parameter and giving a default value of NULL. If these parameters were not defined as optional, then the function would fail unless all ten parameters were supplied in the query string. (N.B. The use of two question marks in a query string is not supported in some early versions of some web browsers.).
  </li><li>ISAPIExample.dll?Example2?line13=Fail - No action (fail), the function Example2 does not map a parameter named <i>line13</i>. </li></ul><a name="ODBC"></a>
  <h2>Database connections (ODBC, OLE DB and ADO)</h2>
  <p>Database Management Systems (DBMS), such as MS SQL Server, MySQL and Oracle, were designed to save the software developer the trouble of writing their own code to carry out tasks such as, multiple user file handling, indexing/searching (querying) and data security.</p>
  <p>ODBC is a standard, developed by Microsoft, to bridge the gap between a database such as an SQL database or indeed a simple text file (supported by the MS Jet Engine) and an application (such as Crystal Reports) that abides by the ODBC rules. For the software developer this generic standard is particularly useful when it comes to system portability. For example an application can be written to process a spreadsheet and update a database at the same time essentially using the same coding principles. Another example might be where an application was written to manipulate data in an Excel Worksheet, is upsized to an Oracle Database without the need to make any changes to the software application, likewise if the software application was changed, perhaps from an MS Windows to an Apple Macintosh environment, there would be no need of making changes to the database.</p>
  <p><a id="SAG" name="SAG"></a>The foundations of ODBC are based upon an open standard generated by the SQL Access Group (SAG) which is based on the well know relational database Structured Query Language (SQL) which you should be familiar with.</p>
  <p>Before we can get stuck in with ODBC, OLE DB and ADO, we need to know a little about the principles for establishing a connection to a database.</p>
  <h3><a id="Drivers" name="Drivers"></a><a id="
DSN" name="DSN"></a>Data Source Names (DSN) and Connection Strings</h3>
  <p>To register a database with the ODBC Manager we need to create a unique Data Source Name (DSN) entry. DSN entries vary between different ODBC drivers and details for these will be provided with your database server.</p>
  <p>After creating a DSN entry we can test the connection by using any ODBC application to connect to the database.</p>
  <p>Connections are made by passing a connection string to the ODBC manager which contain information such as the DSN and login details. A connection string to connect to my example MS SQL database is:</p><div class='pre-lang' id='premain371549'><div> </div><div class='pre-action-link'><span id='copycode371549' class='copy-code' data-index='371549' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre371549' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
ODBC;DSN=InternetPAL;UID=sa;PWD=;</pre>
  <p>This string is then processed by the ODBC manager and fills in the missing information, and presents the full ODBC connection string ... e.g.</p><div class='pre-lang' id='premain496513'><div> </div><div class='pre-action-link'><span id='copycode496513' class='copy-code' data-index='496513' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre496513' style='margin-top:0;' data-language='text' data-allowShrink='True' data-collapse='False'>
ODBC;DSN=InternetPAL;UID=sa;PWD=;APP=ODBC
   Test Program;WSID=KEVS;LANGUAGE=us_english;DATABASE=InternetPAL</pre>



























  <table id="Table5" cellspacing="0" cellpadding="7" border="1"><tbody><tr><td colspan="2"><i>ODBC Connection String Parameters:</i></td></tr><tr><td><b>ODBC;</b></td><td>Default <b>ODBC</b> connection string (Actually provided for upward compatibility for future connections)</td></tr><tr><td><b>DSN=InternetPAL</b></td><td><b>D</b>ata <b>S</b>ource <b>N</b>ame</td></tr><tr><td><b>UID=sa;</b></td><td><b>U</b>ser <b>ID</b>entifier <i>('sa' is the default SQL server systems administrator ID)</i></td></tr><tr><td><b>PWD=;</b></td><td><b>P</b>assword <i>(no password required)</i></td></tr><tr><td><b>APP=ODBC Test Program;</b></td><td><b>APP</b>lication Name</td></tr><tr><td><b>WSID=KEVS;</b></td><td><b>W</b>ork<b>S</b>tation <b>ID</b>entifier</td></tr><tr><td><b>LANGUAGE=us_english;</b></td><td>Language</td></tr><tr><td><b>DATABASE=InternetPAL</b></td><td>Database Name</td></tr></tbody></table>
  <p>Using MFC, it is very easy to make an ODBC connection. Essentially, all we need to do is create a database object (<code>CDatabase</code>) and pass the relevant details to the objects class member <code>Open</code> ...</p><div class='pre-lang' id='premain55247'><div></div><div class='pre-action-link'><span id='copycode55247' class='copy-code' data-index='55247' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre55247' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
CDatabase m_database;
m_database.Open(<span class="code-string">"</span><span class="code-string">"</span>, FALSE, TRUE, <span class="code-string">"</span><span class="code-string">ODBC;"</span>, FALSE);</pre>


















  <table id="Table6" cellspacing="0" cellpadding="7" border="1"><tbody><tr><td colspan="2"><i><b>CDatabase::Open Parameters:</b></i></td></tr><tr><td><code>""</code></td><td>DSN Name: "" (NULL) because we are using ODBC connection strings</td></tr><tr><td><code>FALSE</code></td><td>
    <p align="left">Exclusive: We want shared access rather than exclusive (exclusive access is not actually supported anyway!)</p></td></tr><tr><td><code>TRUE</code></td><td>Read Only: We are only querying the data so do not need write access to the database</td></tr><tr><td><code>"ODBC;"</code></td><td>Connection String: Here we are sending the default string</td></tr><tr><td><code>FALSE</code></td><td>Load Cursor Library: We do not require the cursor library (default setting)</td></tr></tbody></table>
  <p>This is the completed example function that generates a connection string from the ODBC dialog boxes and connects to a database...</p><div class='pre-lang' id='premain768164'><div></div><div class='pre-action-link'><span id='copycode768164' class='copy-code' data-index='768164' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre768164' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Open ODBC Connection (opens default connection string &#39;ODBC;&#39;)</span>
<span class="code-keyword">void</span> CODBCTestDoc::OpenOdbc()
{
    m_strConnect = <span class="code-string">"</span><span class="code-string">ODBC;"</span>;
    <span class="code-comment">//</span><span class="code-comment"> Set the default connection string,</span>
    <span class="code-comment">//</span><span class="code-comment"> i.e. no database name/login details</span>
    BeginWaitCursor();
    <span class="code-comment">//</span><span class="code-comment"> Pop up hourglass mouse pointer</span>
    <span class="code-comment">//</span><span class="code-comment"> to show that we are busy connecting</span>

    <span class="code-comment">//</span><span class="code-comment"> Attempt to send connection string to the ODBC manager</span>
    BOOL bRet;
    <span class="code-keyword">try</span>
    {
        bRet = m_database.Open(<span class="code-string">"</span><span class="code-string">"</span>, FALSE, TRUE, m_strConnect, FALSE);
    }

    <span class="code-keyword">catch</span> (CDBException* pe) <span class="code-comment">//</span><span class="code-comment"> Catch ODBC excpetion if there was a problem</span>
    {
        AfxMessageBox(pe-&gt;m_strError);
        <span class="code-comment">//</span><span class="code-comment"> Present user with ODBC Error in a message box</span>
        EndWaitCursor();
        <span class="code-comment">//</span><span class="code-comment"> Change mouse pointer back to normal</span>
        pe-&gt;Delete();
        <span class="code-comment">//</span><span class="code-comment"> Clear up exception pointer memory space</span>
        <span class="code-keyword">return</span>;
        <span class="code-comment">//</span><span class="code-comment"> Exit function</span>
    }

    EndWaitCursor(); <span class="code-comment">//</span><span class="code-comment"> Change mouse pointer back to normal</span>

    <span class="code-comment">//</span><span class="code-comment"> If connection returned OK, then open a recordset</span>
    <span class="code-keyword">if</span> (bRet)
    {
        m_strConnect = m_database.GetConnect();
        <span class="code-comment">//</span><span class="code-comment"> User has selected a new connection string</span>

        CDocument::SetTitle(m_strConnect);
        <span class="code-comment">//</span><span class="code-comment"> Set current document title to this connection string</span>

        OpenRecordset();
        <span class="code-comment">//</span><span class="code-comment"> Call function to open a recordset</span>
    }
}</pre><a name="ODBCRecordSets"></a>
  <h3>Database recordsets</h3>
  <p>Once we have connection to a database we can create a recordset (also traditionally know in the database world as a data rowset).</p>
  <p>There are several types of which have various advantages and disadvantages in use...</p>
  <p><a id="Dynasets" name="Dynasets"></a><b>Dynasets -</b> Allow bi-directional scrolling (MoveNext / MovePrevious). Data content changes can be seen by issuing <code>CRecordset::RefreshRowset</code>. (Sometimes called keyset-driven)</p>
  <p><a id="Snapshot" name="Snapshot"></a><b>Snapshots -</b> Similar to the camera principle in that a photograph of the data is taken. Bi-directional scrolling is still permitted, however data cannot be updated until the recordset is physically closed and then re-opened.</p>
  <p><a id="Dynamic" name="Dynamic"></a><b>Dynamic -</b> Similar to dynaset principle, however changes in record sort order can affect other users. (Not widely supported by DBMS's)</p>
  <p><a id="Forward" name="Forward"></a><b>Forward Only</b> - Recordsets can only be scrolled from the beginning to end, and can only be read from. This has significant speed advantages however we need to close and re-open the recordset to start again.</p>
  <p>Recordsets (<code>CRecordset</code> objects) are produced easily in the following way...</p><div class='pre-lang' id='premain913603'><div></div><div class='pre-action-link'><span id='copycode913603' class='copy-code' data-index='913603' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre913603' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
CRecordset m_pRecordset; <span class="code-comment">//</span><span class="code-comment"> Create recordset object</span>
m_pRecordset = <span class="code-keyword">new</span> CRecordset(&amp;m_database);
<span class="code-comment">//</span><span class="code-comment"> Point recordset to our database object</span>
m_pRecordset-&gt;Open(CRecordset::dynaset,
      <span class="code-string">"</span><span class="code-string">select ... from [Sites]"</span>, CRecordset::readOnly);</pre>
  <blockquote>
    <p><i>and for our stored procedure call...</i></p></blockquote><div class='pre-lang' id='premain507868'><div></div><div class='pre-action-link'><span id='copycode507868' class='copy-code' data-index='507868' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre507868' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
m_pRecordset-&gt;Open(CRecordset::dynaset,
                    <span class="code-string">"</span><span class="code-string">{CALL ODBCTest}"</span>, CRecordset::readOnly);</pre>












  <table id="Table7" cellspacing="0" cellpadding="7" border="1"><tbody><tr><td colspan="2"><code>CRecordset::Open Parameters:</code></td></tr><tr><td><code>CRecordset::dynaset</code></td><td>Recordset type (i.e. ::dynaset / ::snapshot / ::dynamic or ::forwardOnly)</td></tr><tr><td><code>"select ... from [Sites]"</code>
    <blockquote>
      <p><i>and</i></p></blockquote>
    <p><code>"{CALL ODBCTest}"</code></p></td><td>
    <p align="left">SQL Statement to produce recordset. N.B. The SQL statement must return rows for Open to complete, i.e. you cannot pass statements such as CREATE TABLE because they do not return a data rowset.</p></td></tr><tr><td><code>CRecordset::readOnly</code></td><td>Recordset Option (No writing)</td></tr></tbody></table>
  <p>This is the completed example function that creates a dynaset from the query string held in <code>m_strQuery</code>.</p><div class='pre-lang' id='premain570412'><div></div><div class='pre-action-link'><span id='copycode570412' class='copy-code' data-index='570412' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre570412' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Open recordset</span>
<span class="code-keyword">void</span> CODBCTestDoc::OpenRecordset()
{

    <span class="code-comment">//</span><span class="code-comment"> Create a new recordset object a pass the SQL query to it</span>
    CRecordset m_pRecordset;
    m_pRecordset = <span class="code-keyword">new</span> CRecordset(&amp;m_database);
    <span class="code-keyword">try</span>
    {
        <span class="code-keyword">if</span> (m_sp == <span class="code-digit">0</span>)
        <span class="code-comment">//</span><span class="code-comment"> m_sp is our flag to determine if we are sedning</span>
        <span class="code-comment">//</span><span class="code-comment"> a call to a stored procedure or an SQL statement</span>
            m_pRecordset-&gt;Open(CRecordset::dynaset,
                    m_strQuery, CRecordset::readOnly);
                    <span class="code-comment">//</span><span class="code-comment"> Standard SQL Query</span>
        <span class="code-keyword">else</span>
            m_pRecordset-&gt;Open(CRecordset::dynaset,
                 <span class="code-string">"</span><span class="code-string">{CALL "</span> + m_strQuery + <span class="code-string">"</span><span class="code-string">}"</span>, CRecordset::readOnly);
                 <span class="code-comment">//</span><span class="code-comment"> Stored Procedure Call</span>
    }

    <span class="code-keyword">catch</span> (CDBException* pe)
    <span class="code-comment">//</span><span class="code-comment"> Catch ODBC excpetion if there was a problem</span>
    {
        m_bConnected = FALSE;
        <span class="code-comment">//</span><span class="code-comment"> Set flag used test for an opened recordset as closed</span>
        pe-&gt;Delete();
        <span class="code-comment">//</span><span class="code-comment"> Clear up exception pointer memory space</span>
        <span class="code-keyword">return</span>;
        <span class="code-comment">//</span><span class="code-comment"> Exit function</span>
    }

    <span class="code-comment">//</span><span class="code-comment"> Calculate the number of records in the recordset</span>
    <span class="code-keyword">if</span> (!m_pRecordset-&gt;IsBOF())
    <span class="code-comment">//</span><span class="code-comment"> N.B. If the record set is before</span>
    <span class="code-comment">//</span><span class="code-comment"> the Beginning Of File then the file is empty</span>
    {

        <span class="code-keyword">while</span>(!m_pRecordset-&gt;IsEOF())
        <span class="code-comment">//</span><span class="code-comment"> Iterate through the recordset until the End Of File is reached</span>
            m_pRecordset-&gt;MoveNext();
    }

    m_nRowCount = m_pRecordset-&gt;GetRecordCount() + <span class="code-digit">1</span>;
    GetFieldSpecs(); <span class="code-comment">//</span><span class="code-comment"> Get field names and sizes</span>
    UpdateAllViews(NULL); <span class="code-comment">//</span><span class="code-comment"> Update all open documents (i.e. other connections)</span>
    m_bConnected = TRUE; <span class="code-comment">//</span><span class="code-comment"> Set flag used test for an opened recordset as open</span>
}</pre>
  <p>Once we have an operational recordset object, we can then think about doing something with it. The table below contains some of the basic properties of a <code>CRecordset</code> object that you should become familiar with before studying the appendix example ...</p>





























  <table id="Table8" cellspacing="0" cellpadding="7" border="1"><tbody><tr><td colspan="2"><a id="
CRecordsetDataMembers" name="CRecordsetDataMembers"></a><b>Data Members</b></td></tr><tr><td><code>m_pRecordset-&gt;m_nFields&lt;BR&gt;m_pRecordset-&gt;m_nParams</code></td><td valign="top"><code>m_nFields</code>: Number of fields
    <p><code>m_nParams</code>: Number of parameters (For use with stored procedure parameters)</p></td></tr><tr><td colspan="2"><a id="
CRecordsetTests" name="CRecordsetTests"></a><b>Tests</b></td></tr><tr><td><code>m_pRecordset-&gt;IsOpen() </code>
    <p><code>m_pRecordset-&gt;IsBOF()&lt;BR&gt;m_pRecordset-&gt;IsEOF()</code></p>
    <p><code>m_pRecordset-&gt;IsDeleted()</code></p></td><td valign="top"><code>IsOpen</code>: Used to test that a recordset has been opened
    <p><code>IsBOF</code>/<code>EOF</code>: Test to see if we are before the first record (BOF) or after the last record (EOF)</p>
    <p><code>IsDeleted</code>: Used to determine if a recordset has been deleted or changed since its last refresh (e.g. perhaps by another user)</p></td></tr><tr><td colspan="2"><a id="
CRecordsetAdding" name="CRecordsetAdding"></a><b>Adding/Amending Records</b></td></tr><tr><td><code>m_pRecordset-&gt;CanUpdate()</code><i>...if so...</i>
    <p><code>m_pRecordset-&gt;Edit()</code> <i>...or..</i><font color="#000080" size="2"><em>.</em></font></p>
    <p><code>m_pRecordset-&gt;AddNew()</code><font color="#000080" size="3"> </font>...finalised by...</p>
    <p><code>m_pRecordset-&gt;Update()</code></p>
    <p><code>m_pRecordset-&gt;Delete()</code></p></td><td valign="top">Returns true (non-zero) if it is possible to update the recordset
    <p>Edit or Create a new record after the current record. (N.B. Update required to finalise the entry)</p>
    <p>Delete current record (N.B. Record cursor is automatically reset to BOF, i.e. top of record set)</p></td></tr><tr><td colspan="2"><a id="
CRecordsetScrolling" name="CRecordsetScrolling"></a><b>Scrolling</b></td></tr><tr><td><code>m_pRecordset-&gt;CanScroll()</code><font size="3"> </font><i>...if so... </i>
    <p><code>m_pRecordset-&gt;MoveFirst()&lt;BR&gt;m_pRecordset-&gt;MovePrev()&lt;BR&gt;m_pRecordset-&gt;MoveNext()&lt;BR&gt;m_pRecordset-&gt;MoveLast()</code></p></td><td valign="top">Recordset scrolling (First Record, Previous Record, Next Record, Last Record)</td></tr><tr><td colspan="2"><a id="
CRecordsetRefreshing" name="CRecordsetRefreshing"></a><b>Refreshing</b></td></tr><tr><td><code>m_pRecordset-&gt;Requery()</code></td><td valign="top">Re-run the SQL query to update the recordset (N.B. Record cursor is automatically reset to BOF, i.e. top of record set)</td></tr><tr><td><code>m_pRecordset-&gt;Close()</code></td><td>Close Recordset</td></tr></tbody></table><a name="ActiveX"></a>
  <h2>ActiveX and the Component Object Model (COM)</h2>
  <p>The Component Object Model (COM) is the industry standard communications mechanism for executables and dynamic link libraries (DLLs) within the Microsoft Windows and Digital equipment operating systems. Prior to COM, developers who wanted to get porgrams to communicate had a choice of using various ad hoc standards such as DDE (Dynamic Data Exchange), OLE (Object Linking and Embedding) and VBX's (Visual Basic eXtensions). ActiveX is essentially a standard derived from these ad hoc standards and is used to describe the following COM components:</p>
  <h3><a id="Control" name="Control"></a>ActiveX Controls</h3>
  <p>Essentially a control (e.g. <a href="/KB/aspnet/Internet_Programming/asp#FORMS">Form Controls</a>) are used as an interface for input and output of data to an application. ActiveX Controls are derived from the principles behind OLE controls (OCX's) and VBX's to promote a standard way of re-using the code to support controls between applications, and specifically for use over the World Wide Web.</p>
  <p>For software developers it has the benefit that it is platform in-dependent. Controls can be re-used when developing in various environments such as Borland Delphi or Visual Basic and compiled components can be used on Apple and UNIX platforms. (However this technology requires Microsoft products, such as MS Internet Explorer, which has caused some controversy in the software market). Another useful benefit of using ActiveX controls is that their state can be captured and stored in an ActiveX document. The document could be held on an ActiveX Document Server for use perhaps when we are on-line, or we can work with them off-line using any ActiveX enabled software such as MS Word 97.</p>
  <p>N.B. ActiveX Controls can be written using MFC (Microsoft Foundation Classes), however controls that are destined for the web should be written using the ActiveX Template Libraries (ATL) because these libraries have been specifically designed to keep the code size of these controls to the bare minimum.</p><a name="ASP"></a>
  <h2>Active Server Pages (ASP)</h2>
  <p>These are essentially regular HTML documents which contain sections of embedded scripting code that can be be processed by the ISAPI Extension DLL (asp.DLL). The embedded scripting can be written using various methods (such as JavaScript, JScript, PERL) however the default method (and in my opinion, the easiest) is to use Visual Basic Scripting (VBScript). (VBScript is processed by a scripting engine which is in itself a COM/ActiveX component.)</p>
  <p>All tasks carried out by Active Server Pages can be hardcoded using the more efficient <a href="/KB/aspnet/Internet_Programming/asp#ISAPI">ISAPI DLL</a> method, however rather than 're-inventing the wheel' it is worth considering the following additional benefits of using ASP:</p>
  <p><b>Session Management</b> - The World Wide Web is a state-less environment. When a user moves from one web page to another any information which may have been entered by them (perhaps into a form) is lost, i.e. the state of the previous page is not maintained. Anyone (such as myself) who has spent time filling in a form to be told that I have missed out a fax number and is presented with a blank form will know what a pain this can be.</p>
  <p><b>Rapid Development</b>- Active Server Pages are easy to code and have the additional benefit that they are interpreted and thus do not require re-compilation which saves a lot of time in the development stage (however because of this they are not as efficient as <a href="/KB/aspnet/Internet_Programming/asp#ISAPI">ISAPI DLLs</a>). ISAPI DLL's are shared files, therefore any program that links to them, i.e. the web server, is required to be shut down and restarted. This operation can take anything up to about a minute, which is a nuisance in itself, however if the web server is being used for other purposes it would need to be carried out at times when it is not busy. (Which for a large international corporation such as Microsoft, would be very rare). Because Active Server Pages are not compiled we can change them at any time without effecting the server.</p>
  <p>The example below (<i>AXExample.asp</i>) shows an Active Server Page which carries out a similar task to CGIExample and ISAPIExample by adding any number passed in the <a href="#Query">QUERY_STRING</a> environment variable:</p><div class='pre-lang' id='premain385098'><div>VBScript</div><div class='pre-action-link'><span id='copycode385098' class='copy-code' data-index='385098' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre385098' style='margin-top:0;' class='lang-vbscript' data-language='vbscript' data-allowShrink='True' data-collapse='False'>
&lt;%
    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Request the entire query string
</span>    Query = <span class="code-sdkkeyword">Request</span>.QueryString()

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Lists the input parameters into an array
</span>    NumParameters = <span class="code-digit">1</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Create storage for to hold parameters (50 should be sufficient)
</span>    <span class="code-keyword">Dim</span> Param(<span class="code-digit">50</span>)

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Request first parameter
</span>    Param(NumParameters) = <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">num1"</span>)
    <span class="code-keyword">do</span> <span class="code-keyword">while</span> Param(NumParameters) &lt;&gt; <span class="code-string">"</span><span class="code-string">"</span>
        <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Calculate the sum total
</span>        total = total + <span class="code-keyword">Int</span>(Param(NumParameters))

        NumParameters = NumParameters + <span class="code-digit">1</span>

        <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Request the next parameter from the query string (num#)
</span>        Param(NumParameters) =
          <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">num"</span> + <span class="code-keyword">CStr</span>(NumParameters))
    <span class="code-keyword">loop</span>

    NumParameters = NumParameters - <span class="code-digit">1</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Calculate the average (Avoid division by zero)
</span>    <span class="code-keyword">if</span> NumParameters &gt; <span class="code-digit">0</span> <span class="code-keyword">then</span> average = total / NumParameters
<span class="code-pagedirective">%&gt;</span>

&lt;html&gt;

    &lt;body bgcolor=#ffffff&gt;
        &lt;p &gt;&lt;font size=<span class="code-digit">5</span> color=#800080&gt;&lt;b&gt;&lt;i&gt;
            Basic example of an ActiveX <span class="code-sdkkeyword">Server</span> Page
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">i</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">p</span><span class="code-keyword">&gt;</span>
        &lt;font size=2&gt;

            This page has been generated by the web <span class="code-sdkkeyword">server</span> from the page
            &lt;b&gt;AXExample.asp<span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span>. This script splits out
            the QUERY_STRING into it<span class="code-comment">&#39;</span><span class="code-comment">s various parameter components </span>
            <span class="code-keyword">and</span> lists the <span class="code-sdkkeyword">server</span> environment variables. This script also
            demonstrates &lt;i&gt;state<span class="code-keyword">&lt;/</span><span class="code-leadattribute">i</span><span class="code-keyword">&gt;</span> <span class="code-keyword">on</span> a web page
            by calling itself with the original QUERY_STRING +
            the additional parameter submitted with the form <span class="code-keyword">on</span> this page.
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span>
        &lt;hr&gt;
        &lt;font color=#000080 face=<span class="code-comment">&#39;</span><span class="code-comment">Arial&#39;&gt;&lt;strong&gt;</span>

            Command line used to invoke this page
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">strong</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span>&lt;br&gt;&lt;br&gt;
        &lt;small&gt;
            AXExample.asp?&lt;%=Query<span class="code-pagedirective">%&gt;</span>
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">small</span><span class="code-keyword">&gt;</span>&lt;hr&gt;&lt;font color=#000080 face=<span class="code-comment">&#39;</span><span class="code-comment">Arial&#39;&gt;</span>
          &lt;strong&gt;QUERY_STRING Parameters split apart<span class="code-keyword">&lt;/</span><span class="code-leadattribute">strong</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span>

        &lt;form action=<span class="code-comment">&#39;</span><span class="code-comment">AXExample.asp&#39; ID="Form1"&gt;</span>

        &lt;table ID=<span class="code-string">"</span><span class="code-string">Table8"</span>&gt;
            &lt;tr&gt;&lt;th&gt;Parameter<span class="code-keyword">&lt;/</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span>&lt;th&gt;Value<span class="code-keyword">&lt;/</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span>&lt;th&gt;SubTotal<span class="code-keyword">&lt;/</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>

&lt;%
    <span class="code-keyword">for</span> f = <span class="code-digit">1</span> to NumParameters
<span class="code-pagedirective">%&gt;</span>
            &lt;tr&gt;
              &lt;td&gt;
                 num&lt;%=f<span class="code-pagedirective">%&gt;</span>
              <span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span>

              &lt;td&gt;
                &lt;input type=text name=<span class="code-comment">&#39;</span><span class="code-comment">num&lt;%=f%&gt;&#39; </span>
                          value=<span class="code-comment">&#39;</span><span class="code-comment">&lt;%=Param(f)%&gt;&#39; ID="Text1"&gt;</span>
              <span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>
&lt;%
    <span class="code-keyword">next</span>
<span class="code-pagedirective">%&gt;</span>

            &lt;tr&gt;
            &lt;td&gt;&lt;td&gt;&lt;input type=text
                   name=<span class="code-comment">&#39;</span><span class="code-comment">num&lt;%=f%&gt;&#39; ID="Text2"&gt;&lt;/td&gt;</span>
            &lt;td&gt;&lt;input type=submit value=<span class="code-comment">&#39;</span><span class="code-comment">&lt;&lt;&lt; Add parameter&#39; </span>
                    ID=<span class="code-string">"</span><span class="code-string">Submit1"</span> NAME=<span class="code-string">"</span><span class="code-string">Submit1"</span>&gt;<span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>

            <span class="code-keyword">&lt;/</span><span class="code-leadattribute">table</span><span class="code-keyword">&gt;</span>

        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">form</span><span class="code-keyword">&gt;</span>
        &lt;font color=RED&gt;&lt;b&gt;Total
           = &lt;%=total<span class="code-pagedirective">%&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span> (Average = &lt;%=average<span class="code-pagedirective">%&gt;</span>)
    <span class="code-keyword">&lt;/</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;/</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span></pre><a name="ADO"></a>
  <h2>Active Data Objects (ADO)</h2>
  <p>ADO uses similar principles which we met previously in the <a href="/KB/aspnet/Internet_Programming/asp#ODBC">ODBC section</a>. However the underlying structure is based on COM (today .NET) rather standard Dynamic Link Libraries used by ODBC.</p>
  <p>The final result obtained from using ActiveX Data Objects is similar to the principles illustrated by the ISODBCExample. Although this method is less efficient than the ISAPI method (due to the over heads of the interpreter) it is useful for implementing databases which do not support a large number of users.</p>
  <p>The example below (<i>ADOExample.asp</i>) demonstrates how to connect to our example database and produce a report from it.</p><div class='pre-lang' id='premain887505'><div>VBScript</div><div class='pre-action-link'><span id='copycode887505' class='copy-code' data-index='887505' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre887505' style='margin-top:0;' class='lang-vbscript' data-language='vbscript' data-allowShrink='True' data-collapse='False'>
&lt;%
    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Create connection object to InternetPAL database
</span>    <span class="code-keyword">Set</span> Conn = <span class="code-sdkkeyword">Server</span>.<span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">ADODB.Connection"</span>)
    Conn.Open <span class="code-string">"</span><span class="code-string">dsn=InternetPAL;uid=sa;pwd=;"</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Create Recordset object to the stored procedure ISAPIInterface
</span>    <span class="code-keyword">Set</span> RS = <span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">ADODB.Recordset"</span>)
    <span class="code-keyword">Set</span> RS = Conn.Execute(<span class="code-string">"</span><span class="code-string">ISAPIInterface &#39;ListArticles&#39;, &#39;1&#39;"</span>)

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Get database position parameter from the query string
</span>    pos = <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">pos"</span>)
    <span class="code-keyword">if</span> <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">button"</span>) = <span class="code-string">"</span><span class="code-string">First"</span> <span class="code-keyword">then</span> pos = <span class="code-digit">0</span>
    <span class="code-keyword">if</span> <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">button"</span>) = <span class="code-string">"</span><span class="code-string">Previous"</span> <span class="code-keyword">then</span> pos = pos - <span class="code-digit">15</span>
    <span class="code-keyword">if</span> <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">button"</span>) = <span class="code-string">"</span><span class="code-string">Next"</span> <span class="code-keyword">then</span> pos = pos + <span class="code-digit">15</span>
    <span class="code-keyword">if</span> <span class="code-sdkkeyword">Request</span>.QueryString(<span class="code-string">"</span><span class="code-string">button"</span>) = <span class="code-string">"</span><span class="code-string">Last"</span> <span class="code-keyword">then</span>

    pos = <span class="code-digit">0</span>
    <span class="code-keyword">do</span> <span class="code-keyword">while</span> not RS.EOF
        pos = pos + <span class="code-digit">1</span>
        RS.MoveNext
    <span class="code-keyword">loop</span>

    RS.MoveFirst
    pos = pos - <span class="code-digit">7</span>

    <span class="code-keyword">end</span> <span class="code-keyword">if</span>
    query = <span class="code-sdkkeyword">Request</span>.QueryString()
<span class="code-pagedirective">%&gt;</span>

&lt;html&gt;
    &lt;body bgcolor=#ffffff&gt;
        &lt;p &gt;&lt;font size=<span class="code-digit">5</span> color=#800080&gt;&lt;b&gt;&lt;i&gt;
            Basic example of an ActiveX Data Objects
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">i</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">p</span><span class="code-keyword">&gt;</span>

        &lt;font size=2&gt;
            This page has been generated by the web <span class="code-sdkkeyword">server</span> from
            the page &lt;b&gt;ADOExample.asp<span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span>. Command line used
            to invoke this page: ADOExample.asp?&lt;%=Query<span class="code-pagedirective">%&gt;</span>
        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">font</span><span class="code-keyword">&gt;</span>
        &lt;table ID=<span class="code-string">"</span><span class="code-string">Table8"</span>&gt;

            &lt;tr&gt;
                &lt;th&gt;
                <span class="code-keyword">&lt;/</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span>
&lt;%

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Create table header with recordset field names
</span>    <span class="code-keyword">for</span> i = <span class="code-digit">0</span> to RS.Fields.Count - <span class="code-digit">1</span>

<span class="code-pagedirective">%&gt;</span>
                &lt;th align=left&gt;&lt;font color=#800000 face=<span class="code-string">"</span><span class="code-string">Arial"</span> size=2&gt;&lt;u&gt;
                    &lt;%=RS(i).Name <span class="code-pagedirective">%&gt;</span>

                <span class="code-keyword">&lt;/</span><span class="code-leadattribute">u</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">th</span><span class="code-keyword">&gt;</span>
&lt;%
    <span class="code-keyword">next</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Move to offset record
</span>    <span class="code-keyword">for</span> offset = <span class="code-digit">0</span> to pos - <span class="code-digit">9</span>

        <span class="code-keyword">if</span> Not RS.EOF <span class="code-keyword">then</span> RS.MoveNext

    <span class="code-keyword">next</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; If the record position is not at the begin show
</span>    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; that there are previous records with a + symbol
</span>    <span class="code-keyword">if</span> pos &gt; <span class="code-digit">0</span> <span class="code-keyword">then</span>
<span class="code-pagedirective">%&gt;</span>

                <span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>
                &lt;tr&gt;&lt;td&gt;&lt;i&gt;+<span class="code-keyword">&lt;/</span><span class="code-leadattribute">i</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>

                &lt;tr&gt;

&lt;%
    <span class="code-keyword">end</span> <span class="code-keyword">if</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; List 15 records from the open recordset object
</span>    f = <span class="code-digit">0</span>
    <span class="code-keyword">for</span> t = <span class="code-digit">1</span> to <span class="code-digit">15</span>
        <span class="code-keyword">if</span> Not RS.EOF <span class="code-keyword">then</span>
            f = f + <span class="code-digit">1</span>
<span class="code-pagedirective">%&gt;</span>
                &lt;tr&gt;&lt;td&gt;<span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>&lt;tr&gt;
&lt;%
            <span class="code-keyword">for</span> i = <span class="code-digit">0</span> to RS.Fields.Count - <span class="code-digit">1</span>
<span class="code-pagedirective">%&gt;</span>
                &lt;td align=left&gt;&lt;font face=<span class="code-string">"</span><span class="code-string">Arial"</span> size=1&gt;&lt;%=RS(i)<span class="code-pagedirective">%&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span>

&lt;%
            <span class="code-keyword">next</span>
<span class="code-pagedirective">%&gt;</span>
            <span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>
&lt;%
            RS.MoveNext
        <span class="code-keyword">end</span> <span class="code-keyword">if</span>
    <span class="code-keyword">next</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; If there are more recordset then display + symbol
</span>    <span class="code-keyword">if</span> not RS.EOF <span class="code-keyword">then</span>
<span class="code-pagedirective">%&gt;</span>
                &lt;tr&gt;&lt;td&gt;&lt;i&gt;+<span class="code-keyword">&lt;/</span><span class="code-leadattribute">td</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">tr</span><span class="code-keyword">&gt;</span>
&lt;%
    <span class="code-keyword">end</span> <span class="code-keyword">if</span>

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Close the recordset object
</span>    RS.Close

    <span class="code-summarycomment">&#39;&#39;&#39;</span><span class="code-comment">&#39; Close the connection object to the database
</span>    Conn.Close
<span class="code-pagedirective">%&gt;</span>

        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">table</span><span class="code-keyword">&gt;</span>

        &lt;form action=<span class="code-string">"</span><span class="code-string">ADOExample.asp"</span> ID=<span class="code-string">"</span><span class="code-string">Form1"</span>&gt;

            &lt;input type=<span class="code-string">"</span><span class="code-string">submit"</span> name=<span class="code-string">"</span><span class="code-string">button"</span> value=<span class="code-string">"</span><span class="code-string">First"</span> ID=<span class="code-string">"</span><span class="code-string">Submit1"</span>&gt;
            &lt;input type=<span class="code-string">"</span><span class="code-string">submit"</span> name=<span class="code-string">"</span><span class="code-string">button"</span> value=<span class="code-string">"</span><span class="code-string">Previous"</span> ID=<span class="code-string">"</span><span class="code-string">Submit2"</span>&gt;
            &lt;input type=<span class="code-string">"</span><span class="code-string">hidden"</span> name=<span class="code-string">"</span><span class="code-string">pos"</span> value=<span class="code-string">"</span><span class="code-string">&lt;%=pos%&gt;"</span>
                      ID=<span class="code-string">"</span><span class="code-string">Hidden1"</span>&gt;&lt;b&gt;&lt;%=pos<span class="code-pagedirective">%&gt;</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">b</span><span class="code-keyword">&gt;</span>

            &lt;input type=<span class="code-string">"</span><span class="code-string">submit"</span> name=<span class="code-string">"</span><span class="code-string">button"</span> value=<span class="code-string">"</span><span class="code-string">Next"</span> ID=<span class="code-string">"</span><span class="code-string">Submit3"</span>&gt;
            &lt;input type=<span class="code-string">"</span><span class="code-string">submit"</span> name=<span class="code-string">"</span><span class="code-string">button"</span> value=<span class="code-string">"</span><span class="code-string">Last"</span> ID=<span class="code-string">"</span><span class="code-string">Submit4"</span>&gt;

        <span class="code-keyword">&lt;/</span><span class="code-leadattribute">form</span><span class="code-keyword">&gt;</span>

    <span class="code-keyword">&lt;/</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">&lt;/</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span></pre><a name="PERL"></a>
  <h3>ADO/PERL Example: Using ADO to connect to database from a PERL CGI Script</h3>
  <p>Although it is possible to extend our C++ example (CGIExampe) to access a database. There is a far simpler scripting languages known as PERL (Practical Extraction and Report Language) which is particularly good at processing data. It was originally developed by <a href="http://www.activestate.com/" target="_blank">Larry Wall</a> and uses some familiar structures that we have met in the various C++ examples. The example script below produces a report from our <a href="/KB/aspnet/Internet_Programming/asp#InternetPAL">example</a> database.</p><div class='pre-lang' id='premain447031'><div></div><div class='pre-action-link'><span id='copycode447031' class='copy-code' data-index='447031' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre447031' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
# Include the OLE (i.e. ActiveX) libraries
use OLE;

# Write MIME Header <span class="code-keyword">for</span> HTML document
print <span class="code-string">"</span><span class="code-string">Content-type: text/html\n\n"</span>;

print <span class="code-string">"</span><span class="code-string">&lt;html&gt;\n"</span>;

# Create ADO connection <span class="code-keyword">object</span>
$Conn = CreateObject OLE <span class="code-string">"</span><span class="code-string">ADODB.Connection"</span>;
$Conn-&gt;Open(<span class="code-string">"</span><span class="code-string">InternetPAL"</span>);

# Create ADO recordset <span class="code-keyword">object</span>
$RS = $Conn-&gt;Execute(<span class="code-string">"</span><span class="code-string">ISAPIInterface &#39;ListEntries&#39;, &#39;1&#39;"</span>);

# Write field names <span class="code-keyword">in</span> table header
print <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;\n"</span>;
$Count = $RS-&gt;Fields-&gt;count;
<span class="code-keyword">for</span>($i = <span class="code-digit">0</span>; $i &lt; $Count; ++$i)
{
    print <span class="code-string">"</span><span class="code-string"> &lt;th&gt;"</span>, $RS-&gt;Fields($i)-&gt;name , <span class="code-string">"</span><span class="code-string">&lt;/th&gt;\n"</span>;
}
print <span class="code-string">"</span><span class="code-string"> &lt;/tr&gt;\n"</span>;

# Populate table with all records
<span class="code-keyword">while</span>(!$RS-&gt;EOF)
{
    print <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;\n"</span>;
    <span class="code-keyword">for</span> ( $i = <span class="code-digit">0</span>; $i &lt; $Count; $i++ )
    {
        print <span class="code-string">"</span><span class="code-string"> &lt;td&gt;"</span>, $RS-&gt;Fields($i)-&gt;value, <span class="code-string">"</span><span class="code-string">&lt;/td&gt;\n"</span>;
    }
    print <span class="code-string">"</span><span class="code-string"> &lt;/tr&gt;\n"</span>;
    $RS-&gt;MoveNext;
}

# Close ADO Recordset and Connection
$RS-&gt;Close;
$Conn-&gt;Close;

print <span class="code-string">"</span><span class="code-string"> &lt;/table&gt;\n"</span>;
print <span class="code-string">"</span><span class="code-string">&lt;/html&gt;\n"</span>;</pre><a name=".NET"></a>
  <h2>ASP.NET (and the .NET Framework)</h2>
  <p>The 'traditional' ASP with ADO model described above has a slight hang up in that the code is interpreted. This method has a major flaw which is to say it is somewhat inefficient when deployed on a large enterprise scale.</p>
  <p>Developers have tried to skirt some of the problems with interpreted code, such as caching their results etc., however Microsoft has now revised their ASP model significantly so that the embedded source code is now compiled.</p>
  <p>What is rather nice about the way this was achieved is that the original source .aspx pages are compiled into the common IL (Interface Language) exposing the .NET Framework. This makes it very easy for developers to now link and run into any other managed code sources they might have sitting around.</p>
  <p>A useful side-effect to this is we are no longer restricted to Visual Basic scripting and Jscript, any managed code source can be used, for example regular C# code can be directly transferred into an .aspx page.</p>
  <p>For example:</p><div class='pre-lang' id='premain619109'><div>HTML</div><div class='pre-action-link'><span id='copycode619109' class='copy-code' data-index='619109' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre619109' style='margin-top:0;' class='lang-html' data-language='HTML' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">script</span><span class="code-attribute"> </span><span class="code-attribute">language</span><span class="code-keyword">="</span><span class="code-keyword">C#"</span><span class="code-attribute"> </span><span class="code-attribute">runat</span><span class="code-keyword">="</span><span class="code-keyword">server"</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">int</span> nNumber = <span class="code-digit">10</span> * <span class="code-digit">16</span>;
    <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">script</span><span class="code-keyword">&gt;</span>

    <span class="code-keyword">&lt;</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>
        Example of a C# variable nNumber=<span class="code-pagedirective">&lt;%</span>=nNumber%&gt;
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">/body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/html</span><span class="code-keyword">&gt;</span></pre>
  <p>A slight downside to this is that deploying each .aspx program is a little slower, that is, the process of IIS recompiling/linking the sources on first hit is not as speedy as the interpreted model, however the long term benefits far out weigh this slight delay.</p><a name=".NETExample"></a>
  <p>ASP.NET Example: Connecting to a MySQL database using ASP.NET</p>
  <p>Here is an example of a console C# application that connects to MySQL using the freely available MySql ADO .NET Connector.</p><div class='pre-lang' id='premain25624'><div>C#</div><div class='pre-action-link'><span id='copycode25624' class='copy-code' data-index='25624' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre25624' style='margin-top:0;' class='lang-csharp' data-language='cs' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">using</span> System;
<span class="code-keyword">using</span> MySql.Data.MySqlClient;

<span class="code-keyword">public</span> <span class="code-keyword">class</span> Kevs
{
    <span class="code-keyword">protected</span> MySqlConnection sqlConn;

    <span class="code-keyword">private</span> <span class="code-keyword">bool</span> Open(<span class="code-keyword">string</span> strDNS)
    {
        <span class="code-keyword">bool</span> bRetVal = <span class="code-keyword">false</span>;
        <span class="code-keyword">try</span>
        {
            sqlConn = <span class="code-keyword">new</span> MySqlConnection(strDNS);
            sqlConn.Open();
            bRetVal = <span class="code-keyword">true</span>;
        }
        <span class="code-keyword">catch</span> (Exception e)
        {
        }
        <span class="code-keyword">return</span> bRetVal;
    }

    <span class="code-keyword">private</span> <span class="code-keyword">void</span> Close()
    {
        sqlConn.Close();
    }

    <span class="code-keyword">private</span> <span class="code-keyword">void</span> ExecSQL(<span class="code-keyword">string</span> strSQL)
    {
        <span class="code-keyword">try</span>
        {
            MySqlCommand sqlCmd = <span class="code-keyword">new</span> MySqlCommand(strSQL);
            sqlCmd.Connection = sqlConn;
            sqlCmd.ExecuteNonQuery();
        }
        <span class="code-keyword">catch</span> (Exception e)
        {
            System.Console.WriteLine(e.Message);
        }
    }

    <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">void</span> Main()
    {
        Kevs obj = <span class="code-keyword">new</span> Kevs();
        <span class="code-keyword">if</span> (obj.Open(<span class="code-string">"</span><span class="code-string">Database=InternetPAL;Data "</span> +
                     <span class="code-string">"</span><span class="code-string">Source=localhost;User Id=sa;Password="</span>))
        {
            obj.ExecSQL(<span class="code-string">"</span><span class="code-string">AddYourSQLCommandHere&#39;, 0, 0)"</span>);
            obj.Close();
        }
    }
}</pre>
  <p>To convert this code to instead run as an ASP.NET page over the internet is very simple as is can be more or less copy and pasted.</p>
  <p>A more reusable method so that you can use your code in other projects and other .ASPX pages would be to import your managed code library... such as</p><div class='pre-lang' id='premain563289'><div>ASP.NET</div><div class='pre-action-link'><span id='copycode563289' class='copy-code' data-index='563289' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre563289' style='margin-top:0;' class='lang-asp.net' data-language='aspnet' data-allowShrink='True' data-collapse='False'>
<span class="code-pagedirective">&lt;%@</span><span class="code-attribute"> </span><span class="code-leadattribute">Import</span><span class="code-attribute"> </span><span class="code-attribute">namespace</span><span class="code-keyword">="</span><span class="code-keyword">Your.Managed.Code"</span><span class="code-attribute"> </span><span class="code-pagedirective">%&gt;</span></pre>
  <p><i>(or directly from a managed compiled library <i>.dll</i>)</i></p><div class='pre-lang' id='premain86602'><div>ASP.NET</div><div class='pre-action-link'><span id='copycode86602' class='copy-code' data-index='86602' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre86602' style='margin-top:0;' class='lang-asp.net' data-language='aspnet' data-allowShrink='True' data-collapse='False'>
<span class="code-pagedirective">&lt;%@</span><span class="code-attribute"> </span><span class="code-leadattribute">Assembly</span><span class="code-attribute"> </span><span class="code-attribute">src</span><span class="code-keyword">="</span><span class="code-keyword">YourManagedCode.dll"</span><span class="code-attribute"> </span><span class="code-pagedirective">%&gt;</span></pre><a name=".NETBindingExample"></a>
  <h3>ASP.NET Data Binding</h3>
  <p>There are many new features in ASP.NET beyond the scope of this document, however one worthy of mention is databinding. Databinding allows you to code a single .aspx page as if it had some form of internal saved state. In the example below we create an ordinary ASP listbox control and 'bind' the selected item of this listbox using <code>&lt;%# yourBindingVariable%&gt;</code>. (In the example the listbox object property <code>picker.SelectedItem.Text</code> is the bound variable.)</p><div class='pre-lang' id='premain652136'><div>ASP.NET</div><div class='pre-action-link'><span id='copycode652136' class='copy-code' data-index='652136' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre652136' style='margin-top:0;' class='lang-asp.net' data-language='aspnet' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">script</span><span class="code-attribute"> </span><span class="code-attribute">language</span><span class="code-keyword">="</span><span class="code-keyword">C#"</span><span class="code-attribute"> </span><span class="code-attribute">runat</span><span class="code-keyword">="</span><span class="code-keyword">server"</span><span class="code-keyword">&gt;</span>

<span class="code-comment">//</span><span class="code-comment"> Name: kev1.aspx</span>
<span class="code-comment">//</span><span class="code-comment"> Desc: Kev&#39;s C# ASP.NET hi ya</span>
<span class="code-comment">//</span><span class="code-comment"> Author: KJSL</span>
<span class="code-comment">//</span><span class="code-comment"> Copyright (c) Kev 2004</span>

<span class="code-keyword">void</span> kev_Click(<span class="code-sdkkeyword">Object</span> sender, EventArgs e)
{
    Page.DataBind();
}
    <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">script</span><span class="code-keyword">&gt;</span>

    <span class="code-keyword">&lt;</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">form</span><span class="code-attribute"> </span><span class="code-attribute">runat</span><span class="code-keyword">="</span><span class="code-keyword">server"</span><span class="code-attribute"> </span><span class="code-attribute">ID</span><span class="code-keyword">="</span><span class="code-keyword">Form1"</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">asp:DropDownList</span><span class="code-attribute"> </span><span class="code-attribute">id</span><span class="code-keyword">="</span><span class="code-keyword">picker"</span><span class="code-attribute"> </span><span class="code-attribute">runat</span><span class="code-keyword">="</span><span class="code-keyword">server"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">asp:ListItem</span><span class="code-keyword">&gt;</span>Kev<span class="code-keyword">&lt;</span><span class="code-leadattribute">/asp:ListItem</span><span class="code-keyword">&gt;</span>

                <span class="code-keyword">&lt;</span><span class="code-leadattribute">asp:ListItem</span><span class="code-keyword">&gt;</span>Rach<span class="code-keyword">&lt;</span><span class="code-leadattribute">/asp:ListItem</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">asp:ListItem</span><span class="code-keyword">&gt;</span>Someone else<span class="code-keyword">&lt;</span><span class="code-leadattribute">/asp:ListItem</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/asp:DropDownList</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">asp:button</span><span class="code-attribute"> </span><span class="code-attribute">Text</span><span class="code-keyword">="</span><span class="code-keyword">Submit"</span><span class="code-attribute"> </span><span class="code-attribute">OnClick</span><span class="code-keyword">="</span><span class="code-keyword">kev_Click"</span><span class="code-attribute"> </span><span class="code-attribute">runat</span><span class="code-keyword">="</span><span class="code-keyword">server/"</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">/form</span><span class="code-keyword">&gt;</span>

        G&#39;day <span class="code-pagedirective">&lt;%</span># picker.SelectedItem.Text<span class="code-pagedirective">%&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">/body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/html</span><span class="code-keyword">&gt;</span></pre>
  <p>The method employed to do this is quite straight forward, an easy way to see how data binding works is to study the JavaScript that the server generates for the browser client: (the trick of course is supplying a hidden value in the web form.)</p><div class='pre-lang' id='premain17071'><div>HTML</div><div class='pre-action-link'><span id='copycode17071' class='copy-code' data-index='17071' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre17071' style='margin-top:0;' class='lang-html' data-language='HTML' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>

        <span class="code-keyword">&lt;</span><span class="code-leadattribute">form</span><span class="code-attribute"> </span><span class="code-attribute">method</span><span class="code-keyword">="</span><span class="code-keyword">post"</span><span class="code-attribute"> </span><span class="code-attribute">action</span><span class="code-keyword">="</span><span class="code-keyword">example.aspx"</span><span class="code-attribute"> </span><span class="code-attribute">id</span><span class="code-keyword">="</span><span class="code-keyword">ctl00"</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">div</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">hidden"</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">__VIEWSTATE"</span><span class="code-attribute">
  </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">/wEPDwUKMTI5MzYyOTg5Nw9kFgQCAg9kFgICAQ8PDxYCHgtfIURhdGFCb3Vu
         ZGdkZGQCAw8VAQNLZXZkZHUwCgrQcgJvNGiS9QZW7G3q1Ebm"</span><span class="code-attribute"> </span><span class="code-attribute">ID</span><span class="code-keyword">="</span><span class="code-keyword">Hidden1"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/div</span><span class="code-keyword">&gt;</span>

    <span class="code-keyword">&lt;</span><span class="code-leadattribute">select</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">picker"</span><span class="code-attribute"> </span><span class="code-attribute">id</span><span class="code-keyword">="</span><span class="code-keyword">picker"</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">selected</span><span class="code-keyword">="</span><span class="code-keyword">selected"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Kev"</span><span class="code-keyword">&gt;</span>Kev<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>

    <span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Rach"</span><span class="code-keyword">&gt;</span>Rach<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">option</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Someone else"</span><span class="code-keyword">&gt;</span>Someone else<span class="code-keyword">&lt;</span><span class="code-leadattribute">/option</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">&lt;</span><span class="code-leadattribute">/select</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">input</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">submit"</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">ctl01"</span><span class="code-attribute"> </span><span class="code-attribute">value</span><span class="code-keyword">="</span><span class="code-keyword">Submit"</span><span class="code-attribute"> </span><span class="code-attribute">ID</span><span class="code-keyword">="</span><span class="code-keyword">Submit1"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">/form</span><span class="code-keyword">&gt;</span>

    G&#39;day <i>bound_variable_gets_put_in_here</i>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">/body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/html</span><span class="code-keyword">&gt;</span></pre>
  <p>----</p><a name="Appendix"></a>
  <h2>Appendix A: ISAPI example code</h2>
  <p>This is the implementation of the functions Example1 and Example2 (for <i>ISAPIExample.h</i>)</p><div class='pre-lang' id='premain100083'><div></div><div class='pre-action-link'><span id='copycode100083' class='copy-code' data-index='100083' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre100083' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> ISAPIExample.cpp</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;afx.h&gt;<span class="code-keyword">&lt;/</span><span class="code-leadattribute">span</span><span class="code-keyword">&gt;</span>
<span class="code-comment">//</span><span class="code-comment"> Include standard MFC classes</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;afxisapi.h&gt;<span class="code-keyword">&lt;/</span><span class="code-leadattribute">span</span><span class="code-keyword">&gt;</span>
<span class="code-comment">//</span><span class="code-comment"> Include the ISAPI MFC classes</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-string"</span>&gt;<span class="code-string">"</span><span class="code-string">ISAPIExample.h"</span><span class="code-keyword">&lt;/</span><span class="code-leadattribute">span</span><span class="code-keyword">&gt;</span>
<span class="code-comment">//</span><span class="code-comment"> Include our parse map and function prototypes (see above)</span>

<span class="code-comment">//</span><span class="code-comment"> Create the extension object (this is required</span>
<span class="code-comment">//</span><span class="code-comment"> by the web server to establish a handle to our DLL)</span>
CISAPIExampleExtension theExtension;

<span class="code-comment">//</span><span class="code-comment"> Example1: Takes no parameters</span>
<span class="code-keyword">void</span> CISAPIExampleExtension::Example1(CHttpServerContext* pCtxt)
{

    StartContent(pCtxt);
    <span class="code-comment">//</span><span class="code-comment"> Passes the default HTML MIME header to our virtual HTML page</span>
    WriteTitle(pCtxt);
    <span class="code-comment">//</span><span class="code-comment"> Include the default HTML title (You should over-ride</span>
    <span class="code-comment">//</span><span class="code-comment"> this function if you wish to change the title)</span>

    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;body bgcolor=#ffffff&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;p &gt;&lt;font size=5 color=#800080&gt;
           &lt;b&gt;&lt;i&gt;Basic example of ISAPI (Internet
           Server Application Programming Interface)&lt;/i&gt;
           &lt;/b&gt;&lt;/font&gt;&lt;/p&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;This page has been generated by the
           C++ dynamic link library &lt;b&gt;ISAPIExample.dll&lt;/b&gt;
           or &lt;b&gt;ISAPIExample.dll?Example1&lt;/b&gt;.
           &lt;/font&gt;&lt;br&gt;&lt;hr&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;form action=/examples/ISAPIExample/ISAPIExample.dll?
           Example2 method=POST ID="</span>Form1<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;table ID="</span>Table3<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;&lt;input type=text name=line1
           ID="</span>Text1<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;&lt;input type=text name=line2
           ID="</span>Text2<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;&lt;input type=text name=line3
           ID="</span>Text3<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;&lt;input type=submit
           value=&#39;Submit to ISAPIExample.dll?Example2&#39;
           ID="</span>Submit1<span class="code-string">"</span><span class="code-string"> NAME="</span>Submit1<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/table&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/form&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/body&gt;\n"</span>;

    EndContent(pCtxt);              <span class="code-comment">//</span><span class="code-comment"> Close HTML page</span>
}

<span class="code-comment">//</span><span class="code-comment"> Example2: Takes up to 10 named parameters</span>
<span class="code-keyword">void</span> CISAPIExampleExtension::Example2(CHttpServerContext* pCtxt,
     LPCTSTR Param1, LPCTSTR Param2, LPCTSTR Param3, LPCTSTR Param4,
     LPCTSTR Param5, LPCTSTR Param6, LPCTSTR Param7, LPCTSTR Param8,
     LPCTSTR Param9, LPCTSTR Param10)
{
    StartContent(pCtxt);
    WriteTitle(pCtxt);

    CString Param[11] = {Param1, Param2, Param3, Param4, Param5,
            Param6, Param7, Param8, Param9, Param10}, Params = <span class="code-string">"</span><span class="code-string">"</span>;
    <span class="code-keyword">char</span> NumString[20], ParamConversion[20],
         TotConversion[20], *AvgConversion = <span class="code-string">"</span><span class="code-string">"</span>;

    <span class="code-comment">//</span><span class="code-comment"> Create query string</span>
    <span class="code-keyword">int</span> f = <span class="code-digit">0</span>;
    <span class="code-keyword">while</span> (Param[f] &gt; <span class="code-string">"</span><span class="code-string"> "</span> &amp;&amp; f &lt; <span class="code-digit">10</span>)
    {

        itoa(f + <span class="code-digit">1</span>, NumString, <span class="code-digit">10</span>);
        Params = Params + <span class="code-string">"</span><span class="code-string">line"</span> + NumString + <span class="code-string">"</span><span class="code-string">="</span> + Param[f] + <span class="code-string">"</span><span class="code-string">&amp;"</span>;
        f++;

    }

    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;body bgcolor=#ffffff&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;p &gt;&lt;font size=5 color=#800080&gt;
           &lt;b&gt;&lt;i&gt;Example 2: ISAPI function that takes
           several parameters&lt;/i&gt;&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;This page has been generated by the C++
           dynamic link library &lt;b&gt;ISAPIExample.dll?Example2?"</span>
           &lt;&lt; Params
           &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;/b&gt;.&lt;/font&gt;&lt;br&gt;&lt;hr&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;form action=/examples/ISAPIExample/ISAPIExample.dll?
           Example2 method=POST ID="</span>Form2<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;table ID="</span>Table4<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;
    *pCtxt &lt;&lt;
           <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;th&gt;Parameter&lt;/th&gt;
           &lt;th&gt;Value&lt;/th&gt;&lt;th&gt;SubTotal
           &lt;/th&gt;&lt;/tr&gt;\n"</span>;

    <span class="code-comment">//</span><span class="code-comment"> Add up the values of the parameters</span>
    f = <span class="code-digit">0</span>;
    <span class="code-keyword">int</span> total = <span class="code-digit">0</span>;
    <span class="code-keyword">while</span> (Param[f] &gt; <span class="code-string">"</span><span class="code-string"> "</span> &amp;&amp; f &lt; <span class="code-digit">10</span>)
    {

        itoa(f + <span class="code-digit">1</span>, NumString, <span class="code-digit">10</span>);
        itoa(atoi(Param[f]), ParamConversion, <span class="code-digit">10</span>);
        total = total + atoi(Param[f]);
        itoa(total, TotConversion, <span class="code-digit">10</span>);
        *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;line"</span>
               &lt;&lt; NumString &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;/td&gt;&lt;td&gt;&lt;input
               type=text name=&#39;line"</span> &lt;&lt; NumString &lt;&lt; <span class="code-string">"</span><span class="code-string">&#39;
               value=&#39;"</span> &lt;&lt; Param[f]
               &lt;&lt; <span class="code-string">"</span><span class="code-string">&#39; ID="</span>Text4<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;td&gt;&lt;i&gt;"</span>
               &lt;&lt; TotConversion
               &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/td&gt;&lt;td&gt;&lt;small&gt;(Extracted "</span>
               &lt;&lt; ParamConversion
               &lt;&lt; <span class="code-string">"</span><span class="code-string"> from parameter)&lt;/small&gt;&lt;/td&gt;&lt;/tr&gt;"</span>;
        f++;

    }

    <span class="code-comment">//</span><span class="code-comment"> Add another extra parameters (if there are less than 10 parameters)</span>
    <span class="code-keyword">if</span> (f &lt; <span class="code-digit">10</span>)
    {

        itoa(f + <span class="code-digit">1</span>, NumString, <span class="code-digit">10</span>);
        *pCtxt &lt;&lt;
            <span class="code-string">"</span><span class="code-string"> &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;input
            type=text name=&#39;line"</span> &lt;&lt; NumString
            &lt;&lt; <span class="code-string">"</span><span class="code-string">&#39; ID="</span>Text5<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;td&gt;&lt;input
            type=submit value=&#39;&lt;&lt;&lt; Add parameter&#39; ID="</span>Submit2<span class="code-string">"</span><span class="code-string">
            NAME="</span>Submit2<span class="code-string">"</span><span class="code-string">&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;

    }

    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/table&gt;\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/form&gt;\n"</span>;
    itoa(total, TotConversion, <span class="code-digit">10</span>);
    itoa(total / f, AvgConversion, <span class="code-digit">10</span>);
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;font color=RED&gt;&lt;b&gt;Total = "</span>
           &lt;&lt; TotConversion &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;
           (Average = "</span> &lt;&lt; AvgConversion &lt;&lt; <span class="code-string">"</span><span class="code-string">)\n"</span>;
    *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string"> &lt;/body&gt;\n"</span>;

    EndContent(pCtxt);
}</pre>
  <h2>Appendix B: Connecting to a database from ISAPI using ODBC example code</h2>
  <p>This page describes the steps involved in implementing the example ISAPI extension DLL.</p>
  <p>Now that we are familiar with the basics concepts of ODBC and ISAPI we can put the two together to create a program which produced dynamic HTML code from an SQL database.</p>
  <p>One major issue which was missing from this example was how we update the database rather than just querying it. This can be achieved using RFX macros:</p>
  <h3>ISAPI/ODBC Example: Record Field Exchange (RFX)</h3>
  <p>RFX macros (see also <a href="/KB/aspnet/Internet_Programming/asp#ParseMap">parse maps</a>) are used to bind (map) database rowset field data (and stored procedure parameters) to data members in our object derived from <a href="/KB/aspnet/Internet_Programming/asp#ODBCRecordSets">CRecordset</a>.</p>
  <p>To demonstrate RFX I will use an example class <i>CISODBCExample</i> derived from CRecordset.</p>
  <p>The class contains three data members which are arrays of CString objects which have been given the following the following roles:</p>
  <blockquote>
    <p><code>m_Field [6]</code> - Used to hold 6 data fields from the current database record into the 6 subscripts <i>(0..5)</i> of our array.</p>
    <p><code>m_StoredProcParam</code>, and <code>m_Pass [6]</code> - Used to pass 6 parameters <i>(0..5)</i> to the stored procedure defined by m_StoredProcParamas.</p></blockquote><div class='pre-lang' id='premain625708'><div></div><div class='pre-action-link'><span id='copycode625708' class='copy-code' data-index='625708' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre625708' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-keyword">class</span> CISODBCData : <span class="code-keyword">public</span> CRecordset
{

<span class="code-keyword">public</span>:

    <span class="code-comment">//</span><span class="code-comment"> Array of data fields to map to the database</span>
    CString m_Field[6];

    <span class="code-comment">//</span><span class="code-comment"> Array use to pass parameters to a stored procedure in the database</span>
    CString m_StoredProcParam;
    CString m_Pass[6];

    <span class="code-comment">//</span><span class="code-comment"> The mapping changes at runtime,</span>
    <span class="code-comment">//</span><span class="code-comment"> so say that we will use the DYNAMIC MFC macro</span>
    DECLARE_DYNAMIC(CISODBCData)

    <span class="code-comment">//</span><span class="code-comment"> Constructor used to pass a pointer from</span>
    <span class="code-comment">//</span><span class="code-comment"> our CDatabase object to our CRecordset object</span>
    CISODBCData(CDatabase* pDatabase = NULL);

    <span class="code-comment">//</span><span class="code-comment"> Functions used to override the default CRecordset functions</span>
    <span class="code-keyword">virtual</span> CString GetDefaultConnect(); <span class="code-comment">//</span><span class="code-comment"> Overide the default connection string</span>
    <span class="code-keyword">virtual</span> CString GetDefaultSQL(); <span class="code-comment">//</span><span class="code-comment"> Overide the default SQL for our Recordset</span>

    <span class="code-comment">//</span><span class="code-comment"> Function called to exchange data (contains RFX macros)</span>
    <span class="code-keyword">virtual</span> <span class="code-keyword">void</span> DoFieldExchange(CFieldExchange* pFX);

};

<span class="code-comment">//</span><span class="code-comment"> This macro is placed in the implementation file to denote dynamic binding</span>
IMPLEMENT_DYNAMIC(CISODBCData, CRecordset)</pre>
  <p>ISAPI/ODBC Example: Initializing the <code>CISODBCExample</code> object.</p>
  <p>The two <code>CRecordset</code> data members <code>m_nFields</code> and <code>m_nParams</code> must be overridden with the number of fields (6) and the number of parameters (6) respectively. This is done in the constructor that initializes the public <code>CRecordset</code> database data member <i>'pdb</i>'. We also initialize our defined data members with null strings.</p><div class='pre-lang' id='premain592474'><div></div><div class='pre-action-link'><span id='copycode592474' class='copy-code' data-index='592474' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre592474' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Constructor which is used to link to our CDatabase object</span>
CISODBCData::CISODBCData(CDatabase* pdb) : CRecordset(pdb)
{

    <span class="code-comment">//</span><span class="code-comment"> Initialise the array of data fields to map to the database</span>
    m_Field[0] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Field[1] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Field[2] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Field[3] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Field[4] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Field[5] = _T(<span class="code-string">"</span><span class="code-string">"</span>);

    <span class="code-comment">//</span><span class="code-comment"> Number of fields (N.B. This is an overridden CRecordset data member)</span>
    m_nFields = <span class="code-digit">6</span>;

    <span class="code-comment">//</span><span class="code-comment"> Set our recordset type Click here</span>
    <span class="code-comment">//</span><span class="code-comment"> for a description of the snapshot type</span>
    m_nDefaultType = snapshot;

    <span class="code-comment">//</span><span class="code-comment"> Stored Procedure parameter passing variables</span>
    m_StoredProcParam = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[0] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[1] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[2] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[3] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[4] = _T(<span class="code-string">"</span><span class="code-string">"</span>);
    m_Pass[5] = _T(<span class="code-string">"</span><span class="code-string">"</span>);

    <span class="code-comment">//</span><span class="code-comment"> Number of parameters</span>
    <span class="code-comment">//</span><span class="code-comment"> (N.B. This is an overridden CRecordset data member)</span>
    m_nParams = <span class="code-digit">6</span> + <span class="code-digit">1</span>;

}

<span class="code-comment">//</span><span class="code-comment"> Overide the Default ODBC connection string</span>
<span class="code-comment">//</span><span class="code-comment"> (opens database InternetPAL)</span>
CString CISODBCData::GetDefaultConnect()
{

    <span class="code-keyword">return</span> _T(<span class="code-string">"</span><span class="code-string">ODBC;DSN=InternetPAL;UID=sa;PWD="</span>);

}

<span class="code-comment">//</span><span class="code-comment"> Default SQL statement (calls stored procedure ISAPIInterface)</span>
CString CISODBCData::GetDefaultSQL()
{

    <span class="code-comment">//</span><span class="code-comment"> CALL stored procedure. N.B. Require one ? for each parameter passed</span>
    <span class="code-keyword">return</span> _T(<span class="code-string">"</span><span class="code-string">{CALL ISAPIInterface (?, ?, ?, ?, ?, ?, ?)}"</span>);

}</pre>
  <h3>ISAPI/ODBC Example: Binding the database data to our data members using RFX Macros</h3>
  <p>To bind these data members to database fields we use RFX macros in the <code>DoFieldExchange</code> function. For example:</p><div class='pre-lang' id='premain784697'><div></div><div class='pre-action-link'><span id='copycode784697' class='copy-code' data-index='784697' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre784697' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field1"</span>), m_Field[1]); <b><span class="code-comment">//</span><span class="code-comment"> Exchange textual data</b></span></pre>
  <p>The macro <code>RFX_TEXT</code> binds the database rowset field named <i>Field 1</i> to our data member m_Field[1]. What this macro does for us is to help update the data depending on which data member has changed. When we move to another record in the recordset, perhaps using <code>RS.MoveNext</code>, the <code>CString</code> in m_Field[1] is updated with the text data from the database field "Field1" when we call the <code>DoFieldExchange</code> function. Likewise when we change the contents of the data member m_Field[1] it updates the database.</p>
  <p>If the data we are exchanging is not text, then we cannot use the <code>RFX_TEXT</code> macro, we <i>must</i> use one of the other RFX macros depending on the data type required:</p>




























  <table id="Table9" cellspacing="0" cellpadding="7" border="1"><tbody><tr><td><em>Macro to use depending on the database field type</em></td><td><em>Exchanges data with a C++ data member of type</em></td></tr><tr><td><code>RFX_Int</code></td><td><code>int</code></td></tr><tr><td><code>RFX_Long</code></td><td><code>long</code></td></tr><tr><td><code>RFX_Bool</code></td><td><code>bool</code> (<code>true</code> / <code>false</code>)</td></tr><tr><td><code>RFX_Single</code></td><td><code>float</code></td></tr><tr><td><code>RFX_Double</code></td><td><code>double</code></td></tr><tr><td><code>RFX_Binary</code></td><td><code>CByteArray</code></td></tr><tr><td><code>RFX_LongBinary</code></td><td><code>CLongBinary</code> (Used for binary large objects (BLOB's) such as bitmaps)</td></tr><tr><td><code>RFX_Date</code></td><td><code>CTime</code></td></tr></tbody></table><div class='pre-lang' id='premain597391'><div></div><div class='pre-action-link'><span id='copycode597391' class='copy-code' data-index='597391' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre597391' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> RFX Data exchange</span>
<span class="code-keyword">void</span> CISODBCData::DoFieldExchange(CFieldExchange* pFX)
{
        <span class="code-comment">//</span><span class="code-comment"> RFX Bindings for our 6 stored procedure parameters</span>
        pFX-&gt;SetFieldType(CFieldExchange::param);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Report"</span>), m_StoredProcParam);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass1"</span>), m_Pass[1]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass2"</span>), m_Pass[2]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass3"</span>), m_Pass[3]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass4"</span>), m_Pass[4]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass5"</span>), m_Pass[5]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Pass6"</span>), m_Pass[6]);

        <span class="code-comment">//</span><span class="code-comment"> RFX Bindings for the 6 fields in our recordset</span>
        pFX-&gt;SetFieldType(CFieldExchange::outputColumn);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field1"</span>), m_Field[1]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field2"</span>), m_Field[2]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field3"</span>), m_Field[3]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field4"</span>), m_Field[4]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field5"</span>), m_Field[5]);
        RFX_Text(pFX, _T(<span class="code-string">"</span><span class="code-string">Field6"</span>), m_Field[6]);
};</pre>
  <h3>ISAPI/ODBC Example: Connecting to an example ISAPI Extension DLL</h3>
  <p>Once we have established our <code>CRecordset</code> class we can included it directly an ISAPI class derived from <a href="/KB/aspnet/Internet_Programming/asp#ISAPI">CHttpServer</a>. This example displays the rowset generated by the stored procedure <a href="/KB/aspnet/Internet_Programming/asp#ISAPI">ISAPIInterface</a> in the example database '<a href="/KB/aspnet/Internet_Programming/asp#InternetPAL">InternetPAL</a>'. Using the same stored procedure we can add/delete records and update the database by passing a form containing the 6 fields to the procedure.</p>
  <p>The following ISAPI extension code has eleven functions of which the four are directly accessible via the parse map:</p>
  <ol>
    <li><b>Default</b> - About box. (<a href="/KB/aspnet/Internet_Programming/asp#ISODBCExample">ISODBCExample.dll</a>)
    </li><li><b>Open Recordset</b> - Connects to the <a href="/KB/aspnet/Internet_Programming/asp#InternetPAL">InternetPAL</a> database, creates a recordset from the stored procedure <a href="/KB/aspnet/Internet_Programming/asp#ISAPI">ISAPIInterface</a> and executes the show table function. (ISODBCExample.dll?OpenRecordset)
  </li><li><b>Close Recordset</b> - Closes recordset and the connection to the database. (ISODBCExample.dll?CloseRecordset)
  </li><li><b>Show</b> - This function behave differently depending on the value of the parameter <i>'Option'</i> passed to it: </li></ol>
  <ul>
    <li><b>First</b> - Show the first record. (ISODBCExample.dll?Show?Option=First)
    </li><li><b>Prev</b> - Show the previous record. (ISODBCExample.dll?Show?Option=Prev)
  </li><li><b>Next</b> - Show the next record. (ISODBCExample.dll?Show?Option=Next)
  </li><li><b>Last</b> - Show the last record. (ISODBCExample.dll?Show?Option=Last)
  </li><li><b>Current</b> - Show the current record (default option). (ISODBCExample.dll?Show)
  </li><li><b>Table</b> - Show the recordset in a table view. (ISODBCExample.dll?Show?Option=Table)
  </li><li><b>Form</b> - Show the current record in a form view. (ISODBCExample.dll?Show?Option=Form)
  </li><li><b>Edit</b> - Show the current record in an edit form. (ISODBCExample.dll?Show?Option=Edit)
  </li><li><b>New</b> - Show a blank record for adding to the database. (ISODBCExample.dll?Show?Option=New).
  </li><li><b>Delete</b> - Delete the current record (and show first record). (ISODBCExample.dll?Show?Option=Delete)
  </li><li><b>Locate</b> - Show the record where its OID (Object ID) = the parameter option. (ISODBCExample.dll?Show?Option=1 ... ,2,5,20) </li></ul><div class='pre-lang' id='premain609215'><div></div><div class='pre-action-link'><span id='copycode609215' class='copy-code' data-index='609215' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre609215' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Header file: ISODBCExample.h</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-string"</span>&gt;<span class="code-string">"</span><span class="code-string">ISODBCData.h"</span>             <span class="code-comment">//</span><span class="code-comment"> Include database class&lt;/span&gt;</span>
<span class="code-keyword">class</span> CISODBCExample : <span class="code-keyword">public</span> CHttpServer
{
<span class="code-keyword">public</span>:

    CISODBCExample();        <span class="code-comment">//</span><span class="code-comment"> ISAPI Thread Constructor</span>
    ~CISODBCExample();       <span class="code-comment">//</span><span class="code-comment"> ISAPI Thread Destructor (closes database)</span>

    CDatabase db;            <span class="code-comment">//</span><span class="code-comment"> InternetPAL Database Object SQL Database</span>
    TR Field1,  rs;          <span class="code-comment">//</span><span class="code-comment"> Current database Stored Procedure Recordset Object</span>
    CString Previous_repNo;  <span class="code-comment">//</span><span class="code-comment"> Current Stored Procedure report variable</span>
    <span class="code-keyword">int</span> DBView;              <span class="code-comment">//</span><span class="code-comment"> Current database view (1 = Table / 2 = Form View)</span>
    <span class="code-keyword">char</span> DataState;          <span class="code-comment">//</span><span class="code-comment"> Current state of the data (1 = Open / 2 = Closed)</span>

    <span class="code-keyword">void</span> Default(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> OpenRecordset(CHttpServerContext* pCtxt,
         LPCTSTR repNo, LPCTSTR param);
    <span class="code-keyword">void</span> CloseRecordset(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> ShowTable(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> WriteTitle(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> Show(CHttpServerContext* pCtxt, LPCTSTR option);
    <span class="code-keyword">void</span> PutRecord(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> EditRecord(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> NewRecord(CHttpServerContext* pCtxt);
    <span class="code-keyword">void</span> UpdateDB(CHttpServerContext* pCtxt, LPCTSTR Field1,
         LPCTSTR Field2, LPCTSTR Field3, LPCTSTR Field4,
         LPCTSTR Field5, LPCTSTR Field6);
    <span class="code-keyword">void</span> AddToDB(CHttpServerContext* pCtxt, LPCTSTR Field1,
         LPCTSTR Field2, LPCTSTR Field3, LPCTSTR Field4,
         LPCTSTR Field5, LPCTSTR Field6);
    <span class="code-keyword">void</span> DeleteFromDB(CHttpServerContext* pCtxt);

    <span class="code-comment">//</span><span class="code-comment"> Declare the parse map</span>
    DECLARE_PARSE_MAP()
};</pre><div class='pre-lang' id='premain558525'><div></div><div class='pre-action-link'><span id='copycode558525' class='copy-code' data-index='558525' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre558525' style='margin-top:0;' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">//</span><span class="code-comment"> Implementation file: ISODBCExample.cpp</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;afx.h&gt;         <span class="code-comment">//</span><span class="code-comment"> Include the standard MFC classes&lt;/span&gt;</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;afxisapi.h&gt;    <span class="code-comment">//</span><span class="code-comment"> Include the ISAPI MFC classes&lt;/span&gt;</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-keyword"</span>&gt;&lt;afxdb.h&gt;       <span class="code-comment">//</span><span class="code-comment"> Include the MFC Database classes&lt;/span&gt;</span>
#include &lt;span <span class="code-keyword">class</span>=<span class="code-string">"</span><span class="code-string">code-string"</span>&gt;<span class="code-string">"</span><span class="code-string">ISODBCExample.h"</span>     <span class="code-comment">//</span><span class="code-comment"> Include ISAPI extension header&lt;/span&gt;</span>

<span class="code-comment">//</span><span class="code-comment"> Handle to our extension (required by the web server)</span>
CISODBCExample theExtension;

<span class="code-comment">//</span><span class="code-comment"> PARSE MAP, Maps the web browsers URL: ISODBCExample.dll?</span>
<span class="code-comment">//</span><span class="code-comment">&lt;Function&gt;&amp;&lt;Params&gt; to the equivelent</span>
<span class="code-comment">//</span><span class="code-comment"> ISODBCExample.DLL Functions</span>
BEGIN_PARSE_MAP(CISODBCExample, CHttpServer)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?OpenRecordset</span>
    <span class="code-comment">//</span><span class="code-comment">&amp;&lt;Recordset&gt; --&gt; OpenRecordset(Recordset)</span>
    ON_PARSE_COMMAND(OpenRecordset, CISODBCExample, ITS_PSTR ITS_PSTR)
    ON_PARSE_COMMAND_PARAMS(<span class="code-string">"</span><span class="code-string">Recordset=ListEntries Pass1=1"</span>)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?ShowRecord&amp;&lt;option&gt; --&gt; Show(Option)</span>
    ON_PARSE_COMMAND(Show, CISODBCExample, ITS_PSTR)
    ON_PARSE_COMMAND_PARAMS(<span class="code-string">"</span><span class="code-string">Option=Current"</span>)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?CloseRecordset --&gt; CloseRecordset()</span>
    ON_PARSE_COMMAND(CloseRecordset, CISODBCExample, ITS_EMPTY)
    <span class="code-comment">//</span><span class="code-comment"> Close recordset</span>

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?UpdateDB&amp;&lt;Pass1&gt;</span>
    <span class="code-comment">//</span><span class="code-comment"> &amp;&lt;Pass2&gt;&amp;&lt;Pass Parameters ...&gt; --&gt;</span>
    <span class="code-comment">//</span><span class="code-comment"> UpdateDB(Pass Parameters ...)</span>
    ON_PARSE_COMMAND(UpdateDB, CISODBCExample,
       ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR)
       <span class="code-comment">//</span><span class="code-comment"> Update recordset</span>
    ON_PARSE_COMMAND_PARAMS(<span class="code-string">"</span><span class="code-string">Pass1= Pass2= Pass3= Pass4= Pass5= Pass6="</span>)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?AddToDB&amp;&lt;Pass1&gt;</span>
    <span class="code-comment">//</span><span class="code-comment">&amp;&lt;Pass2&gt;&amp;&lt;Pass Parameters ...&gt; --&gt;</span>
    <span class="code-comment">//</span><span class="code-comment"> AddToDB(Pass Parameters ...)</span>
    ON_PARSE_COMMAND(AddToDB, CISODBCExample,
       ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR ITS_PSTR)
       <span class="code-comment">//</span><span class="code-comment"> Add new record to recordset</span>
    ON_PARSE_COMMAND_PARAMS(<span class="code-string">"</span><span class="code-string">Pass1= Pass2= Pass3= Pass4= Pass5= Pass6="</span>)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll?Default --&gt; Default()</span>
    ON_PARSE_COMMAND(Default, CISODBCExample, ITS_EMPTY)

    <span class="code-comment">//</span><span class="code-comment"> URL: ISODBCExample.dll *No parameters* --&gt; Default()</span>
    DEFAULT_PARSE_COMMAND(Default, CISODBCExample)

END_PARSE_MAP(CISODBCExample)

<span class="code-comment">//</span><span class="code-comment"> Thread Constructor</span>
CISODBCExample::CISODBCExample()
{
    DBView = <span class="code-digit">1</span>;
}

<span class="code-comment">//</span><span class="code-comment"> Thread Destructor (Close the recordset</span>
<span class="code-comment">//</span><span class="code-comment"> and database connection if left open)</span>
CISODBCExample::~CISODBCExample()
{
    <span class="code-keyword">if</span> (DataState == <span class="code-digit">1</span>)
    {
        rs.Close();
        db.Close();
    }

}

<span class="code-comment">//</span><span class="code-comment"> DEFAULT, Displays a basic HTML about page</span>
<span class="code-comment">//</span><span class="code-comment"> for the ISODBCExample.DLL program</span>
<span class="code-keyword">void</span> CISODBCExample::Default(CHttpServerContext* pCtxt)
{
    StartContent(pCtxt);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;body bgcolor=#ffffff&gt;\n"</span>);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string"> &lt;p &gt;&lt;font size=5 color=#800080&gt;
                         &lt;b&gt;&lt;i&gt;Example of ISAPI and
                         ODBC&lt;/i&gt;&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;\n"</span>);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string"> ISODBCExample: ISAPI Server Extension
                         which uses ODBC32, Copyright Kevin Staunton-Lambert
                         1997&lt;br&gt;&lt;br&gt;\n"</span>);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}

<span class="code-comment">//</span><span class="code-comment"> OPEN RECORDSET, Connects to the InternetPAL SQL database</span>
<span class="code-comment">//</span><span class="code-comment"> (via ODBC), and sends previous data and the report function</span>
<span class="code-comment">//</span><span class="code-comment"> parameter to the stored procedure ISAPIInterface</span>
<span class="code-keyword">void</span> CISODBCExample::OpenRecordset(CHttpServerContext* pCtxt,
                                 LPCTSTR repNo, LPCTSTR param)
{
    StartContent(pCtxt);
    <span class="code-keyword">if</span> (!DataState)
    {
        <span class="code-keyword">try</span>
        {
            db.OpenEx(_T(<span class="code-string">"</span><span class="code-string">DSN=InternetPAL;UID=sa;PWD="</span>),
                         CDatabase::noOdbcDialog);
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

        rs.m_StoredProcParam = (CString)repNo;
        rs.m_Pass[1] = param;

        <span class="code-comment">//</span><span class="code-comment"> Open the recordset</span>
        <span class="code-keyword">try</span>
        {
            <span class="code-keyword">if</span> (rs.Open(AFX_DB_USE_DEFAULT_TYPE,
                _T(<span class="code-string">"</span><span class="code-string">{CALL ISAPIInterface (?, ?, ?, ?, ?, ?, ?)}"</span>) ,NULL))
            {
                DataState = <span class="code-digit">1</span>;
                <span class="code-comment">//</span><span class="code-comment"> Let other functions know that</span>
                <span class="code-comment">//</span><span class="code-comment"> the recordset is sucessfully open</span>
                Show(pCtxt, <span class="code-string">"</span><span class="code-string">Table"</span>);
                <span class="code-comment">//</span><span class="code-comment"> Initially display the recordset in &#39;Table&#39; view</span>
            }

        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }
    <span class="code-comment">//</span><span class="code-comment"> If there is a recordset is open, close it then try</span>
    <span class="code-comment">//</span><span class="code-comment"> opening the recordset again (using recursion)</span>
    <span class="code-keyword">else</span>
    {
        CloseRecordset(pCtxt);
        OpenRecordset(pCtxt, repNo, <span class="code-string">"</span><span class="code-string">1"</span>);
    }

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);

    <span class="code-comment">//</span><span class="code-comment"> Update the global report identifier</span>
    Previous_repNo = repNo;
}

<span class="code-comment">//</span><span class="code-comment"> CLOSE RECORDSET, If a recordset is open this function closes</span>
<span class="code-comment">//</span><span class="code-comment"> the recordset and database connection</span>
<span class="code-keyword">void</span> CISODBCExample::CloseRecordset(CHttpServerContext* pCtxt)
{
    StartContent(pCtxt);
    <span class="code-keyword">if</span> (DataState == <span class="code-digit">1</span>)
    {
        DataState = <span class="code-digit">0</span>;
        <span class="code-keyword">try</span>
        {
            rs.Close();
            db.Close();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }
    <span class="code-keyword">else</span>
        *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string">Error: Recordset already closed\n"</span>;

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}

<span class="code-comment">//</span><span class="code-comment"> Overide the default CHttpServerContext::WriteTitle</span>
<span class="code-keyword">void</span> CISODBCExample::WriteTitle(CHttpServerContext* pCtxt)
{
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;head&gt;&lt;title&gt;ISODBC Example
                        &lt;/title&gt;&lt;/head&gt;\n"</span>);
}

<span class="code-comment">//</span><span class="code-comment"> SHOW TABLE, Displays a recordset as a table</span>
<span class="code-comment">//</span><span class="code-comment"> (Uses current recordsets memory space)</span>
<span class="code-keyword">void</span> CISODBCExample::ShowTable(CHttpServerContext* pCtxt)
{
    CODBCFieldInfo Field;
    <span class="code-keyword">int</span> i = <span class="code-digit">1</span>, f = <span class="code-digit">1</span>;
    CString TempField, TempOID;
    TempOID = rs.m_Field[1];

    <span class="code-comment">//</span><span class="code-comment"> Generate table header</span>
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;table border=\"0\" ID="</span>Table8<span class="code-string">"</span><span class="code-string">&gt;&lt;thead&gt;
                        &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;b&gt;\n"</span>);
    <span class="code-keyword">for</span> (f = <span class="code-digit">2</span>; f &lt;= (<span class="code-keyword">int</span>)rs.m_nFields; f++)
    <span class="code-comment">//</span><span class="code-comment"> Hide first coulmn (OID) from table</span>
    {
        <span class="code-comment">//</span><span class="code-comment"> Attempt to get the Recordsets field names (Show any ODBC exceptions)</span>
        <span class="code-keyword">try</span>
        {
            rs.GetODBCFieldInfo(f - <span class="code-digit">1</span>, Field);
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

        <span class="code-comment">//</span><span class="code-comment"> Show Recordset&#39;s field names</span>
        *pCtxt
          &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;TH align=LEFT&gt;&lt;font color=#800000
                       face=\"Arial\" size=2&gt;&lt;U&gt;"</span>)
          &lt;&lt; _T(Field.m_strName) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/U&gt;&lt;/th&gt;\n"</span>);
    }

    <span class="code-comment">//</span><span class="code-comment"> Scroll back 10 records to show records at top of page.</span>
    <span class="code-comment">//</span><span class="code-comment"> (Show &#39;+&#39; if not at top of recordset)</span>
    <span class="code-keyword">for</span> (f = <span class="code-digit">1</span>; f &lt; <span class="code-digit">10</span> &amp;&amp; !rs.IsBOF(); f++)
    {
        <span class="code-keyword">try</span>
        {
            rs.MovePrev();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-keyword">if</span> (!rs.IsBOF())
        *pCtxt
          &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td&gt;&lt;i&gt;+&lt;/td&gt;&lt;/tr&gt;\n"</span>);
    <span class="code-keyword">else</span>
    {
        <span class="code-keyword">try</span>
        {
            rs.MoveNext(); <span class="code-comment">//</span><span class="code-comment"> Prevents the first record being displayed twice</span>
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Generate table rows (Display only 25 records from the current recordset)</span>
    <span class="code-keyword">while</span> (i &lt; <span class="code-digit">25</span> &amp;&amp; !rs.IsEOF())
    {
        *pCtxt
          &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/tr&gt;&lt;/b&gt;&lt;/thead&gt;&lt;font face=Arial size=1&gt;\n"</span>);
        <span class="code-comment">//</span><span class="code-comment"> Highlight current record (or records if the recordset</span>
        <span class="code-comment">//</span><span class="code-comment"> doen not have unique object ID&#39;s)</span>
        <span class="code-keyword">if</span> (TempOID == rs.m_Field[1])
            *pCtxt
              &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;TR BGcolor=#00FFFF&gt;&lt;td&gt;&lt;b&gt;&gt;&lt;/td&gt;\n"</span>);
        <span class="code-keyword">else</span>
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td&gt;&lt;/td&gt;\n"</span>);

        <span class="code-comment">//</span><span class="code-comment"> Show Recordset&#39;s data fields</span>
        <span class="code-keyword">for</span> (f = <span class="code-digit">2</span>; f &lt;= (<span class="code-keyword">int</span>)rs.m_nFields; f++)
        <span class="code-comment">//</span><span class="code-comment"> Hide first coulmn (OID) from table</span>
            *pCtxt
              &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;td align=left&gt;&lt;font face=\"Arial\" size=1&gt;"</span>)
              &lt;&lt; _T(rs.m_Field[f]) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/td&gt;\n"</span>);
        *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/tr&gt;\n"</span>);

        <span class="code-keyword">try</span>
        {
            rs.MoveNext();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        i++;
    }

    <span class="code-comment">//</span><span class="code-comment"> Show &#39;+&#39; if there are more records to come</span>
    <span class="code-keyword">if</span> (!rs.IsEOF()) *pCtxt
      &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td&gt;&lt;i&gt;+&lt;/td&gt;&lt;/tr&gt;\n"</span>);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/font&gt;&lt;/table&gt;\n"</span>);

    <span class="code-comment">//</span><span class="code-comment"> Place user back where they were in the recordset</span>
    <span class="code-keyword">try</span>
    {
        rs.MoveFirst();
    }
    <span class="code-keyword">catch</span>(CDBException* e)
    {
        *pCtxt &lt;&lt; e-&gt;m_strError;
        <span class="code-keyword">return</span>;
    }

    <span class="code-keyword">while</span> (!rs.IsEOF() &amp;&amp; rs.m_Field[1] != TempOID)
    {
        <span class="code-keyword">try</span>
        {
            rs.MoveNext();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }
}

<span class="code-comment">//</span><span class="code-comment"> PUT RECORD, Displays a record in &#39;Form&#39; view</span>
<span class="code-keyword">void</span> CISODBCExample::PutRecord(CHttpServerContext* pCtxt)
{
    CODBCFieldInfo Field;
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;body bgcolor=#ffffff&gt;\n"</span>);

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;table ID="</span>Table9<span class="code-string">"</span><span class="code-string">&gt;\n"</span>);
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> f = <span class="code-digit">2</span>; f &lt;= (<span class="code-keyword">int</span>)rs.m_nFields; f++)
    {
        <span class="code-comment">//</span><span class="code-comment"> Attempt to get the Recordsets field names (Show any ODBC exceptions)</span>
        <span class="code-keyword">try</span>
        {
            rs.GetODBCFieldInfo(f - <span class="code-digit">1</span>, Field);
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

        <span class="code-comment">//</span><span class="code-comment"> Show fields (Hide NULL fields)</span>
        <span class="code-keyword">if</span> (Field.m_strName &gt; <span class="code-string">"</span><span class="code-string">"</span>)
        {
            <span class="code-comment">//</span><span class="code-comment"> Show field name</span>
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td align=right&gt;
                                &lt;font color=#800000 face=\"Arial\" size=2&gt;"</span>)
                   &lt;&lt; _T(Field.m_strName) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">\n"</span>);

            <span class="code-comment">//</span><span class="code-comment"> Show data field</span>
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">: &lt;/td&gt;&lt;td align=left&gt;
                                 &lt;font color=#000000 face=\"Arial\" size=2&gt;"</span>)
                   &lt;&lt; _T(rs.m_Field[f]) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/td&gt;&lt;/tr&gt;\n"</span>);
        }
    }
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/font&gt;&lt;/table&gt;\n"</span>);
}

<span class="code-comment">//</span><span class="code-comment"> EDIT RECORD, Displays a record in &#39;Edit&#39; mode</span>
<span class="code-keyword">void</span> CISODBCExample::EditRecord(CHttpServerContext* pCtxt)
{
    CODBCFieldInfo Field;
    <span class="code-comment">//</span><span class="code-comment"> Create an ODBC field information object</span>
    char* TempStr = <span class="code-string">"</span><span class="code-string">"</span>;
    <span class="code-comment">//</span><span class="code-comment"> Temporary variable used when converting integers to strings</span>

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;form action=&#39;/examples/ISODBCExample/
                        ISODBCExample.dll?UpdateDB&#39;
                        method=post ID="</span>Form1<span class="code-string">"</span><span class="code-string">&gt;\n"</span>);

    <span class="code-comment">//</span><span class="code-comment"> Pass OID to the stored procedure but keep it hidden from user</span>
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;input name=&#39;Pass1&#39; type=hidden value=&#39;"</span>)
           &lt;&lt; _T(rs.m_Field[1])
           &lt;&lt; <span class="code-string">"</span><span class="code-string">&#39; ID="</span>Hidden1<span class="code-string">"</span><span class="code-string">&gt;&lt;table ID="</span>Table10<span class="code-string">"</span><span class="code-string">&gt;\n"</span>;

    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> f = <span class="code-digit">2</span>; f &lt;= (<span class="code-keyword">int</span>)rs.m_nFields; f++)
    {
        <span class="code-comment">//</span><span class="code-comment"> Attempt to get the Recordsets</span>
        <span class="code-comment">//</span><span class="code-comment"> field names (Show any ODBC exceptions)</span>
        <span class="code-keyword">try</span>
        {
            rs.GetODBCFieldInfo(f - <span class="code-digit">1</span>, Field);
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

        <span class="code-comment">//</span><span class="code-comment"> Show fields (Hide NULL fields)</span>
        <span class="code-keyword">if</span> (Field.m_strName &gt; <span class="code-string">"</span><span class="code-string">"</span>)
        {
            <span class="code-comment">//</span><span class="code-comment"> Show field name</span>
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td align=right&gt;
                                &lt;font color=#800000 face=\"Arial\" size=2&gt;"</span>)
                  &lt;&lt; _T(Field.m_strName) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">:&lt;/td&gt;\n"</span>);
            <span class="code-comment">//</span><span class="code-comment"> Show input box HTML: INPUT name=Pass&lt;FieldNo&gt;</span>
            <span class="code-comment">//</span><span class="code-comment"> type=text value=&lt;data field&gt;</span>

            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;td&gt;&lt;input name=&#39;Pass"</span>);
            itoa(f, TempStr, <span class="code-digit">10</span>); <span class="code-comment">//</span><span class="code-comment"> Convert field number to string</span>
            *pCtxt &lt;&lt; _T((CString)*TempStr);
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&#39; type=text value=&#39;"</span>);
            *pCtxt &lt;&lt; _T(rs.m_Field[f])
                   &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&#39;&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>);
        }

    }
    <span class="code-comment">//</span><span class="code-comment"> Show a &#39;submit&#39; button that POST&#39;s the updated form</span>
    <span class="code-comment">//</span><span class="code-comment"> to the ISODBCExample.dll?UpdateDB function</span>
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/font&gt;&lt;tr&gt;&lt;td&gt;
                        &lt;input type=submit value=&#39;Update Record&#39;&gt;
                        &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;\n"</span>);
}

<span class="code-comment">//</span><span class="code-comment"> NEW RECORD, Displays a record in &#39;New&#39; record mode</span>
<span class="code-keyword">void</span> CISODBCExample::NewRecord(CHttpServerContext* pCtxt)
{
    CODBCFieldInfo Field;
    char* TempStr = <span class="code-string">"</span><span class="code-string">"</span>;

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;body bgcolor=#ffffff&gt;\n"</span>);

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;form action=&#39;/examples/ISODBCExample/
                        ISODBCExample.dll?AddToDB&#39; method=post&gt;\n"</span>);

    <span class="code-comment">//</span><span class="code-comment"> Copy Field1 as Pass1 field. (Unique object ID&#39;s</span>
    <span class="code-comment">//</span><span class="code-comment"> are automatically generated by the SQL Database)</span>
    *pCtxt
         &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;input name=&#39;Pass1&#39; type=hidden value=&#39;"</span>)
         &lt;&lt; _T(rs.m_Field[1]) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&#39;&gt;&lt;table&gt;\n"</span>);

    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> f = <span class="code-digit">2</span>; f &lt;= (<span class="code-keyword">int</span>)rs.m_nFields; f++)
    {
        <span class="code-comment">//</span><span class="code-comment"> Attempt to get the Recordsets field names</span>
        <span class="code-comment">//</span><span class="code-comment"> (Show any ODBC exceptions)</span>
        <span class="code-keyword">try</span>
        {
            rs.GetODBCFieldInfo(f - <span class="code-digit">1</span>, Field);
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        <span class="code-comment">//</span><span class="code-comment"> Show fields (Hide NULL fields)</span>
        <span class="code-keyword">if</span> (Field.m_strName &gt; <span class="code-string">"</span><span class="code-string">"</span>)
        {
            <span class="code-comment">//</span><span class="code-comment"> Show field name</span>
            *pCtxt
              &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;tr&gt;&lt;td align=right&gt;
                    &lt;font color=#800000 face=\"Arial\" size=2&gt;"</span>)
             &lt;&lt; _T(Field.m_strName) &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">: "</span>);
            <span class="code-comment">//</span><span class="code-comment"> Show input box HTML: INPUT name=Pass&lt;FieldNo&gt;</span>
            <span class="code-comment">//</span><span class="code-comment"> type=text value=NULL (New data)</span>
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;input name=&#39;Pass"</span>);
            itoa(f, TempStr, <span class="code-digit">10</span>);
            *pCtxt &lt;&lt; _T((CString)*TempStr);
            *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&#39; type=text&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>);
        }
    }
    <span class="code-comment">//</span><span class="code-comment"> Show a &#39;submit&#39; button that POST&#39;s the new form</span>
    <span class="code-comment">//</span><span class="code-comment"> to the ISODBCExample.dll?AddToDB function</span>
    *pCtxt
      &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/font&gt;&lt;tr&gt;&lt;td&gt;&lt;input
                   type=submit value=&#39;Update Record&#39;&gt;&lt;/td&gt;&lt;/tr&gt;
                   &lt;/table&gt;&lt;/form&gt;"</span>);
}

<span class="code-comment">//</span><span class="code-comment"> SHOW RECORD, Multi purpose function which</span>
<span class="code-comment">//</span><span class="code-comment"> controls various aspects of a recordset</span>
<span class="code-keyword">void</span> CISODBCExample::Show(CHttpServerContext* pCtxt, LPCTSTR option)
{
    StartContent(pCtxt);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;body bgcolor=#ffffff&gt;\n"</span>);
    *pCtxt
      &lt;&lt; _T(<span class="code-string">"</span><span class="code-string"> &lt;p &gt;&lt;font size=5 color=#800080&gt;
                    &lt;b&gt;&lt;i&gt;Example of ISAPI and ODBC&lt;/i&gt;
                    &lt;/b&gt;&lt;/font&gt;&lt;/p&gt;\n"</span>);
    *pCtxt
      &lt;&lt; _T(<span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;This page has been generated
                    by the ISAPI extension DLL &lt;b&gt;ISODBCExample.dll&lt;/b&gt;.
                    This program allows viewing and updation of articles found
                    in the InternetPAL database.&lt;/font&gt;&lt;br&gt;&lt;hr&gt;\n"</span>);

    CString opt = option, TempOID = rs.m_Field[1];
    <span class="code-keyword">if</span> (DataState)
    {
        <span class="code-comment">//</span><span class="code-comment"> Record Navigation</span>
        <span class="code-comment">//</span><span class="code-comment"> Move to the first record (Update the table/form display)</span>
        <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">First"</span>)
        {
            <span class="code-keyword">try</span>
            {
                rs.MoveFirst();
            }
            <span class="code-keyword">catch</span>(CDBException* e)
            {
                *pCtxt &lt;&lt; e- ID=<span class="code-string">"</span><span class="code-string">Text1"</span>&gt;m_strError;
                <span class="code-keyword">return</span>;
            }
            <span class="code-keyword">switch</span> (DBView)
            {
                <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
                <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
            }
        }
        <span class="code-comment">//</span><span class="code-comment"> Move to the previous object ID (Update the table/form display)</span>
        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Prev"</span>)
        {
            <span class="code-keyword">if</span> (DBView == <span class="code-digit">1</span>)
            {
                <span class="code-keyword">while</span> (!rs.IsBOF() &amp;&amp; rs.m_Field[1] == TempOID)
                {
                    <span class="code-keyword">try</span>
                    {
                        rs.MovePrev();
                    }
                    <span class="code-keyword">catch</span>(CDBException* e)
                    {
                        *pCtxt &lt;&lt; e-&gt;m_strError;
                        <span class="code-keyword">return</span>;
                    }
                }
            }
            ShowTable(pCtxt);
        }
        <span class="code-keyword">else</span>
        {
            <span class="code-keyword">try</span>
            {
                rs.MovePrev();
            }
            <span class="code-keyword">catch</span>(CDBException* e)
            {
                *pCtxt &lt;&lt; e-&gt;m_strError;
                <span class="code-keyword">return</span>;
            }
            PutRecord(pCtxt);
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Move to the next object ID (Skip over table</span>
    <span class="code-comment">//</span><span class="code-comment"> groups) (Update the table/form display)</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Next"</span>)
    {
        <span class="code-keyword">if</span> (DBView == <span class="code-digit">1</span>)
        {
            <span class="code-keyword">while</span> (!rs.IsEOF() &amp;&amp; rs.m_Field[1] == TempOID)
            {
                <span class="code-keyword">try</span>
                {
                    rs.MoveNext();
                }
                <span class="code-keyword">catch</span>(CDBException* e)
                {
                    *pCtxt &lt;&lt; e-&gt;m_strError;
                    <span class="code-keyword">return</span>;
                }
            }
            ShowTable(pCtxt);
        }
        <span class="code-keyword">else</span>
        {
            <span class="code-keyword">try</span>
            {
                rs.MoveNext();
            }
            <span class="code-keyword">catch</span>(CDBException* e)
            {
                *pCtxt &lt;&lt; e-&gt;m_strError;
                <span class="code-keyword">return</span>;
            }
            PutRecord(pCtxt);
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Move to the last record (Update the table/form display)</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Last"</span>)
    {
        <span class="code-keyword">try</span>
        {
            rs.MoveLast();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        <span class="code-keyword">switch</span> (DBView)
        {
            <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
            <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
        }

    }
    <span class="code-comment">//</span><span class="code-comment"> Update the display (Recordset position does not change)</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Current"</span>)
    {
        <span class="code-keyword">switch</span> (DBView)
        {
            <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
            <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Recordset view</span>
    <span class="code-comment">//</span><span class="code-comment"> Change to &#39;Table&#39; view</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Table"</span>)
    {
        DBView = <span class="code-digit">1</span>;
        ShowTable(pCtxt);
    }
    <span class="code-comment">//</span><span class="code-comment"> Change to &#39;Form&#39; view</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt == <span class="code-string">"</span><span class="code-string">Form"</span>)
    {
        DBView = <span class="code-digit">2</span>;
        PutRecord(pCtxt);
    }
    <span class="code-comment">//</span><span class="code-comment"> Change to &#39;Edit&#39; mode</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt.Left(<span class="code-digit">4</span>) == <span class="code-string">"</span><span class="code-string">Edit"</span>)
    <span class="code-comment">//</span><span class="code-comment"> For some reason simply testing for "Edit"</span>
    <span class="code-comment">//</span><span class="code-comment"> seems to fail after the first use, why ?</span>
    {
        EditRecord(pCtxt);
    }
    <span class="code-comment">//</span><span class="code-comment"> Change to &#39;New&#39; record mode</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt.Left(<span class="code-digit">3</span>) == <span class="code-string">"</span><span class="code-string">New"</span>)
    <span class="code-comment">//</span><span class="code-comment"> Again, simply testing for "New" seems to fail after the first use.</span>
    {
        NewRecord(pCtxt);
    }
    <span class="code-comment">//</span><span class="code-comment"> Delete record</span>
    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (opt.Left(<span class="code-digit">6</span>) == <span class="code-string">"</span><span class="code-string">Delete"</span>)
    <span class="code-comment">//</span><span class="code-comment"> Again, simply testing for "Delete" seems to fail after the first use.</span>
    {
        DeleteFromDB(pCtxt);
    }
    <span class="code-comment">//</span><span class="code-comment"> Locate a record (Match object ID with the option parameter)</span>
    <span class="code-keyword">else</span>
    {
        <span class="code-keyword">try</span>
        {
            rs.MoveFirst();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        <span class="code-keyword">int</span> Found = <span class="code-digit">0</span>;
        <span class="code-keyword">while</span> (!rs.IsEOF() &amp;&amp; !Found)
        {
            <span class="code-keyword">if</span> (rs.m_Field[1] == opt)
            {
                <span class="code-keyword">switch</span> (DBView)
                {
                    <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
                    <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
                }
                Found = <span class="code-digit">1</span>;
            }
            <span class="code-keyword">else</span>
            {
                <span class="code-keyword">try</span>
                {
                    rs.MoveNext();
                }
                <span class="code-keyword">catch</span>(CDBException* e)
                {
                    *pCtxt &lt;&lt; e-&gt;m_strError;
                    <span class="code-keyword">return</span>;
                }
            }
        }
        <span class="code-keyword">if</span> (!Found) *pCtxt
          &lt;&lt; <span class="code-string">"</span><span class="code-string">Could not match a record with Object ID: "</span>
          &lt;&lt; opt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">\n"</span>);
        }

        <span class="code-comment">//</span><span class="code-comment"> Show if the recordset pointer is at the first or last record</span>
        <span class="code-keyword">if</span> (rs.IsBOF()) *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;i&gt;(First Record)&lt;/i&gt;\n"</span>;
        <span class="code-keyword">if</span> (rs.IsEOF()) *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string">&lt;i&gt;(Last Record)&lt;/i&gt;\n"</span>;
    }
    <span class="code-keyword">else</span>
        *pCtxt &lt;&lt; <span class="code-string">"</span><span class="code-string">Error: Recordset not open\n"</span>;

    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}

<span class="code-comment">//</span><span class="code-comment"> UPDATE DataBase, Maps the submitted &#39;update record&#39;</span>
<span class="code-comment">//</span><span class="code-comment"> HTML form to the data set, or sends the data to the stored</span>
<span class="code-comment">//</span><span class="code-comment"> procedure UpdateDB &lt;Global Recordset&gt;</span>

<span class="code-keyword">void</span> CISODBCExample::UpdateDB(CHttpServerContext* pCtxt,
     LPCTSTR Field1, LPCTSTR Field2, LPCTSTR Field3,
     LPCTSTR Field4, LPCTSTR Field5, LPCTSTR Field6)
{
    StartContent(pCtxt);

    <span class="code-comment">//</span><span class="code-comment"> Attempt to update the recordset directly</span>
    <span class="code-keyword">if</span> (rs.CanUpdate())
    {
        <span class="code-keyword">try</span>
        {
            rs.Edit();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        <span class="code-keyword">if</span> (Field1 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[1] = Field1;
        <span class="code-keyword">if</span> (Field2 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[2] = Field2;
        <span class="code-keyword">if</span> (Field3 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[3] = Field3;
        <span class="code-keyword">if</span> (Field4 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[4] = Field4;
        <span class="code-keyword">if</span> (Field5 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[5] = Field5;
        <span class="code-keyword">if</span> (Field6 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[6] = Field6;
        <span class="code-keyword">try</span>
        {
            rs.Update();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Otherwise try sending the data to the &#39;UpdateDB&#39;</span>
    <span class="code-comment">//</span><span class="code-comment"> stored procedure for the current recordset being used</span>
    <span class="code-keyword">else</span>
    {
        CISODBCData Temp_rs;
        Temp_rs.m_StoredProcParam = <span class="code-string">"</span><span class="code-string">Update"</span> + (CString)Previous_repNo;
        Temp_rs.m_Pass[1] = Field1;
        Temp_rs.m_Pass[2] = Field2;
        Temp_rs.m_Pass[3] = Field3;
        Temp_rs.m_Pass[4] = Field4;
        Temp_rs.m_Pass[5] = Field5;
        Temp_rs.m_Pass[6] = Field6;
        <span class="code-keyword">try</span>
        {
            Temp_rs.Open(AFX_DB_USE_DEFAULT_TYPE,
                 _T(<span class="code-string">"</span><span class="code-string">{CALL ISAPIInterface (?, ?, ?, ?, ?, ?, ?)}"</span>),
                 NULL);
            Temp_rs.Close();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

    }

    <span class="code-comment">//</span><span class="code-comment"> Requery the recordset and show the updated data</span>

    rs.Requery();
    Show(pCtxt, Field1);
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}

<span class="code-comment">//</span><span class="code-comment"> ADD TO DataBase, Maps the submitted &#39;new record&#39; HTML</span>
<span class="code-comment">//</span><span class="code-comment"> form to the data set, or sends the data to the stored</span>
<span class="code-comment">//</span><span class="code-comment"> procedure AddToDB &lt;Global Recordset&gt;</span>

<span class="code-keyword">void</span> CISODBCExample::AddToDB(CHttpServerContext* pCtxt,
     LPCTSTR Field1, LPCTSTR Field2, LPCTSTR Field3,
     LPCTSTR Field4, LPCTSTR Field5, LPCTSTR Field6)
{
    <span class="code-comment">//</span><span class="code-comment"> Attempt to add to the recordset directly</span>
    <span class="code-keyword">if</span> (rs.CanUpdate())
    {
        <span class="code-keyword">try</span>
        {
            rs.AddNew();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
        <span class="code-keyword">if</span> (Field1 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[1] = Field1;
        <span class="code-keyword">if</span> (Field2 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[2] = Field2;
        <span class="code-keyword">if</span> (Field3 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[3] = Field3;
        <span class="code-keyword">if</span> (Field4 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[4] = Field4;
        <span class="code-keyword">if</span> (Field5 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[5] = Field5;
        <span class="code-keyword">if</span> (Field6 &gt; <span class="code-string">"</span><span class="code-string">"</span>) rs.m_Field[6] = Field6;

        <span class="code-keyword">try</span>
        {
            rs.Update();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Otherwise try sending the data to the &#39;AddToDB&#39;</span>
    <span class="code-comment">//</span><span class="code-comment"> stored procedure for the current recordset being used</span>
    <span class="code-keyword">else</span>
    {
        CISODBCData Temp_rs;
        Temp_rs.m_StoredProcParam = <span class="code-string">"</span><span class="code-string">Add"</span> + (CString)Previous_repNo;
        Temp_rs.m_Pass[1] = Field1;
        Temp_rs.m_Pass[2] = Field2;
        Temp_rs.m_Pass[3] = Field3;
        Temp_rs.m_Pass[4] = Field4;
        Temp_rs.m_Pass[5] = Field5;
        Temp_rs.m_Pass[6] = Field6;

        <span class="code-keyword">try</span>
        {
            Temp_rs.Open(AFX_DB_USE_DEFAULT_TYPE,
                  _T(<span class="code-string">"</span><span class="code-string">{CALL ISAPIInterface (?, ?, ?, ?, ?, ?, ?)}"</span>) ,NULL);
            Temp_rs.Close();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Requery the recordset and show the updated data</span>
    <span class="code-comment">//</span><span class="code-comment"> (N.B. Cannot use ShowRecord() because object ID is unknown)</span>
    <span class="code-keyword">try</span>
    {
        rs.Requery();
    }
    <span class="code-keyword">catch</span>(CDBException* e)
    {
        *pCtxt &lt;&lt; e-&gt;m_strError;
        <span class="code-keyword">return</span>;
    }
    <span class="code-keyword">while</span> (Field2 != rs.m_Field[2] &amp;&amp;
           Field3 != rs.m_Field[3] &amp;&amp; !rs.IsEOF())
    {
        <span class="code-keyword">try</span>
        {
            rs.MoveNext();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }
    <span class="code-keyword">switch</span> (DBView)
    {
        <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
        <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
    }
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}

<span class="code-comment">//</span><span class="code-comment"> DELETE FROM DataBase, Attempts to delete a record from</span>
<span class="code-comment">//</span><span class="code-comment"> the recordset, or deletes the record using</span>
<span class="code-comment">//</span><span class="code-comment"> the DeleteFromDB stored procedure</span>
<span class="code-keyword">void</span> CISODBCExample::DeleteFromDB(CHttpServerContext* pCtxt)
{
    StartContent(pCtxt);

    <span class="code-comment">//</span><span class="code-comment"> Attempt to delete the record from the recordset directly</span>
    <span class="code-keyword">if</span> (rs.CanUpdate())
    {
        <span class="code-keyword">try</span>
        {
            rs.Delete();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }

    }
    <span class="code-comment">//</span><span class="code-comment"> Otherwise try the delete stored procedure</span>
    <span class="code-comment">//</span><span class="code-comment"> for the current recordset being used</span>
    <span class="code-keyword">else</span>
    {
        CISODBCData Temp_rs;
        Temp_rs.m_StoredProcParam = <span class="code-string">"</span><span class="code-string">Delete"</span> + (CString)Previous_repNo;
        Temp_rs.m_Pass[1] = rs.m_Field[1];
        <span class="code-keyword">try</span>
        {
            Temp_rs.Open(AFX_DB_USE_DEFAULT_TYPE,
                         _T(<span class="code-string">"</span><span class="code-string">{CALL ISAPIInterface (?, ?)}"</span>) ,NULL);
            Temp_rs.Close();
        }
        <span class="code-keyword">catch</span>(CDBException* e)
        {
            *pCtxt &lt;&lt; e-&gt;m_strError;
            <span class="code-keyword">return</span>;
        }
    }

    <span class="code-comment">//</span><span class="code-comment"> Requery the recordset (User is placed</span>
    <span class="code-comment">//</span><span class="code-comment"> at the first record in the recordset)</span>
    <span class="code-keyword">try</span>
    {
        rs.Requery();
    }
    <span class="code-keyword">catch</span>(CDBException* e)
    {
        *pCtxt &lt;&lt; e-&gt;m_strError;
        <span class="code-keyword">return</span>;
    }
    <span class="code-keyword">switch</span> (DBView)
    {
        <span class="code-keyword">case</span> <span class="code-digit">2</span>: PutRecord(pCtxt); <span class="code-keyword">break</span>;
        <span class="code-keyword">default</span>: ShowTable(pCtxt); <span class="code-keyword">break</span>;
    }
    *pCtxt &lt;&lt; _T(<span class="code-string">"</span><span class="code-string">&lt;/body&gt;\n"</span>);
    EndContent(pCtxt);
}</pre><a name="InternetPAL"></a>
  <h2>Appendix C: Example MS SQL database used in examples</h2>
  <p>This is the Transact-SQL required to recreate the example database that gets connected to by the various ODBC/ADO examples in this document.</p><div class='pre-lang' id='premain879281'><div>SQL</div><div class='pre-action-link'><span id='copycode879281' class='copy-code' data-index='879281' style='visibility:hidden'>Copy Code</span></div></div>
  <pre id='pre879281' style='margin-top:0;' class='lang-sql' data-language='sql' data-allowShrink='True' data-collapse='False'>
<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.GetNextClassification ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.GetNextClassification&#39;</span>)
           <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">GetNextClassification"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ISAPIInterface ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ISAPIInterface&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ISAPIInterface"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListAllKeywords ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListAllKeywords&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListAllKeywords"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListArticles ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListArticles&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListArticles"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListIndexes ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListIndexes&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListIndexes"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListMatches ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListMatches&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListMatches"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListRelated ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListRelated&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListRelated"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListRelatedKeywords ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListRelatedKeywords&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListRelatedKeywords"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListURLs ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ListURLs&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ListURLs"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.Search ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
           id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.Search&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Search"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.SearchSounds ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span> id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.SearchSounds&#39;</span>)
                                                  <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">SearchSounds"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ClassCode ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span> id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.ClassCode&#39;</span>)
                                               <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">4</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">procedure</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">ClassCode"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Entries ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span> id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.Entries&#39;</span>)
                                              <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">3</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">table</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Entries"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Indexes ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span> id =
           object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.Indexes&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">3</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">table</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Indexes"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Thesaurus ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span>
   id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.Thesaurus&#39;</span>) <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">3</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">table</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Thesaurus"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.URLs ******/</span>
<span class="code-keyword">if</span> <span class="code-keyword">exists</span> (<span class="code-keyword">select</span> * <span class="code-keyword">from</span> sysobjects <span class="code-keyword">where</span> id = object_id(<span class="code-string">&#39;</span><span class="code-string">dbo.URLs&#39;</span>)
                                          <span class="code-keyword">and</span> sysstat &amp; 0xf = <span class="code-digit">3</span>)
    <span class="code-keyword">drop</span> <span class="code-keyword">table</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">URLs"</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Entries ******/</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">TABLE</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Entries"</span> (
    <span class="code-string">"</span><span class="code-string">OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Name"</span> <span class="code-keyword">varchar</span> (<span class="code-digit">100</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">URL"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Bookmark"</span> <span class="code-keyword">varchar</span> (<span class="code-digit">255</span>) <span class="code-keyword">NULL</span> ,
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">PK___3__10"</span> <span class="code-keyword">PRIMARY</span> <span class="code-keyword">KEY</span>  <span class="code-keyword">CLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">OID"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">NoDuplicateNames"</span> <span class="code-keyword">UNIQUE</span>  <span class="code-keyword">NONCLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">Name"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">OID"</span> <span class="code-keyword">CHECK</span> (OID &gt;= <span class="code-digit">100000000</span> <span class="code-keyword">and</span> (OID &lt;= <span class="code-digit">999999999</span>))
)
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Indexes ******/</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">TABLE</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Indexes"</span> (
    <span class="code-string">"</span><span class="code-string">OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">IDENTITY</span> (<span class="code-digit">1</span>, <span class="code-digit">1</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Name"</span> <span class="code-keyword">varchar</span> (<span class="code-digit">100</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Base_Entry_OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Top_Entry_OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">PK___2__10"</span> <span class="code-keyword">PRIMARY</span> <span class="code-keyword">KEY</span>  <span class="code-keyword">CLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">OID"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">NoDuplicateIndexNames"</span> <span class="code-keyword">UNIQUE</span>  <span class="code-keyword">NONCLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">Name"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">BaseEntry"</span> <span class="code-keyword">CHECK</span> (Base_Entry_OID &gt;= <span class="code-digit">100000000</span>
                <span class="code-keyword">and</span> (Base_Entry_OID &lt;= <span class="code-digit">999999999</span>)),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">TopEntry"</span> <span class="code-keyword">CHECK</span> (Top_Entry_OID &gt;= <span class="code-digit">100000000</span>
                <span class="code-keyword">and</span> (Top_Entry_OID &lt;= <span class="code-digit">999999999</span>))
)
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.Thesaurus ******/</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">TABLE</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">Thesaurus"</span> (
    <span class="code-string">"</span><span class="code-string">OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">IDENTITY</span> (<span class="code-digit">1</span>, <span class="code-digit">1</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">Entry_OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">String"</span> <span class="code-keyword">varchar</span> (<span class="code-digit">30</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">PK___1__10"</span> <span class="code-keyword">PRIMARY</span> <span class="code-keyword">KEY</span>  <span class="code-keyword">CLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">OID"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">EntryOID"</span> <span class="code-keyword">CHECK</span> (Entry_OID &gt;= <span class="code-digit">100000000</span>
                <span class="code-keyword">and</span> (Entry_OID &lt;= <span class="code-digit">999999999</span>))
)
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Table dbo.URLs ******/</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">TABLE</span> <span class="code-string">"</span><span class="code-string">dbo"</span>.<span class="code-string">"</span><span class="code-string">URLs"</span> (
    <span class="code-string">"</span><span class="code-string">OID"</span> <span class="code-string">"</span><span class="code-string">int"</span> <span class="code-keyword">IDENTITY</span> (<span class="code-digit">1</span>, <span class="code-digit">1</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-string">"</span><span class="code-string">URL"</span> <span class="code-keyword">varchar</span> (<span class="code-digit">255</span>) <span class="code-keyword">NOT</span> <span class="code-keyword">NULL</span> ,
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">PK___4__10"</span> <span class="code-keyword">PRIMARY</span> <span class="code-keyword">KEY</span>  <span class="code-keyword">CLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">OID"</span>
    ),
    <span class="code-keyword">CONSTRAINT</span> <span class="code-string">"</span><span class="code-string">NoDuplicateURLs"</span> <span class="code-keyword">UNIQUE</span>  <span class="code-keyword">NONCLUSTERED</span>
    (
        <span class="code-string">"</span><span class="code-string">URL"</span>
    )
)
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ClassCode ******/</span>
<span class="code-comment">--</span><span class="code-comment">- Split the class code (Entry object ID) into the various facets by colons</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ClassCode <span class="code-sdkkeyword">@Code</span> <span class="code-keyword">int</span> = <span class="code-digit">0</span> <span class="code-keyword">as</span>

  <span class="code-comment">--</span><span class="code-comment">- Convert @Code to string and add colons a appropirate points</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@ClassCode</span> <span class="code-keyword">varchar</span>(<span class="code-digit">13</span>)
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@ClassCode</span> = <span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), <span class="code-sdkkeyword">@Code</span>)
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@ClassCode</span> = SUBSTRING(<span class="code-sdkkeyword">@ClassCode</span>, <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
         SUBSTRING(<span class="code-sdkkeyword">@ClassCode</span>, <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
         SUBSTRING(<span class="code-sdkkeyword">@ClassCode</span>, <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
         SUBSTRING(<span class="code-sdkkeyword">@ClassCode</span>, <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
         SUBSTRING(<span class="code-sdkkeyword">@ClassCode</span>, <span class="code-digit">8</span>, <span class="code-digit">2</span>)

  <span class="code-comment">--</span><span class="code-comment">- Return new string</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@ClassCode</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.GetNextClassification ******/</span>
<span class="code-comment">--</span><span class="code-comment">- Returns the next valid classification number in a particular index</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> GetNextClassification <span class="code-sdkkeyword">@index</span> <span class="code-keyword">int</span> = 0AS

  <span class="code-comment">--</span><span class="code-comment">- Find the band range for the index specified in @index</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">int</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">int</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@OID</span> <span class="code-keyword">int</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@Base</span> = Base_Entry_OID, <span class="code-sdkkeyword">@Top</span> = Top_Entry_OID
    <span class="code-keyword">FROM</span> Indexes
    <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@index</span>

  <span class="code-comment">--</span><span class="code-comment">- Calculate the next availible OID by selecting all records in order</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@OID</span> = (OID + <span class="code-digit">1</span>) <span class="code-keyword">FROM</span> Entries <span class="code-keyword">WHERE</span> Entries.OID
   &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span> Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> OID

  <span class="code-comment">--</span><span class="code-comment">- Return the @OID found</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@OID</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ISAPIInterface     ******/</span>
<span class="code-comment">--</span><span class="code-comment"> This procedure is used by the ISAPI extension (ISODBCExample.dll)</span>
<span class="code-comment">--</span><span class="code-comment"> as a fixed entry point into the InternetPAL database</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ISAPIInterface <span class="code-sdkkeyword">@Action</span> <span class="code-keyword">varchar</span>(<span class="code-digit">20</span>) = <span class="code-string">"</span><span class="code-string">DataErr"</span>,
       <span class="code-sdkkeyword">@Pass1</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Pass2</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>,
       <span class="code-sdkkeyword">@Pass3</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Pass4</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>,
       <span class="code-sdkkeyword">@Pass5</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Pass6</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>,
       <span class="code-sdkkeyword">@Pass7</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Pass8</span> <span class="code-keyword">varchar</span>(<span class="code-digit">40</span>) = <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">AS</span>

  <span class="code-comment">--</span><span class="code-comment">- If list of entries in a particular index is required...</span>
  <span class="code-keyword">IF</span> <span class="code-sdkkeyword">@Action</span> <span class="code-keyword">LIKE</span> <span class="code-string">"</span><span class="code-string">%List%"</span>
  <span class="code-keyword">BEGIN</span>

    <span class="code-comment">--</span><span class="code-comment">- Find index banding boundaries</span>
    <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">int</span>
    <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">int</span>
    <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@Base</span> = Base_Entry_OID, <span class="code-sdkkeyword">@Top</span> = Top_Entry_OID
      <span class="code-keyword">FROM</span> Indexes
      <span class="code-keyword">WHERE</span> OID = <span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass1</span>)

    <span class="code-comment">--</span><span class="code-comment">- Return articles that fit in this banding</span>
    <span class="code-keyword">SELECT</span> Thesaurus.OID, Entries.OID <span class="code-keyword">AS</span> <span class="code-string">"</span><span class="code-string">Classification"</span>,
           String <span class="code-keyword">AS</span> <span class="code-string">"</span><span class="code-string">Term"</span>, Name <span class="code-keyword">AS</span> <span class="code-string">"</span><span class="code-string">Article"</span>, URLs.URL <span class="code-keyword">AS</span> <span class="code-string">"</span><span class="code-string">URL"</span>,
           Bookmark, <span class="code-keyword">NULL</span>, <span class="code-keyword">NULL</span>
      <span class="code-keyword">FROM</span> Entries, URLs, Thesaurus
      <span class="code-keyword">WHERE</span> Entries.OID &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span> Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span>
            <span class="code-keyword">AND</span> Entries.URL = URLs.OID
            <span class="code-keyword">AND</span> Thesaurus.Entry_OID = Entries.OID
      <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> Entries.OID
  <span class="code-keyword">END</span>

  <span class="code-comment">--</span><span class="code-comment">- If record has been updated...</span>
  <span class="code-keyword">IF</span> <span class="code-sdkkeyword">@Action</span> <span class="code-keyword">LIKE</span> <span class="code-string">"</span><span class="code-string">%Update%"</span>
  <span class="code-keyword">BEGIN</span>

    <span class="code-comment">--</span><span class="code-comment">- Update the thesaurus entry</span>
    <span class="code-keyword">UPDATE</span> Thesaurus
      <span class="code-keyword">SET</span>
        String = <span class="code-sdkkeyword">@Pass3</span>
      <span class="code-keyword">WHERE</span> OID = <span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass1</span>)

    <span class="code-comment">--</span><span class="code-comment">- Find the current entry OID for this term</span>
    <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@OID</span> <span class="code-keyword">int</span>
    <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@OID</span> = Entry_OID
      <span class="code-keyword">FROM</span> Thesaurus
      <span class="code-keyword">WHERE</span> OID = <span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass1</span>)

    <span class="code-comment">--</span><span class="code-comment">- Find the current URL OID for this entry</span>
    <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@URL</span> <span class="code-keyword">int</span>
    <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@URL</span> = URL
      <span class="code-keyword">FROM</span> Entries
      <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@OID</span>

    <span class="code-comment">--</span><span class="code-comment">- Update the URL</span>
    <span class="code-keyword">UPDATE</span> URLs
      <span class="code-keyword">SET</span>
        URL = <span class="code-sdkkeyword">@Pass5</span>
      <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@URL</span>

    <span class="code-comment">--</span><span class="code-comment">- Update the entries table accordingly</span>
    <span class="code-keyword">UPDATE</span> Entries
      <span class="code-keyword">SET</span>
        OID = <span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass2</span>),
        Name = <span class="code-sdkkeyword">@Pass4</span>,
    Bookmark = <span class="code-sdkkeyword">@Pass6</span>
      <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@OID</span>
  <span class="code-keyword">END</span>

  <span class="code-comment">--</span><span class="code-comment">- If record is being added to the database... (N.B. This is only</span>
  <span class="code-comment">--</span><span class="code-comment">- an example for completeness and should NOT be used!)</span>
  <span class="code-keyword">IF</span> <span class="code-sdkkeyword">@Action</span> <span class="code-keyword">LIKE</span> <span class="code-string">"</span><span class="code-string">%Add%"</span>
  <span class="code-keyword">BEGIN</span>

    <span class="code-comment">--</span><span class="code-comment">- Add the URLs</span>
    <span class="code-keyword">INSERT</span> URLs
      <span class="code-keyword">VALUES</span> (<span class="code-sdkkeyword">@Pass5</span>)

    <span class="code-comment">--</span><span class="code-comment">- Get URL OID</span>
    <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@URL</span> = OID
      <span class="code-keyword">FROM</span> URLs
      <span class="code-keyword">WHERE</span> URL = <span class="code-sdkkeyword">@Pass5</span>

    <span class="code-comment">--</span><span class="code-comment">- Add the entries</span>
    <span class="code-keyword">INSERT</span> Entries
      <span class="code-keyword">VALUES</span> (<span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass2</span>), <span class="code-sdkkeyword">@Pass4</span>, <span class="code-sdkkeyword">@URL</span>, <span class="code-sdkkeyword">@Pass5</span>)

    <span class="code-comment">--</span><span class="code-comment">- Add the thesaurus entry</span>
    <span class="code-keyword">INSERT</span> Thesaurus
      <span class="code-keyword">VALUES</span> (<span class="code-keyword">CONVERT</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass2</span>), <span class="code-sdkkeyword">@Pass3</span>)
  <span class="code-keyword">END</span>

  <span class="code-comment">--</span><span class="code-comment">- If record is being deleted from the database... </span>
  <span class="code-comment">--</span><span class="code-comment">- (N.B. This is only an example for completeness</span>
  <span class="code-comment">--</span><span class="code-comment">-                       and should NOT be used!)</span>
  <span class="code-keyword">IF</span> <span class="code-sdkkeyword">@Action</span> <span class="code-keyword">LIKE</span> <span class="code-string">"</span><span class="code-string">%Delete%"</span>
  <span class="code-keyword">BEGIN</span>

    <span class="code-comment">--</span><span class="code-comment">- Remove thesaurus entry</span>
    <span class="code-keyword">DELETE</span> <span class="code-keyword">FROM</span> Thesaurus
      <span class="code-keyword">WHERE</span> OID = <span class="code-keyword">Convert</span>(<span class="code-keyword">int</span>, <span class="code-sdkkeyword">@Pass1</span>)
  <span class="code-keyword">END</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListAllKeywords ******/</span>
<span class="code-comment">--</span><span class="code-comment"> List all the terms in the thesaurus</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListAllKeywords <span class="code-keyword">AS</span>
    <span class="code-keyword">SELECT</span> String <span class="code-keyword">From</span> Thesaurus
      <span class="code-keyword">GROUP</span> <span class="code-keyword">BY</span> String
      <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> String
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListArticles ******/</span>
<span class="code-comment">--</span><span class="code-comment">- List the Articles&#39;s (Required by AddURL.asp)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListArticles <span class="code-keyword">AS</span>
  <span class="code-keyword">SELECT</span> OID, Name
  <span class="code-keyword">FROM</span> Entries <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> Name
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListIndexes ******/</span>
<span class="code-comment">--</span><span class="code-comment">- Lits all indexes (Indented depending on position in hierachy)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListIndexes <span class="code-keyword">AS</span>
  <span class="code-keyword">SELECT</span> Indexes.OID, <span class="code-string">"</span><span class="code-string">Indent"</span> =
  <span class="code-keyword">case</span>
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">9</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">8</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">7</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">6</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">5</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">4</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">3</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">2</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . "</span> + Indexes.Name
    <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Indexes.Base_Entry_OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
         <span class="code-keyword">then</span> Indexes.Name
  <span class="code-keyword">end</span>
  <span class="code-keyword">FROM</span> Indexes <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> Base_Entry_OID
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListMatches ******/</span>
<span class="code-comment">--</span><span class="code-comment">- List all matches for a specific query string (ignoring those</span>
<span class="code-comment">--</span><span class="code-comment">- that are excluded by index or query string)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListMatches <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">varchar</span>(<span class="code-digit">150</span>) = <span class="code-string">"</span><span class="code-string">"</span>,
       <span class="code-sdkkeyword">@Exclude</span> <span class="code-keyword">varchar</span>(<span class="code-digit">150</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Restrict</span> <span class="code-keyword">int</span> = <span class="code-digit">1</span> <span class="code-keyword">AS</span>

  <span class="code-comment">--</span><span class="code-comment">- Find which index band to restrict the entries into</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">int</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">int</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@Base</span> = Base_Entry_OID, <span class="code-sdkkeyword">@Top</span> = Top_Entry_OID
    <span class="code-keyword">FROM</span> Indexes
    <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@Restrict</span>

  <span class="code-comment">--</span><span class="code-comment">- If we are not excluding then match with @Entry only</span>
  <span class="code-keyword">if</span> <span class="code-sdkkeyword">@Exclude</span> = <span class="code-string">"</span><span class="code-string">"</span>
  <span class="code-keyword">BEGIN</span>
    <span class="code-keyword">SELECT</span> <span class="code-string">"</span><span class="code-string">Hyperlink"</span>=
           <span class="code-keyword">case</span>
             <span class="code-keyword">when</span> MAX(URLs.URL) = <span class="code-string">"</span><span class="code-string">mailto:"</span> <span class="code-keyword">then</span> MAX(URLs.URL + Bookmark)
             <span class="code-keyword">when</span> MAX(URLs.URL) = <span class="code-string">"</span><span class="code-string">ftp:"</span> <span class="code-keyword">then</span> MAX(URLs.URL + Bookmark)
             <span class="code-keyword">when</span> MAX(Bookmark) &gt; <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">then</span> MAX(URLs.URL + <span class="code-string">"</span><span class="code-string">#"</span> + Bookmark)
             <span class="code-keyword">else</span> MAX(URLs.URL)
          <span class="code-keyword">end</span>,
          <span class="code-string">"</span><span class="code-string">Indent"</span> =
          <span class="code-keyword">case</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">9</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name + <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name + <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">7</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name + <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">5</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">3</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span> <span class="code-keyword">then</span>
                 SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) +
                 <span class="code-string">"</span><span class="code-string"> &lt;font size=6&gt;&lt;b&gt;"</span> + MAX(String) +
                 <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                 <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
          <span class="code-keyword">end</span>
      <span class="code-keyword">FROM</span> Thesaurus, Entries, URLs
      <span class="code-keyword">WHERE</span> (Entries.OID &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span> Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span>)
       <span class="code-keyword">AND</span> (<span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> String <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> +
       <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + Name + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> Name <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> +
       <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span>) <span class="code-keyword">AND</span> Thesaurus.Entry_OID = Entries.OID
       <span class="code-keyword">AND</span> Entries.URL = URLs.OID
      <span class="code-keyword">GROUP</span> <span class="code-keyword">BY</span> Name
      <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> MAX(Entries.OID)
  <span class="code-keyword">END</span>

  <span class="code-comment">--</span><span class="code-comment">- If instread we are are excluding then match with @Entry and don&#39;t match @Exclude</span>
  <span class="code-keyword">else</span>

  <span class="code-keyword">BEGIN</span>
    <span class="code-keyword">SELECT</span> <span class="code-string">"</span><span class="code-string">Hyperlink"</span>=
           <span class="code-keyword">case</span>
             <span class="code-keyword">when</span> MAX(URLs.URL) = <span class="code-string">"</span><span class="code-string">mailto:"</span> <span class="code-keyword">then</span> MAX(URLs.URL + Bookmark)
             <span class="code-keyword">when</span> MAX(URLs.URL) = <span class="code-string">"</span><span class="code-string">ftp:"</span> <span class="code-keyword">then</span> MAX(URLs.URL + Bookmark)
             <span class="code-keyword">when</span> MAX(Bookmark) &gt; <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">then</span> MAX(URLs.URL + <span class="code-string">"</span><span class="code-string">#"</span> + Bookmark)
             <span class="code-keyword">else</span> MAX(URLs.URL)
          <span class="code-keyword">end</span>,
          <span class="code-string">"</span><span class="code-string">Indent"</span> =
          <span class="code-keyword">case</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">9</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">7</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">5</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">3</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                      SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;"</span> + MAX(String) + <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span>
                      + Entries.Name + <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
            <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                 <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), MAX(Entries.OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) +
                      <span class="code-string">"</span><span class="code-string"> &lt;font size=6&gt;&lt;b&gt;"</span> + MAX(String) +
                      <span class="code-string">"</span><span class="code-string"> &lt;/b&gt;&lt;i&gt;"</span> + Entries.Name +
                      <span class="code-string">"</span><span class="code-string">&lt;/i&gt;&lt;/font&gt;"</span>
          <span class="code-keyword">end</span>
      <span class="code-keyword">FROM</span> Thesaurus, Entries, URLs
      <span class="code-keyword">WHERE</span> (Entries.OID &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span> Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span>)
       <span class="code-keyword">AND</span> (<span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> String <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> +
       <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + Name + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> Name <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> +
       <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span>) <span class="code-keyword">AND</span> (<span class="code-sdkkeyword">@Exclude</span> <span class="code-keyword">NOT</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span>
       <span class="code-keyword">AND</span> String <span class="code-keyword">NOT</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + <span class="code-sdkkeyword">@Exclude</span> + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">AND</span> <span class="code-sdkkeyword">@Exclude</span> <span class="code-keyword">NOT</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span>
       + Name + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">AND</span> Name <span class="code-keyword">NOT</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + <span class="code-sdkkeyword">@Exclude</span> + <span class="code-string">"</span><span class="code-string">%"</span>) <span class="code-keyword">AND</span>
       Thesaurus.Entry_OID = Entries.OID <span class="code-keyword">AND</span> Entries.URL = URLs.OID
      <span class="code-keyword">GROUP</span> <span class="code-keyword">BY</span> Name
      <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> MAX(Entries.OID)
  <span class="code-keyword">END</span>
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListRelated ******/</span>
<span class="code-comment">--</span><span class="code-comment"> List all articles that fall into index given (Order by name)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListRelated <span class="code-sdkkeyword">@IndexOID</span> <span class="code-keyword">int</span> = <span class="code-digit">1</span> <span class="code-keyword">AS</span>

  <span class="code-comment">--</span><span class="code-comment">- Find the indexes band range</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">int</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">int</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@Base</span> = Base_Entry_OID, <span class="code-sdkkeyword">@Top</span> = Top_Entry_OID
    <span class="code-keyword">FROM</span> Indexes
    <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@IndexOID</span>

  <span class="code-comment">--</span><span class="code-comment">- Return articles in this banding</span>
  <span class="code-keyword">SELECT</span> <span class="code-string">"</span><span class="code-string">Hyperlink"</span>=
         <span class="code-keyword">case</span>
           <span class="code-keyword">when</span> URLs.URL = <span class="code-string">"</span><span class="code-string">mailto:"</span> <span class="code-keyword">then</span> URLs.URL + Bookmark
           <span class="code-keyword">when</span> URLs.URL = <span class="code-string">"</span><span class="code-string">ftp:"</span> <span class="code-keyword">then</span> URLs.URL + Bookmark
           <span class="code-keyword">when</span> Bookmark &gt; <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">then</span> URLs.URL + <span class="code-string">"</span><span class="code-string">#"</span> + Bookmark
           <span class="code-keyword">else</span> URLs.URL
         <span class="code-keyword">end</span>
         , <span class="code-string">"</span><span class="code-string">Indent"</span> =
         <span class="code-keyword">case</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">9</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">8</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">6</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">8</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=2&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">7</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">6</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">6</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=3&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">5</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">4</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=4&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">3</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;&lt;b&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) + <span class="code-string">"</span><span class="code-string">:"</span> +
                     SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">2</span>, <span class="code-digit">2</span>) +
                     <span class="code-string">"</span><span class="code-string"> &lt;font size=5&gt;"</span> + Entries.Name +
                     <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> SUBSTRING(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">varchar</span>(<span class="code-digit">9</span>), Entries.OID), <span class="code-digit">1</span>, <span class="code-digit">1</span>) +
                <span class="code-string">"</span><span class="code-string"> &lt;font size=6&gt;&lt;b&gt;"</span> + Entries.Name +
                <span class="code-string">"</span><span class="code-string">&lt;/b&gt;&lt;/font&gt;"</span>
         <span class="code-keyword">end</span>
    <span class="code-keyword">FROM</span> Entries, URLs
    <span class="code-keyword">WHERE</span> Entries.OID &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span>
          Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">AND</span> Entries.URL = URLs.OID
    <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> Entries.OID
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListRelatedKeywords ******/</span>
<span class="code-comment">--</span><span class="code-comment"> List the keywords that fall into a particular index (Order by name)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListRelatedKeywords <span class="code-sdkkeyword">@IndexOID</span> <span class="code-keyword">int</span> = <span class="code-digit">1</span> <span class="code-keyword">AS</span>
  <span class="code-comment">--</span><span class="code-comment">- Find the index band range</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">int</span>
  <span class="code-keyword">DECLARE</span> <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">int</span>
  <span class="code-keyword">SELECT</span> <span class="code-sdkkeyword">@Base</span> = Base_Entry_OID, <span class="code-sdkkeyword">@Top</span> = Top_Entry_OID
                 <span class="code-keyword">FROM</span> Indexes <span class="code-keyword">WHERE</span> OID = <span class="code-sdkkeyword">@IndexOID</span>

  <span class="code-comment">--</span><span class="code-comment">- List thesaurus terms in this range</span>
  <span class="code-keyword">SELECT</span> <span class="code-string">"</span><span class="code-string">Hyperlink"</span>=
         <span class="code-keyword">case</span>
           <span class="code-keyword">when</span> URLs.URL = <span class="code-string">"</span><span class="code-string">mailto:"</span> <span class="code-keyword">then</span> URLs.URL + Bookmark
           <span class="code-keyword">when</span> URLs.URL = <span class="code-string">"</span><span class="code-string">ftp:"</span> <span class="code-keyword">then</span> URLs.URL + Bookmark
           <span class="code-keyword">when</span> Bookmark &gt; <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">then</span> URLs.URL + <span class="code-string">"</span><span class="code-string">#"</span> + Bookmark
           <span class="code-keyword">else</span> URLs.URL
         <span class="code-keyword">end</span>
         , Thesaurus.String
    <span class="code-keyword">FROM</span> Entries, Thesaurus, URLs
    <span class="code-keyword">WHERE</span> Entries.OID &gt;= <span class="code-sdkkeyword">@Base</span> <span class="code-keyword">AND</span> Entries.OID &lt;= <span class="code-sdkkeyword">@Top</span> <span class="code-keyword">AND</span>
          Entries.OID = Entry_OID <span class="code-keyword">AND</span> Entries.URL = URLs.OID
    <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> Thesaurus.String, Entries.Name
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.ListURLs ******/</span>
<span class="code-comment">--</span><span class="code-comment">- List the URL&#39;s (Required by AddURL.asp)</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> ListURLs <span class="code-keyword">AS</span>
  <span class="code-keyword">SELECT</span> OID, URL
  <span class="code-keyword">FROM</span> URLs <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> URL
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.Search ******/</span>
<span class="code-comment">--</span><span class="code-comment">- List indexes that are related to the phrase </span>
<span class="code-comment">--</span><span class="code-comment">-    given in @Entry, but not those given in @Excluded</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> Search <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">varchar</span>(<span class="code-digit">150</span>) = <span class="code-string">"</span><span class="code-string">"</span>, <span class="code-sdkkeyword">@Exclude</span> <span class="code-keyword">varchar</span>(<span class="code-digit">150</span>) = <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">AS</span>
  <span class="code-keyword">SELECT</span> MAX(Indexes.OID),
         <span class="code-string">"</span><span class="code-string">Indent"</span> =
         <span class="code-keyword">case</span>
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">9</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">8</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">7</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">6</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">5</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">4</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . . . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">3</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">2</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> <span class="code-string">"</span><span class="code-string">. . . "</span> + MAX(Indexes.Name)
           <span class="code-keyword">when</span> substring(<span class="code-keyword">CONVERT</span>(<span class="code-keyword">char</span>(<span class="code-digit">9</span>), MAX(Indexes.Base_Entry_OID)), <span class="code-digit">1</span>, <span class="code-digit">1</span>) &gt; <span class="code-string">"</span><span class="code-string">0"</span>
                <span class="code-keyword">then</span> MAX(Indexes.Name)
         <span class="code-keyword">end</span>
    <span class="code-keyword">FROM</span> Thesaurus, Indexes
    <span class="code-keyword">WHERE</span> (<span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> String <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + <span class="code-sdkkeyword">@Entry</span> +
           <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + Name + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">OR</span> Name <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span>)
           <span class="code-keyword">AND</span> (<span class="code-sdkkeyword">@Exclude</span> <span class="code-keyword">NOT</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span> <span class="code-keyword">AND</span> <span class="code-keyword">NOT</span> String <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> +
           <span class="code-sdkkeyword">@Exclude</span> + <span class="code-string">"</span><span class="code-string">%"</span>) <span class="code-keyword">AND</span> Indexes.Base_Entry_OID &lt;= Thesaurus.Entry_OID
           <span class="code-keyword">AND</span> Indexes.Top_Entry_OID &gt;= Thesaurus.Entry_OID
    <span class="code-keyword">GROUP</span> <span class="code-keyword">BY</span> Indexes.OID
    <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> MAX(Indexes.Base_Entry_OID)
<span class="code-keyword">GO</span>

<span class="code-comment">/*</span><span class="code-comment">***** Object:  Stored Procedure dbo.SearchSounds ******/</span>
<span class="code-comment">--</span><span class="code-comment"> List all thesaurus terms that &#39;sound like&#39; the words given in the phrase &#39;@Entry&#39;</span>
<span class="code-keyword">CREATE</span> <span class="code-keyword">PROCEDURE</span> SearchSounds <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">varchar</span>(<span class="code-digit">150</span>) = <span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">AS</span>
    <span class="code-keyword">SELECT</span> String <span class="code-keyword">From</span> Thesaurus
      <span class="code-keyword">WHERE</span> DIFFERENCE(<span class="code-sdkkeyword">@Entry</span>, String) = <span class="code-digit">4</span> <span class="code-keyword">OR</span> <span class="code-sdkkeyword">@Entry</span> <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + String + <span class="code-string">"</span><span class="code-string">%"</span>
                                           <span class="code-keyword">OR</span> String <span class="code-keyword">Like</span> <span class="code-string">"</span><span class="code-string">%"</span> + <span class="code-sdkkeyword">@Entry</span> + <span class="code-string">"</span><span class="code-string">%"</span>
      <span class="code-keyword">GROUP</span> <span class="code-keyword">BY</span> String
      <span class="code-keyword">ORDER</span> <span class="code-keyword">BY</span> String
<span class="code-keyword">GO</span></pre>


</div>

</body>
</html>
